{"version":3,"file":"pryv.js","mappings":"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","sources":["webpack://lib-js/./components/pryv/src/utils.js","webpack://lib-js/./components/pryv/src/ServiceAssets.js","webpack://lib-js/./components/pryv/src/Service.js","webpack://lib-js/./components/pryv/src/lib/buildSearchParams.js","webpack://lib-js/./components/pryv/src/Auth/AuthStates.js","webpack://lib-js/./components/pryv/src/Auth/AuthController.js","webpack://lib-js/./components/pryv/src/Auth/index.js","webpack://lib-js/./components/pryv/src/Browser/LoginButton.js","webpack://lib-js/./components/pryv/src/lib/json-parser.js","webpack://lib-js/./components/pryv/src/lib/getEventStreamed.js","webpack://lib-js/./components/pryv/src/browser-index.js","webpack://lib-js/./components/pryv/src/lib/PryvError.js","webpack://lib-js/./components/pryv/src/Browser/CookieUtils.js","webpack://lib-js/./components/pryv/src/Connection.js","webpack://lib-js/./components/pryv/src/index.js","webpack://lib-js/./components/pryv/src/Auth/LoginMessages.js","webpack://lib-js/./components/pryv/src/Browser/index.js","webpack://lib-js/webpack/bootstrap","webpack://lib-js/webpack/runtime/global","webpack://lib-js/webpack/startup"],"sourcesContent":["/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst regexAPIandToken = /(.+):\\/\\/(.+)@(.+)/gm;\nconst regexSchemaAndPath = /(.+):\\/\\/(.+)/gm;\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * Utilities to access Pryv API.\n * @memberof pryv\n * @namespace pryv.utils\n */\nconst utils = module.exports = {\n  /**\n   * Perform a GET request and parse JSON response\n   * @param {string} url - URL to fetch\n   * @param {Object} [queryParams={}] - Query parameters to append\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchGet (url, queryParams = {}, headers = {}) {\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const myHeaders = Object.assign({ Accept: 'application/json' }, headers);\n    const response = await fetch(url + queryStr, { headers: myHeaders });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Perform a GET request and return text response\n   * @param {string} url - URL to fetch\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, text: string}>} Promise resolving to response and text body\n   */\n  async fetchGetText (url, headers = {}) {\n    const myHeaders = Object.assign({ Accept: 'text/html' }, headers);\n    const response = await fetch(url, { headers: myHeaders });\n    const text = await response.text();\n    return { response, text };\n  },\n\n  /**\n   * Perform a POST request with JSON data\n   * @param {string} url - URL to post to\n   * @param {Object} [data] - Data to send as JSON\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchPost (url, data, headers = {}) {\n    const myHeaders = Object.assign({\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    }, headers);\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: myHeaders,\n      body: JSON.stringify(data)\n    });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Returns true is run in a browser\n   * @memberof pryv.utils\n   * @returns {boolean}\n   */\n  isBrowser: function () {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n  },\n\n  /**\n   * From a APIEndpoint URL, return an object (TokenAndAPI) with two properties\n   * @memberof pryv.utils\n   * @param {APIEndpoint} apiEndpoint\n   * @returns {TokenAndEndpoint}\n   */\n  extractTokenAndAPIEndpoint: function (apiEndpoint) {\n    regexAPIandToken.lastIndex = 0;\n    const res = regexAPIandToken.exec(apiEndpoint);\n\n    if (res !== null) { // has token\n      // add a trailing '/' to end point if missing\n      if (!res[3].endsWith('/')) {\n        res[3] += '/';\n      }\n      return { endpoint: res[1] + '://' + res[3], token: res[2] };\n    }\n    // else check if valid url\n    regexSchemaAndPath.lastIndex = 0;\n    const res2 = regexSchemaAndPath.exec(apiEndpoint);\n    if (res2 === null) {\n      throw new Error('Cannot find endpoint, invalid URL format');\n    }\n    // add a trailing '/' to end point if missing\n    if (!res2[2].endsWith('/')) {\n      res2[2] += '/';\n    }\n\n    return { endpoint: res2[1] + '://' + res2[2], token: null };\n  },\n\n  /**\n   * Get a APIEndpoint URL from a TokenAndAPI object\n   * @memberof pryv.utils\n   * @param {TokenAndEndpoint} tokenAndAPI\n   * @returns {APIEndpoint}\n   */\n  buildAPIEndpoint: function (tokenAndAPI) {\n    if (!tokenAndAPI.token) {\n      let res = tokenAndAPI.endpoint + '';\n      if (!tokenAndAPI.endpoint.endsWith('/')) {\n        res += '/';\n      }\n      return res;\n    }\n    regexSchemaAndPath.lastIndex = 0;\n    const res = regexSchemaAndPath.exec(tokenAndAPI.endpoint);\n    // add a trailing '/' to end point if missing\n    if (!res[2].endsWith('/')) {\n      res[2] += '/';\n    }\n    return res[1] + '://' + tokenAndAPI.token + '@' + res[2];\n  },\n\n  /**\n   * Check if the browser is running on a mobile device or tablet\n   * @memberof pryv.utils\n   * @param {string|Navigator} [navigator] - Navigator object or user agent string (for testing)\n   * @returns {boolean} True if mobile or tablet\n   */\n  browserIsMobileOrTablet: function (navigator) {\n    if (navigator == null) {\n      return false;\n    }\n    let check = false;\n    // @ts-ignore - navigator is Navigator when not null\n    // eslint-disable-next-line no-useless-escape\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || navigator.opera);\n    return check;\n  },\n\n  /**\n   * Remove Pryv-specific query parameters from URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to clean\n   * @returns {string} URL without prYv* parameters\n   */\n  cleanURLFromPrYvParams: function (url) {\n    const PRYV_REGEXP = /[?#&]+prYv([^=&]+)=([^&]*)/g;\n    return url.replace(PRYV_REGEXP, '');\n  },\n\n  /**\n   * Extract query parameters from a URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to parse\n   * @returns {Object.<string, string>} Object with key-value pairs of query parameters\n   */\n  getQueryParamsFromURL: function (url) {\n    /** @type {Object.<string, string>} */\n    const vars = {};\n    const QUERY_REGEXP = /[?#&]+([^=&]+)=([^&]*)/g;\n    url.replace(QUERY_REGEXP,\n      // @ts-ignore - replace callback is used for side effects\n      function (m, key, value) {\n        vars[key] = decodeURIComponent(value);\n      });\n    return vars;\n  }\n};\n\n// TODO: remove following deprecated aliases with next major version\n\n/**\n * @deprecated Renamed to `extractTokenAndAPIEndpoint()`\n */\nutils.extractTokenAndApiEndpoint = utils.extractTokenAndAPIEndpoint;\n\n/**\n * @deprecated Renamed to `buildAPIEndpoint()`\n */\n// TODO: remove deprecated alias with next major version\nutils.buildPryvApiEndpoint = utils.buildAPIEndpoint;\n\n// --------------- typedfs ------------------------------- //\n\n/**\n * An object with two properties: token & apiEndpoint\n * @typedef {Object} TokenAndEndpoint\n * @property {string} [token] Authorization token\n * @property {string} endpoint url of API endpoint\n */\n\n/**\n * A String url of the form http(s)://{token}@{apiEndpoint}\n * @typedef {string} APIEndpoint\n */\n\n/**\n * Common Meta are returned by each standard call on the API https://api.pryv.com/reference/#in-method-results\n * @typedef {Object} CommonMeta\n * @property {string} apiVersion The version of the API in the form {major}.{minor}.{revision}. Mirrored in HTTP header API-Version.\n * @property {number} serverTime The current server time as a timestamp in second. Keeping track of server time is necessary to properly handle time in API calls.\n * @property {string} serial The serial will change every time the core or register is updated. If you compare it with the serial of a previous response and notice a difference, you should reload the service information.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n\n/* global location */\n\n/**\n * Holds Pryv Service informations.\n *\n * It's returned by `service.assets()`\n *\n * @memberof pryv\n **/\nclass ServiceAssets {\n  /**\n   * Private => use ServiceAssets.setup()\n   * @param {Object} assets The content of service/info.assets properties.\n   * @param {string} assetsURL Url point to assets of the service of a Pryv platform\n   */\n  constructor (assets, assetsURL) {\n    this._assets = assets;\n    this._assetsURL = assetsURL;\n  }\n\n  /**\n   * Load Assets definition from URL\n   * @param {string} pryvServiceAssetsSourceUrl - URL to the assets definition JSON\n   * @returns {Promise<ServiceAssets>} Promise resolving to ServiceAssets instance\n   */\n  static async setup (pryvServiceAssetsSourceUrl) {\n    const { body } = await utils.fetchGet(pryvServiceAssetsSourceUrl);\n    return new ServiceAssets(body, pryvServiceAssetsSourceUrl);\n  }\n\n  /**\n   * get a value from path separated by `:`\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  get (keyPath) {\n    let result = Object.assign({}, this._assets);\n    if (keyPath) {\n      keyPath.split(':').forEach((key) => {\n        result = result[key];\n        if (typeof result === 'undefined') return result;\n      });\n    }\n    return result;\n  }\n\n  /**\n   * get an Url from path separated by `:`\n   * identical to doing assets.relativeURL(assets.get(keyPath))\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  getUrl (keyPath) {\n    const url = this.get(keyPath);\n    if (typeof url !== 'string') {\n      throw new Error(`Unexpected value for ${keyPath}: ${url}`);\n    }\n    return this.relativeURL(url);\n  }\n\n  /**\n   * get relativeUrl\n   */\n  relativeURL (url) {\n    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);\n  }\n\n  // ---------------- Default service resources\n\n  /**\n   * Set all defaults Favicon, CSS\n   */\n  async setAllDefaults () {\n    this.setFavicon();\n    await this.loadCSS();\n  }\n\n  /**\n   * Set service Favicon to Web Page\n   */\n  setFavicon () {\n    /** @type {HTMLLinkElement} */\n    // @ts-ignore - querySelector returns Element but we know it's HTMLLinkElement\n    const link = document.querySelector(\"link[rel*='icon']\") || document.createElement('link');\n    link.type = 'image/x-icon';\n    link.rel = 'shortcut icon';\n    link.href = this.relativeURL(this._assets.favicon.default.url);\n    document.getElementsByTagName('head')[0].appendChild(link);\n  }\n\n  /**\n   * Set default service CSS\n   */\n  async loadCSS () {\n    loadCSS(this.relativeURL(this._assets.css.default.url));\n  }\n\n  // ---- Login\n\n  /**\n   * Load CSS for Login button\n   */\n  async loginButtonLoadCSS () {\n    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));\n  }\n\n  /**\n   * Get HTML for Login Button\n   * @returns {Promise<string>} Promise resolving to HTML string\n   */\n  async loginButtonGetHTML () {\n    const { text } = await utils.fetchGetText(this.relativeURL(this._assets['lib-js'].buttonSignIn.html));\n    return text;\n  }\n\n  /**\n   * Get Messages strings for Login Button\n   * @returns {Promise<Object.<string, string>>} Promise resolving to messages object\n   */\n  async loginButtonGetMessages () {\n    const { body } = await utils.fetchGet(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages));\n    return body;\n  }\n}\n\nmodule.exports = ServiceAssets;\n\nfunction loadCSS (url) {\n  const head = document.getElementsByTagName('head')[0];\n  const link = document.createElement('link');\n  link.id = url;\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n  link.media = 'all';\n  head.appendChild(link);\n}\n\n/* HACK: disabling linting until code is cleaned up */\n/* eslint-disable */\n\n  /*\\\n  |*| Modified version of\n  |*| :: translate relative paths to absolute paths ::\n  |*|\n  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n  |*|\n  |*| The following code is released under the GNU Public License, version 3 or later.\n  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html\n  |*|\n  \\*/\n\nfunction relPathToAbs (baseUrlString, sRelPath) {\n  /** @type {Location|HTMLAnchorElement} */\n  var baseLocation = location;\n  if (baseUrlString) {\n    // @ts-ignore - HTMLAnchorElement has compatible URL properties\n    baseLocation = document.createElement('a');\n    baseLocation.href = baseUrlString;\n  }\n\n  var nUpLn, sDir = \"\", sPath = baseLocation.pathname.replace(/[^\\/]*$/, sRelPath.replace(/(\\/|^)(?:\\.?\\/+)+/g, \"$1\"));\n  for (var nEnd, nStart = 0; nEnd = sPath.indexOf(\"/../\", nStart), nEnd > -1; nStart = nEnd + nUpLn) {\n    nUpLn = /^\\/(?:\\.\\.\\/)*/.exec(sPath.slice(nEnd))[0].length;\n    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp(\"(?:\\\\\\/+[^\\\\\\/]*){0,\" + ((nUpLn - 1) / 3) + \"}$\"),\n      \"/\");\n  }\n  const portStr = baseLocation.port ? ':' + baseLocation.port : '';\n  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n// Connection is required at the end of this file to allow circular requires.\nconst Assets = require('./ServiceAssets.js');\n\n/**\n * @class pryv.Service\n * A Pryv.io deployment is a unique \"Service\", as an example **Pryv Lab** is a service, deployed with the domain name **pryv.me**.\n *\n * `pryv.Service` exposes tools to interact with Pryv.io at a \"Platform\" level.\n *\n *  ##### Initizalization with a service info URL\n```js\nconst service = new pryv.Service('https://reg.pryv.me/service/info');\n```\n\n- With the content of a serviceInfo configuration\n\nService information properties can be overriden with specific values. This might be usefull to test new designs on production platforms.\n\n```js\nconst serviceInfoUrl = 'https://reg.pryv.me/service/info';\nconst serviceCustomizations = {\n  name: 'Pryv Lab 2',\n  assets: {\n    definitions: 'https://pryv.github.io/assets-pryv.me/index.json'\n  }\n}\nconst service = new pryv.Service(serviceInfoUrl, serviceCustomizations);\n```\n\n * @memberof pryv\n *\n * @constructor\n * @param {string} serviceInfoUrl Url point to /service/info of a Pryv platform see: {@link https://api.pryv.com/reference/#service-info}\n */\nclass Service {\n  constructor (serviceInfoUrl, serviceCustomizations) {\n    this._serviceInfo = null;\n    this._assets = null;\n    this._polling = false;\n    this._serviceInfoUrl = serviceInfoUrl;\n    this._pryvServiceCustomizations = serviceCustomizations;\n  }\n\n  /**\n   * Return service info parameters info known of fetch it if needed.\n   * Example\n   *  - name of a platform\n   *    `const serviceName = await service.info().name`\n   * @see ServiceInfo For details on available properties.\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceInfo>} Promise to Service info Object\n   */\n  async info (forceFetch) {\n    if (forceFetch || !this._serviceInfo) {\n      let baseServiceInfo = {};\n      if (this._serviceInfoUrl) {\n        const { body } = await utils.fetchGet(this._serviceInfoUrl);\n        baseServiceInfo = body;\n      }\n      Object.assign(baseServiceInfo, this._pryvServiceCustomizations);\n      // @ts-ignore - baseServiceInfo is populated from body or customizations\n      this.setServiceInfo(baseServiceInfo);\n    }\n    return this._serviceInfo;\n  }\n\n  /**\n   * Check if a service supports High Frequency Data Sets\n   * @returns {Promise<boolean>} Promise resolving to true if HF is supported\n   */\n  async supportsHF () {\n    const infos = await this.info();\n    return (infos.features == null || infos.features.noHF !== true);\n  }\n\n  /**\n   * Check if a service has username in the hostname or in the path of the API.\n   * @returns {Promise<boolean>} Promise resolving to true if the service does not rely on DNS to find a host related to a username\n   */\n  async isDnsLess () {\n    const infos = await this.info();\n    const hostname = infos.api.split('/')[2];\n    return !hostname.includes('{username}');\n  }\n\n  /**\n   * @private\n   * @param {ServiceInfo} serviceInfo\n   */\n  setServiceInfo (serviceInfo) {\n    if (!serviceInfo.name) {\n      throw new Error('Invalid data from service/info');\n    }\n    // cleanup serviceInfo for eventual url not finishing by \"/\"\n    // code will be obsolete with next version of register\n    ['access', 'api', 'register'].forEach((key) => {\n      if (serviceInfo[key].slice(-1) !== '/') {\n        serviceInfo[key] += '/';\n      }\n    });\n    this._serviceInfo = serviceInfo;\n  }\n\n  /**\n   * Return assets property content\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceAssets|null>} Promise to ServiceAssets\n   */\n  async assets (forceFetch) {\n    if (!forceFetch && this._assets) {\n      return this._assets;\n    } else {\n      const serviceInfo = await this.info();\n      if (!serviceInfo.assets || !serviceInfo.assets.definitions) {\n        console.log('Warning: no assets for this service');\n        return null;\n      }\n      this._assets = await Assets.setup(serviceInfo.assets.definitions);\n      return this._assets;\n    }\n  }\n\n  /**\n   * Return service info parameters info known or null if not yet loaded\n   * @returns {ServiceInfo} Service Info definition\n   */\n  infoSync () {\n    return this._serviceInfo;\n  }\n\n  /**\n   * Return an API endpoint from a username and token\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {Promise<APIEndpoint>} Promise resolving to the API endpoint URL\n   */\n  async apiEndpointFor (username, token) {\n    const serviceInfo = await this.info();\n    return Service.buildAPIEndpoint(serviceInfo, username, token);\n  }\n\n  /**\n   * Return an API endpoint from a username, token and ServiceInfo.\n   * This method is rarely used. See **apiEndpointFor** as an alternative.\n   * @param {ServiceInfo} serviceInfo - The service info object containing API URL template\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {APIEndpoint} The constructed API endpoint URL\n   */\n  static buildAPIEndpoint (serviceInfo, username, token) {\n    const endpoint = serviceInfo.api.replace('{username}', username);\n    return utils.buildAPIEndpoint({ endpoint, token });\n  }\n\n  /**\n   * Issue a \"login call on the Service\" return a Connection on success\n   * **! Warning**: the token of the connection will be a \"Personal\" token that expires\n   * @see https://api.pryv.com/reference-full/#login-user\n   * @param {string} username\n   * @param {string} password\n   * @param {string} appId\n   * @param {string} [originHeader=service-info.register] Only for Node.js. If not set will use the register value of service info. In browsers this will overridden by current page location.\n   * @throws {Error} on invalid login\n   */\n  async login (username, password, appId, originHeader) {\n    const apiEndpoint = await this.apiEndpointFor(username);\n\n    const headers = {};\n    originHeader = originHeader || (await this.info()).register;\n    if (!utils.isBrowser()) {\n      headers.Origin = originHeader;\n    }\n    const { response, body } = await utils.fetchPost(\n      apiEndpoint + 'auth/login',\n      { username, password, appId },\n      headers\n    );\n\n    if (!response.ok) {\n      if (body?.error?.message) {\n        throw new Error(body.error.message);\n      }\n      throw new Error('Login failed: ' + JSON.stringify(body));\n    }\n\n    if (!body.token) {\n      throw new Error('Invalid login response: ' + JSON.stringify(body));\n    }\n    return new Connection(\n      Service.buildAPIEndpoint(await this.info(), username, body.token),\n      this // Pre load Connection with service\n    );\n  }\n}\n\nmodule.exports = Service;\n\n// Require is done after exports to allow circular references\nconst Connection = require('./Connection');\n\n/**\n * Object to handle Pryv Service Informations https://api.pryv.com/reference/#service-info\n * @typedef {Object} ServiceInfo\n * @property {string} register The URL of the register service.\n * @property {string} access The URL of the access page.\n * @property {string} api The API endpoint format.\n * @property {string} name The platform name.\n * @property {string} home The URL of the platform's home page.\n * @property {string} support The email or URL of the support page.\n * @property {string} terms The terms and conditions, in plain text or the URL displaying them.\n * @property {string} eventTypes The URL of the list of validated event types.\n * @property {Object} [assets] Holder for service specific Assets (icons, css, ...)\n * @property {string} [assets.definitions] URL to json object with assets definitions\n * @property {Object} [features] Platform feature flags\n * @property {boolean} [features.noHF] True if HF data is not supported\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Build URL search params string from an object, properly handling arrays.\n * Arrays are expanded as repeated keys: { a: ['x', 'y'] } => 'a=x&a=y'\n * @param {Object} params - Query parameters object\n * @returns {string} - URL encoded query string\n */\nfunction buildSearchParams (params) {\n  const searchParams = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (Array.isArray(value)) {\n      for (const item of value) {\n        searchParams.append(key, item);\n      }\n    } else if (value !== undefined && value !== null) {\n      searchParams.append(key, value);\n    }\n  }\n  return searchParams.toString();\n}\n\nmodule.exports = buildSearchParams;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * The possible auth states:\n * ERROR, LOADING, INITIALIZED, NEED_SIGNIN, AUTHORIZED, SIGNOUT, REFUSED\n * @readonly\n * @enum {string}\n * @memberof pryv.Browser\n */\nmodule.exports = {\n  ERROR: 'ERROR',\n  LOADING: 'LOADING',\n  INITIALIZED: 'INITIALIZED',\n  NEED_SIGNIN: 'NEED_SIGNIN',\n  AUTHORIZED: 'ACCEPTED',\n  SIGNOUT: 'SIGNOUT',\n  REFUSED: 'REFUSED'\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('../utils');\nconst AuthStates = require('./AuthStates');\nconst Messages = require('./LoginMessages');\n\n/**\n * Controller for authentication flow\n * @memberof pryv.Auth\n */\nclass AuthController {\n  /**\n   * Create an AuthController\n   * @param {AuthSettings} settings - Authentication settings\n   * @param {Service} service - Pryv service instance\n   * @param {CustomLoginButton} loginButton - Login button implementation\n   */\n  constructor (settings, service, loginButton) {\n    this.settings = settings;\n    validateSettings.call(this, settings);\n\n    this.stateChangeListeners = [];\n    if (this.settings.onStateChange) {\n      this.stateChangeListeners.push(this.settings.onStateChange);\n    }\n    this.service = service;\n\n    // probably remove\n    this.languageCode = this.settings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n\n    this.loginButton = loginButton;\n\n    function validateSettings (settings) {\n      if (!settings) { throw new Error('settings cannot be null'); }\n      // -- settings\n      if (!settings.authRequest) { throw new Error('Missing settings.authRequest'); }\n\n      // -- Extract returnURL\n      settings.authRequest.returnURL =\n        this.getReturnURL(settings.authRequest.returnURL);\n\n      if (!settings.authRequest.requestingAppId) {\n        throw new Error('Missing settings.authRequest.requestingAppId');\n      }\n      if (!settings.authRequest.requestedPermissions) {\n        throw new Error('Missing settings.authRequest.requestedPermissions');\n      }\n    }\n  }\n\n  /**\n   * Initialize the auth controller. Call this right after instantiation.\n   * @returns {Promise<Service>} Promise resolving to the Service instance\n   */\n  async init () {\n    this.serviceInfo = this.service.infoSync();\n    this.state = { status: AuthStates.LOADING };\n    this.assets = await loadAssets(this);\n\n    const loginButton = this.loginButton;\n    // initialize human interaction interface\n    if (loginButton != null) {\n      this.stateChangeListeners.push(loginButton.onStateChange.bind(loginButton));\n      // autologin needs cookies/storage implemented in human interaction interface\n      await checkAutoLogin(this);\n    }\n\n    // if auto login is not prompted\n    if (this.state.status !== AuthStates.AUTHORIZED) {\n      this.state = { status: AuthStates.INITIALIZED, serviceInfo: this.serviceInfo };\n    }\n\n    if (loginButton != null && loginButton.finishAuthProcessAfterRedirection != null) {\n      // @ts-ignore - this is a valid AuthController\n      await loginButton.finishAuthProcessAfterRedirection(this);\n    }\n\n    return this.service;\n  }\n\n  /**\n   * Stops poll for auth request\n   */\n  stopAuthRequest (msg) {\n    this.state = { status: AuthStates.ERROR, message: msg };\n  }\n\n  /**\n   * Handle button click - triggers appropriate action based on current state\n   * @returns {Promise<void>}\n   */\n  async handleClick () {\n    if (isAuthorized.call(this)) {\n      this.state = { status: AuthStates.SIGNOUT };\n    } else if (isInitialized.call(this)) {\n      this.startAuthRequest();\n    } else if (isNeedSignIn.call(this)) {\n      // reopen popup (HACK for now: set to private property to avoid self-assignment)\n      this.state = this._state;\n    } else {\n      console.log('Unhandled action in \"handleClick()\" for status:', this.state.status);\n    }\n\n    function isAuthorized () {\n      return this.state.status === AuthStates.AUTHORIZED;\n    }\n    function isInitialized () {\n      return this.state.status === AuthStates.INITIALIZED;\n    }\n    function isNeedSignIn () {\n      return this.state.status === AuthStates.NEED_SIGNIN;\n    }\n  }\n\n  /**\n   * Compute the return URL for authentication redirect.\n   * Used only in browser environments.\n   * @param {string} [returnURL] - The return URL setting ('auto#', 'self#', or custom URL)\n   * @param {string} [windowLocationForTest] - Mock window.location.href for testing\n   * @param {string|Navigator} [navigatorForTests] - Mock navigator for testing\n   * @returns {string|boolean} The computed return URL, or false if using popup mode\n   */\n  getReturnURL (\n    returnURL,\n    windowLocationForTest,\n    navigatorForTests\n  ) {\n    const RETURN_URL_AUTO = 'auto';\n\n    returnURL = returnURL || RETURN_URL_AUTO + '#';\n\n    // check the trailer\n    const trailer = returnURL.slice(-1);\n    if ('#&?'.indexOf(trailer) < 0) {\n      throw new Error('Pryv access: Last character of --returnURL setting-- is not ' +\n        '\"?\", \"&\" or \"#\": ' + returnURL);\n    }\n    // auto mode for desktop\n    if (returnUrlIsAuto(returnURL) &&\n        !utils.browserIsMobileOrTablet(navigatorForTests)) {\n      return false;\n    // auto mode for mobile or self\n    } else if ((returnUrlIsAuto(returnURL) &&\n                utils.browserIsMobileOrTablet(navigatorForTests)) ||\n               returnURL.indexOf('self') === 0) {\n      // set self as return url?\n      // eventually clean-up current url from previous pryv returnURL\n      const locationHref = windowLocationForTest || window.location.href;\n      returnURL = locationHref + returnURL.substring(4);\n    }\n    return utils.cleanURLFromPrYvParams(returnURL);\n\n    function returnUrlIsAuto (returnURL) {\n      return returnURL.indexOf(RETURN_URL_AUTO) === 0;\n    }\n  }\n\n  /**\n   * Start the authentication request and polling process\n   * @returns {Promise<void>}\n   * @see https://pryv.github.io/reference/#auth-request\n   */\n  async startAuthRequest () {\n    // @ts-ignore - postAccess uses .call(this) for context\n    this.state = await postAccess.call(this);\n\n    await doPolling.call(this);\n\n    /** @this {AuthController} */\n    async function postAccess () {\n      try {\n        const { response, body } = await utils.fetchPost(\n          // @ts-ignore - this is bound via .call()\n          this.serviceInfo.access,\n          // @ts-ignore - this is bound via .call()\n          this.settings.authRequest\n        );\n        if (!response.ok) {\n          throw new Error('Access request failed: ' + JSON.stringify(body));\n        }\n        return body;\n      } catch (e) {\n        this.state = {\n          status: AuthStates.ERROR,\n          message: 'Requesting access',\n          error: e\n        };\n        throw e; // forward error\n      }\n    }\n\n    /** @this {AuthController} */\n    async function doPolling () {\n      // @ts-ignore - this is bound via .call()\n      if (this.state?.status !== AuthStates.NEED_SIGNIN) {\n        return;\n      }\n      // @ts-ignore - this is bound via .call()\n      const pollResponse = await pollAccess(this.state?.poll);\n\n      if (pollResponse.status === AuthStates.NEED_SIGNIN) {\n        // @ts-ignore - this is bound via .call()\n        setTimeout(await doPolling.bind(this), this.state?.poll_rate_ms);\n      } else {\n        this.state = pollResponse;\n      }\n\n      async function pollAccess (pollUrl) {\n        try {\n          const { response, body } = await utils.fetchGet(pollUrl);\n          if (response.status === 403 && body?.status === 'REFUSED') {\n            return { status: AuthStates.INITIALIZED };\n          }\n          return body;\n        } catch (e) {\n          return { status: AuthStates.ERROR, message: 'Error while polling for auth request', error: e };\n        }\n      }\n    }\n  }\n\n  // -------------- state listeners ---------------------\n  set state (newState) {\n    // retro-compatibility for lib-js < 2.0.9\n    newState.id = newState.status;\n\n    this._state = newState;\n\n    this.stateChangeListeners.forEach((listener) => {\n      try {\n        listener(this.state);\n      } catch (e) {\n        console.log('Error during set state ()', e);\n      }\n    });\n  }\n\n  get state () {\n    return this._state;\n  }\n}\n\n// ----------- private methods -------------\n\nasync function checkAutoLogin (authController) {\n  const loginButton = authController.loginButton;\n  if (loginButton == null) {\n    return;\n  }\n\n  const storedCredentials = await loginButton.getAuthorizationData();\n  if (storedCredentials != null) {\n    authController.state = Object.assign({}, { status: AuthStates.AUTHORIZED }, storedCredentials);\n  }\n}\n\n// ------------------ ACTIONS  ----------- //\n\nasync function loadAssets (authController) {\n  let loadedAssets = {};\n  try {\n    loadedAssets = await authController.service.assets();\n    if (typeof location !== 'undefined') {\n      await loadedAssets.loginButtonLoadCSS();\n      const thisMessages = await loadedAssets.loginButtonGetMessages();\n      if (thisMessages.LOADING) {\n        authController.messages = Messages(authController.languageCode, thisMessages);\n      } else {\n        console.log('WARNING Messages cannot be loaded using defaults: ', thisMessages);\n      }\n    }\n  } catch (e) {\n    authController.state = {\n      status: AuthStates.ERROR,\n      message: 'Cannot fetch button visuals',\n      error: e\n    };\n    throw e; // forward error\n  }\n  return loadedAssets;\n}\n\nmodule.exports = AuthController;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst AuthController = require('./AuthController');\nconst AuthStates = require('./AuthStates');\nconst LoginButton = require('../Browser/LoginButton');\nconst Service = require('../Service');\n\n/**\n * @memberof pryv\n * @namespace pryv.Auth\n */\nmodule.exports = {\n  setupAuth,\n  AuthStates,\n  AuthController\n};\n\n/**\n * Start an authentication process\n *\n * @memberof pryv.Auth\n * @param {Object} settings\n * @param {Object} settings.authRequest See https://api.pryv.com/reference/#data-structure-access\n * @param {string} [settings.authRequest.languageCode] Language code, as per LoginButton Messages: 'en', 'fr\n * @param {string} settings.authRequest.requestingAppId Application id, ex: 'my-app'\n * @param {Object} settings.authRequest.requestedPermissions\n * @param {string | boolean} settings.authRequest.returnURL : false, // set this if you don't want a popup\n * @param {string} [settings.authRequest.referer] To track registration source\n * @param {string} settings.spanButtonID set and <span> id in DOM to insert default login button or null for custom\n * @param {Function} settings.onStateChange\n * @param {string} [settings.returnURL] Set to \"self#\" to disable popup and force using the same page\n * @param {string} serviceInfoUrl\n * @param {Object} [serviceCustomizations] override properties of serviceInfoUrl\n * @returns {Promise<Service>}\n */\nasync function setupAuth (settings, serviceInfoUrl, serviceCustomizations, HumanInteraction = LoginButton) {\n  const service = new Service(serviceInfoUrl, serviceCustomizations);\n  await service.info();\n\n  const humanInteraction = new HumanInteraction(settings, service);\n  await humanInteraction.init();\n\n  return service;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Cookies = require('./CookieUtils');\nconst AuthStates = require('../Auth/AuthStates');\nconst AuthController = require('../Auth/AuthController');\nconst Messages = require('../Auth/LoginMessages');\nconst utils = require('../utils');\n\n/* global location, confirm */\n\n/**\n * @memberof pryv.Browser\n */\nclass LoginButton {\n  constructor (authSettings, service) {\n    this.authSettings = authSettings;\n    this.service = service;\n    this.serviceInfo = service.infoSync();\n  }\n\n  /**\n   * setup button and load assets\n   */\n  async init () {\n    // initialize button visuals\n    setupButton(this);\n    this.languageCode = this.authSettings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      await loadAssets(this);\n    }\n    // set cookie key for authorization data\n    this._cookieKey = 'pryv-libjs-' + this.authSettings.authRequest.requestingAppId;\n\n    // initialize controller\n    this.auth = new AuthController(this.authSettings, this.service, this);\n    await this.auth.init();\n\n    return this.service;\n  }\n\n  onClick () {\n    this.auth.handleClick();\n  }\n\n  async onStateChange (state) {\n    switch (state.status) {\n      case AuthStates.LOADING:\n        this.text = getLoadingMessage(this);\n        break;\n      case AuthStates.INITIALIZED:\n        this.text = getInitializedMessage(this, this.serviceInfo.name);\n        break;\n      case AuthStates.NEED_SIGNIN: {\n        const loginUrl = state.authUrl || state.url; // url is deprecated\n        if (this.authSettings.authRequest.returnURL) { // open on same page (no Popup)\n          location.href = loginUrl;\n          return;\n        } else {\n          startLoginScreen(this, loginUrl);\n        }\n        break;\n      }\n      case AuthStates.AUTHORIZED:\n        this.text = state.username;\n        this.saveAuthorizationData({\n          apiEndpoint: state.apiEndpoint,\n          username: state.username\n        });\n        break;\n      case AuthStates.SIGNOUT: {\n        const message = this.messages.SIGNOUT_CONFIRM ? this.messages.SIGNOUT_CONFIRM : 'Logout ?';\n        if (confirm(message)) {\n          this.deleteAuthorizationData();\n          this.auth.init();\n        }\n        break;\n      }\n      case AuthStates.ERROR:\n        this.text = getErrorMessage(this, state.message);\n        break;\n      default:\n        console.log('WARNING Unhandled state for Login: ' + state.status);\n    }\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      // @ts-ignore\n      this.loginButtonText.innerHTML = this.text;\n    }\n  }\n\n  getAuthorizationData () {\n    return Cookies.get(this._cookieKey);\n  }\n\n  saveAuthorizationData (authData) {\n    Cookies.set(this._cookieKey, authData);\n  }\n\n  async deleteAuthorizationData () {\n    Cookies.del(this._cookieKey);\n  }\n\n  /**\n   * not mandatory to implement as non-browsers don't have this behaviour\n   * @param {*} authController\n   */\n  async finishAuthProcessAfterRedirection (authController) {\n    // this step should be applied only for the browser\n    if (!utils.isBrowser()) return;\n\n    // 3. Check if there is a prYvkey as result of \"out of page login\"\n    const url = window.location.href;\n    const pollUrl = retrievePollUrl(url);\n    if (pollUrl !== null) {\n      try {\n        const { body } = await utils.fetchGet(pollUrl);\n        authController.state = body;\n      } catch (e) {\n        authController.state = {\n          status: AuthStates.ERROR,\n          message: 'Cannot fetch result',\n          error: e\n        };\n      }\n    }\n\n    function retrievePollUrl (url) {\n      const params = utils.getQueryParamsFromURL(url);\n      let pollUrl = null;\n      if (params.prYvkey) { // deprecated method - To be removed\n        pollUrl = authController.serviceInfo.access + params.prYvkey;\n      }\n      if (params.prYvpoll) {\n        pollUrl = params.prYvpoll;\n      }\n      return pollUrl;\n    }\n  }\n}\n\nmodule.exports = LoginButton;\n\nasync function startLoginScreen (loginButton, authUrl) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n  const width = 400;\n  const height = 620;\n  const left = Math.floor(screenX + ((outerWidth - width) / 2));\n  const top = Math.floor(screenY + ((outerHeight - height) / 2.5));\n  const features = (\n    'width=' + width +\n    ',height=' + height +\n    ',left=' + left +\n    ',top=' + top +\n    ',scrollbars=yes'\n  );\n  loginButton.popup = window.open(authUrl, 'prYv Sign-in', features);\n\n  if (!loginButton.popup) {\n    // loginButton.auth.stopAuthRequest('FAILED_TO_OPEN_WINDOW');\n    console.log('Pop-up blocked. A second click should allow it.');\n  } else if (window.focus) {\n    loginButton.popup.focus();\n  }\n}\n\nfunction setupButton (loginBtn) {\n  loginBtn.loginButtonSpan = document.getElementById(loginBtn.authSettings.spanButtonID);\n\n  if (!loginBtn.loginButtonSpan) {\n    console.log('WARNING: pryv.Browser initialized with no spanButtonID');\n  } else {\n    // up to the time the button is loaded use the Span to display eventual\n    // error messages\n    loginBtn.loginButtonText = loginBtn.loginButtonSpan;\n\n    // bind actions dynamically to the button click\n    loginBtn.loginButtonSpan.addEventListener('click', loginBtn.onClick.bind(loginBtn));\n  }\n}\n\n/**\n * Loads the style from the service info\n */\nasync function loadAssets (loginBtn) {\n  const assets = await loginBtn.service.assets();\n  loginBtn.loginButtonSpan.innerHTML = await assets.loginButtonGetHTML();\n  loginBtn.loginButtonText = document.getElementById('pryv-access-btn-text');\n}\n\nfunction getErrorMessage (loginButton, message) {\n  return loginButton.messages.ERROR + ': ' + message;\n}\n\nfunction getLoadingMessage (loginButton) {\n  return loginButton.messages.LOADING;\n}\n\nfunction getInitializedMessage (loginButton, serviceName) {\n  return loginButton.messages.LOGIN + ': ' + serviceName;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// there two steps 1 find events, then eventDeletions\nconst EVENTMARKERS = ['\"events\":[', '\"eventDeletions\":['];\n\n/**\n * Stremed JSON parser for events\n */\nmodule.exports = function (foreachEvent, includeDeletions) {\n  let eventOrEventDeletions = 0; // start with event\n  let buffer = ''; // temp data\n  let body = null; // to be returned\n\n  // IN EVENTS VARS\n  let depth = 0; // level of depth in brackets\n  let inString = false; // cursor is in a String\n  let skipNextOne = false; // when a backslash is found\n  let cursorPos = 0; // position of Character Cursor\n\n  // counters\n  let eventsCount = 0;\n  let eventDeletionsCount = 0;\n\n  const states = {\n    A_BEFORE_EVENTS: 0,\n    B_IN_EVENTS: 1,\n    D_AFTER_EVENTS: 2\n  };\n\n  let state = states.A_BEFORE_EVENTS;\n\n  function processBuffer () {\n    switch (state) {\n      case states.A_BEFORE_EVENTS:\n        searchStartEvents();\n        break;\n      case states.B_IN_EVENTS:\n        processEvents();\n        break;\n      default:\n        afterEvents();\n        break;\n    }\n  }\n\n  function searchStartEvents () {\n    // search for \"events\": and happend any info before to the body\n    const n = buffer.indexOf(EVENTMARKERS[eventOrEventDeletions]);\n    if (n > 0) {\n      if (eventOrEventDeletions === 0) { // do only once\n        body = buffer.substring(0, n);\n      }\n      buffer = buffer.substr(n + EVENTMARKERS[eventOrEventDeletions].length);\n      state = states.B_IN_EVENTS;\n      processEvents();\n    }\n  }\n\n  function processEvents () {\n    /// ---- in Event\n    while (cursorPos < buffer.length && (state === states.B_IN_EVENTS)) {\n      if (skipNextOne) { // ignore next character\n        skipNextOne = false;\n        cursorPos++;\n        continue;\n      }\n      switch (buffer.charCodeAt(cursorPos)) {\n        case 93: // ]\n          if (depth === 0) { // end of events\n            if (cursorPos !== 0) {\n              throw new Error('Found trailling ] in mid-course');\n            }\n            if (eventOrEventDeletions === 0 && includeDeletions) {\n              state = states.A_BEFORE_EVENTS;\n              eventOrEventDeletions = 1; // now look for eventDeletions\n              return;\n            } else { // done\n              state = states.D_AFTER_EVENTS;\n              let eventsOrDeletionMsg = '';\n              if (eventOrEventDeletions === 1) {\n                eventsOrDeletionMsg = '\"eventDeletionsCount\":' + eventDeletionsCount + ',';\n              }\n              buffer = eventsOrDeletionMsg + '\"eventsCount\":' + eventsCount + '' + buffer.substr(1);\n            }\n          }\n          break;\n        case 92: // \\\n          skipNextOne = true;\n          break;\n        case 123: // {\n          if (!inString) depth++;\n          break;\n        case 34: // \"\n          inString = !inString;\n          break;\n        case 125: // }\n          if (!inString) depth--;\n          if (depth === 0) {\n            // ignore possible coma ',' if first char\n            const ignoreComa = (buffer.charCodeAt(0) === 44) ? 1 : 0;\n            const eventStr = buffer.substring(ignoreComa, cursorPos + 1);\n\n            if (eventOrEventDeletions === 0) {\n              eventsCount++;\n            } else {\n              eventDeletionsCount++;\n            }\n            buffer = buffer.substr(cursorPos + 1);\n            addEvent(eventStr);\n            cursorPos = -1;\n          }\n          break;\n      }\n      cursorPos++;\n    }\n  }\n\n  function afterEvents () {\n    // just happend the end of message;\n    body += buffer;\n    buffer = '';\n  }\n\n  return function (res, fn) {\n    res.setEncoding('utf8'); // Already UTF8 in browsers\n    res.on('data', chunk => {\n      buffer += chunk;\n      processBuffer();\n    });\n    res.on('end', () => {\n      let err;\n      let bodyObject;\n      try {\n        res.text = body + buffer;\n        bodyObject = res.text && JSON.parse(res.text);\n      } catch (err_) {\n        err = err_;\n        // issue #675: return the raw response if the response parsing fails\n        err.rawResponse = res.text || null;\n        // issue #876: return the http status code if the response parsing fails\n        err.statusCode = res.statusCode;\n      } finally {\n        fn(err, bodyObject);\n      }\n    });\n  };\n\n  /// --- Direct Push\n  function addEvent (strEvent) {\n    foreachEvent(JSON.parse(strEvent));\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/* global fetch */\n\nconst buildSearchParams = require('./buildSearchParams');\n\nmodule.exports = getEventStreamed;\n\nasync function getEventStreamed (conn, queryParam, parser) {\n  /**\n   * Holds Parser's settings\n   */\n  const parserSettings = {\n    ondata: null,\n    onend: null,\n    encoding: 'utf8'\n  };\n\n  /**\n   * Mock Response\n   */\n  const fakeRes = {\n    setEncoding: function (encoding) {\n      parserSettings.encoding = encoding;\n    }, // will receive 'data' and 'end' callbacks\n    on: function (key, f) {\n      parserSettings['on' + key] = f;\n    }\n  };\n\n  /**\n   * Holds results from the parser\n   */\n  let errResult;\n  let bodyObjectResult;\n  /**\n   *\n   */\n  parser(fakeRes, function (err, bodyObject) {\n    errResult = err;\n    bodyObjectResult = bodyObject;\n  });\n\n  // ------------   fetch ------------------- //\n  const url = new URL(conn.endpoint + 'events');\n  url.search = buildSearchParams(queryParam);\n  const fetchParams = { method: 'GET', headers: { Accept: 'application/json' } };\n  if (conn.token) fetchParams.headers.Authorization = conn.token;\n\n  const response = await fetch(url, fetchParams);\n  const reader = response.body.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    parserSettings.ondata(new TextDecoder(parserSettings.encoding).decode(value));\n    if (done) { parserSettings.onend(); break; }\n  }\n\n  if (errResult) {\n    throw new Error(errResult);\n  }\n\n  // We're done!\n  const result = {\n    text: fakeRes.text, // from the parser\n    body: bodyObjectResult, // from the parser\n    statusCode: response.status,\n    headers: {}\n  };\n  // add headers to result\n  // @ts-ignore - Headers.entries() exists in modern environments\n  for (const pair of response.headers.entries()) {\n    result.headers[pair[0]] = pair[1];\n  }\n\n  return result;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// make lib available as `Pryv` (with capital P, deprecated) for backward-compatibility with apps importing via <script>\n// TODO: remove deprecated alias with next major version\nmodule.exports = global.Pryv = require('./index');\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Custom error class for Pryv library errors.\n * Includes an innerObject property for wrapping underlying errors.\n * @extends Error\n */\nclass PryvError extends Error {\n  /**\n   * Create a PryvError\n   * @param {string} message - Error message\n   * @param {Error|Object} [innerObject] - The underlying error or object that caused this error\n   */\n  constructor (message, innerObject) {\n    super(message);\n    this.name = 'PryvError';\n    /** @type {Error|Object|undefined} */\n    this.innerObject = innerObject;\n\n    // Maintains proper stack trace for where error was thrown (only in V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, PryvError);\n    }\n  }\n}\n\nmodule.exports = PryvError;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst utils = require('../utils');\n\n/**\n * @memberof pryv.Browser\n * @namespace pryv.Browser.CookieUtils\n */\nmodule.exports = {\n  get,\n  set,\n  del\n};\n\n/**\n  * Set a local cookie\n  * @memberof pryv.Browser.CookieUtils\n  * @template T\n  * @param {string} cookieKey - The key for the cookie\n  * @param {T} value - The value (will be JSON stringified)\n  * @param {number} [expireInDays=365] - Expiration date in days from now\n  */\nfunction set (cookieKey, value, expireInDays) {\n  if (!utils.isBrowser()) return;\n  expireInDays = expireInDays || 365;\n  const myDate = new Date();\n  const hostName = window.location.hostname;\n  const path = window.location.pathname;\n  myDate.setDate(myDate.getDate() + expireInDays);\n  let cookieStr = encodeURIComponent(cookieKey) + '=' +\n    encodeURIComponent(JSON.stringify(value)) +\n    ';expires=' + myDate.toUTCString() +\n    ';domain=.' + hostName + ';path=' + path;\n  // do not add SameSite when removing a cookie\n  if (expireInDays >= 0) cookieStr += ';SameSite=Strict';\n  document.cookie = cookieStr;\n}\n\n/**\n * Return the value of a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @template T\n * @param {string} cookieKey - The key\n * @returns {T|undefined} The parsed cookie value or undefined if not found\n */\nfunction get (cookieKey) {\n  const name = encodeURIComponent(cookieKey);\n  if (!utils.isBrowser()) return;\n  const value = '; ' + document.cookie;\n  const parts = value.split('; ' + name + '=');\n  if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));\n}\n\n/**\n * Delete a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @param {string} cookieKey - The key\n */\nfunction del (cookieKey) {\n  set(cookieKey, { deleted: true }, -1);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\nconst jsonParser = require('./lib/json-parser');\nconst libGetEventStreamed = require('./lib/getEventStreamed');\nconst PryvError = require('./lib/PryvError');\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * @class Connection\n * A connection is an authenticated link to a Pryv.io account.\n *\n * @type {TokenAndEndpoint}\n *\n * @example\n * create a connection for the user 'tom' on 'pryv.me' backend with the token 'TTZycvBTiq'\n * const conn = new pryv.Connection('https://TTZycvBTiq@tom.pryv.me');\n *\n * @property {string} [token]\n * @property {string} endpoint\n * @memberof pryv\n *\n * @constructor\n * @this {Connection}\n * @param {APIEndpoint} apiEndpoint\n * @param {pryv.Service} [service] - eventually initialize Connection with a Service\n */\nclass Connection {\n  constructor (apiEndpoint, service) {\n    const { token, endpoint } = utils.extractTokenAndAPIEndpoint(apiEndpoint);\n    this.token = token;\n    this.endpoint = endpoint;\n    this.options = {};\n    this.options.chunkSize = 1000;\n    this._deltaTime = { value: 0, weight: 0 };\n    if (service && !(service instanceof Service)) {\n      throw new Error('Invalid service param');\n    }\n    this._service = service;\n  }\n\n  /**\n   * get pryv.Service object relative to this connection\n   * @readonly\n   * @property {pryv.Service} service\n   */\n  get service () {\n    if (this._service) return this._service;\n    this._service = new Service(this.endpoint + 'service/info');\n    return this._service;\n  }\n\n  /**\n   * Get username for this connection.\n   * It's async as it's constructed from access info.\n   * @returns {Promise<string>} Promise resolving to the username\n   */\n  async username () {\n    const accessInfo = await this.accessInfo();\n    if (accessInfo.error) {\n      throw new PryvError(\n        'Failed fetching accessinfo: ' + accessInfo.error.message,\n        accessInfo.error\n      );\n    }\n    // @ts-ignore - username is always a string\n    return accessInfo.user.username;\n  }\n\n  /**\n   * Get access info for this connection.\n   * It's async as it is fetched from the API.\n   * @returns {Promise<AccessInfo>} Promise resolving to the access info\n   */\n  async accessInfo () {\n    return this.get('access-info', null);\n  }\n\n  /**\n   * Issue a Batch call https://api.pryv.com/reference/#call-batch .\n   * arrayOfAPICalls will be splited in multiple calls if the size is > `conn.options.chunkSize` .\n   * Default chunksize is 1000.\n   * @param {Array.<MethodCall>} arrayOfAPICalls Array of Method Calls\n   * @param {Function} [progress] Return percentage of progress (0 - 100);\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    function httpHandler (batchCall) {\n      return this.post('', batchCall);\n    }\n    return await this._chunkedBatchCall(\n      arrayOfAPICalls,\n      progress,\n      httpHandler.bind(this)\n    );\n  }\n\n  /**\n   * Make one API call\n   * @param {string} method - Method ID (e.g., 'events.get', 'streams.create')\n   * @param {Object|Array} [params={}] - The params associated with this method\n   * @param {string} [expectedKey] - If given, returns the value of this key or throws an error if not present\n   * @returns {Promise<Object>} Promise resolving to the API result or the value of expectedKey\n   * @throws {Error} If .error is present in the response or expectedKey is missing\n   */\n  async apiOne (method, params = {}, expectedKey) {\n    const result = await this.api([{ method, params }]);\n    if (\n      result[0] == null ||\n      result[0].error ||\n      (expectedKey != null && result[0][expectedKey] == null)\n    ) {\n      const innerObject = result[0]?.error || result;\n      throw new PryvError(\n        `Error for api method: \"${method}\" with params: ${JSON.stringify(\n          params\n        )} >> Result: ${JSON.stringify(innerObject)}\"`,\n        innerObject\n      );\n    }\n    if (expectedKey != null) return result[0][expectedKey];\n    return result[0];\n  }\n\n  /**\n   * Revoke : Delete the accessId\n   * - Do not throw error if access is already revoked, just return null;\n   * @param {boolean} [throwOnFail=true] - if set to false do not throw Error on failure\n   * @param {Connection} [usingConnection] - specify which connection issues the revoke, might be necessary when selfRevoke\n   * @returns {Promise<Object|null>} Promise resolving to deletion result or null if already revoked/failed\n   */\n  async revoke (throwOnFail = true, usingConnection) {\n    usingConnection = usingConnection || this;\n    let accessInfo = null;\n    // get accessId\n    try {\n      accessInfo = await this.accessInfo();\n    } catch (e) {\n      if (e.response?.body?.error?.id === 'invalid-access-token') {\n        return null; // Already revoked OK..\n      }\n      if (throwOnFail) throw e;\n      return null;\n    }\n    // delete access\n    try {\n      const result = usingConnection.apiOne('accesses.delete', {\n        id: accessInfo.id\n      });\n      return result;\n    } catch (e) {\n      if (throwOnFail) throw e;\n      return null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  async _chunkedBatchCall (arrayOfAPICalls, progress, callHandler) {\n    if (!Array.isArray(arrayOfAPICalls)) {\n      throw new Error('Connection.api() takes an array as input');\n    }\n\n    const res = [];\n    let percent = 0;\n    for (\n      let cursor = 0;\n      arrayOfAPICalls.length >= cursor;\n      cursor += this.options.chunkSize\n    ) {\n      const thisBatch = [];\n      const cursorMax = Math.min(\n        cursor + this.options.chunkSize,\n        arrayOfAPICalls.length\n      );\n      // copy only method and params into a back call to be exuted\n      for (let i = cursor; i < cursorMax; i++) {\n        thisBatch.push({\n          method: arrayOfAPICalls[i].method,\n          params: arrayOfAPICalls[i].params\n        });\n      }\n      const resRequest = await callHandler(thisBatch);\n      // result checks\n      if (!resRequest || !Array.isArray(resRequest.results)) {\n        throw new Error(\n          'API call result is not an Array: ' + JSON.stringify(resRequest)\n        );\n      }\n      if (resRequest.results.length !== thisBatch.length) {\n        throw new Error(\n          'API call result Array does not match request: ' +\n            JSON.stringify(resRequest)\n        );\n      }\n\n      // eventually call handleResult\n      for (let i = 0; i < resRequest.results.length; i++) {\n        if (arrayOfAPICalls[i + cursor].handleResult) {\n          await arrayOfAPICalls[i + cursor].handleResult.call(\n            null,\n            resRequest.results[i],\n            thisBatch[i] // request\n          );\n        }\n      }\n      Array.prototype.push.apply(res, resRequest.results);\n      percent = Math.round((100 * res.length) / arrayOfAPICalls.length);\n      if (progress) {\n        progress(percent, res);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Post to API and return results\n   * @param {string} path - API path\n   * @param {(Array | Object)} data - Data to post\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async post (path, data) {\n    const now = getTimestamp();\n    const res = await this._postFetch(path, data);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Post object as JSON to API\n   * @param {string} path - API path\n   * @param {Array | Object} data - Data to post as JSON\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetch (path, data) {\n    return this._postFetchRaw(path, JSON.stringify(data), 'application/json');\n  }\n\n  /**\n   * @private\n   * Raw Post to API\n   * @param {string} path - API path\n   * @param {any} data - Raw data to post\n   * @param {string} [contentType] - Content-Type header (optional, allows fetch to set it for FormData)\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetchRaw (path, data, contentType) {\n    const headers = {\n      Authorization: this.token,\n      Accept: 'application/json'\n    };\n    // optional for form-data llowing fetch to\n    // automatically set multipart/form-data with the correct boundary\n    if (contentType) {\n      headers['Content-Type'] = contentType;\n    }\n    const response = await fetch(this.endpoint + path, {\n      method: 'POST',\n      headers,\n      body: data\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * GET from API and return results\n   * @param {string} path - API path\n   * @param {Object} [queryParams] - Query parameters\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async get (path, queryParams) {\n    const now = getTimestamp();\n    const res = await this._getFetchRaw(path, queryParams);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Raw GET from API\n   * @param {string} path - API path\n   * @param {Object} [queryParams={}] - Query parameters\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _getFetchRaw (path, queryParams = {}) {\n    path = path || '';\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const response = await fetch(this.endpoint + path + queryStr, {\n      headers: {\n        Authorization: this.token,\n        Accept: 'application/json'\n      }\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * Add data points to an HF (High Frequency) series event (flatJSON format)\n   * @param {string} eventId - The HF event ID\n   * @param {string[]} fields - Array of field names for the series\n   * @param {Array<Array<number|string>>} points - Array of data points, each point is an array of values\n   * @returns {Promise<HFSeriesAddResult>} Promise resolving to status response\n   * @see https://api.pryv.com/reference/#add-hf-series-data-points\n   */\n  async addPointsToHFEvent (eventId, fields, points) {\n    const res = await this.post('events/' + eventId + '/series', {\n      format: 'flatJSON',\n      fields,\n      points\n    });\n    if (res.status !== 'ok') {\n      throw new Error('Failed loading serie: ' + JSON.stringify(res.status));\n    }\n    return res;\n  }\n\n  /**\n   * Streamed get Event.\n   * @see https://api.pryv.com/reference/#get-events\n   * @param {Object} queryParams See `events.get` parameters\n   * @param {Function} forEachEvent Function taking one event as parameter. Will be called for each event\n   * @returns {Promise<Object>} Promise to result.body transformed with `eventsCount: {count}` replacing `events: [...]`\n   */\n  async getEventsStreamed (queryParams, forEachEvent) {\n    const myParser = jsonParser(forEachEvent, queryParams.includeDeletions);\n    const res = await libGetEventStreamed(this, queryParams, myParser);\n    const now = getTimestamp();\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * Create an event with attached file\n   * NODE.jS ONLY\n   * @param {Event} event\n   * @param {string} filePath\n   */\n  async createEventWithFile (event, filePath) {\n    const fs = require('fs');\n    const path = require('path');\n\n    if (!fs || !path) {\n      throw new Error('createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.');\n    }\n\n    const fileName = path.basename(filePath);\n    const mimeType = getMimeType(path.extname(filePath));\n    const fileBlob = await fs.openAsBlob(filePath, { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('event', JSON.stringify(event));\n    formData.append('file', fileBlob, fileName);\n\n    const now = getTimestamp();\n    const { body } = await this._postFetchRaw('events', formData);\n    this._handleMeta(body, now);\n    return body;\n  }\n\n  /**\n   * Create an event from a Buffer\n   * @param {Object} event\n   * @param {Buffer|Blob} bufferData - Buffer for node, Blob for browser\n   * @param {string} filename\n   */\n  async createEventWithFileFromBuffer (event, bufferData, filename) {\n    const mimeType = getMimeType(getExtname(filename));\n    const fileBlob = bufferData instanceof Blob\n      ? bufferData\n      // @ts-ignore - Buffer is valid for Blob in Node.js\n      : new Blob([bufferData], { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('file', fileBlob, filename);\n    const body = await this.createEventWithFormData(event, formData);\n    return body;\n  }\n\n  /**\n   * Create an event with attached formData\n   * !! BROWSER ONLY\n   * @param {Event} event\n   * @param {FormData} formData https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\n   */\n  async createEventWithFormData (event, formData) {\n    formData.append('event', JSON.stringify(event));\n    const { body } = await this._postFetchRaw('events', formData);\n    return body;\n  }\n\n  /**\n   * Difference in seconds between the Pryv.io API and local time\n   * deltaTime is refined at each (non-raw) API call\n   * @readonly\n   * @property {number} deltaTime\n   */\n  get deltaTime () {\n    return this._deltaTime.value;\n  }\n\n  /**\n   * API endpoint of this connection (includes token if present)\n   * @readonly\n   * @property {APIEndpoint} apiEndpoint\n   */\n  get apiEndpoint () {\n    return utils.buildAPIEndpoint(this);\n  }\n\n  // private method that handle meta data parsing\n  _handleMeta (res, requestLocalTimestamp) {\n    if (!res.meta) throw new Error('Cannot find .meta in response.');\n    if (!res.meta.serverTime) { throw new Error('Cannot find .meta.serverTime in response.'); }\n\n    // update deltaTime and weight it\n    this._deltaTime.value =\n      (this._deltaTime.value * this._deltaTime.weight +\n        res.meta.serverTime -\n        requestLocalTimestamp) /\n      ++this._deltaTime.weight;\n  }\n}\n\nmodule.exports = Connection;\n\nfunction getTimestamp () {\n  return Date.now() / 1000;\n}\n\nconst MIME_TYPES = {\n  '.png': 'image/png',\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.gif': 'image/gif',\n  '.webp': 'image/webp',\n  '.svg': 'image/svg+xml',\n  '.bmp': 'image/bmp',\n  '.ico': 'image/x-icon',\n  '.pdf': 'application/pdf',\n  '.json': 'application/json',\n  '.xml': 'application/xml',\n  '.zip': 'application/zip',\n  '.gz': 'application/gzip',\n  '.tar': 'application/x-tar',\n  '.txt': 'text/plain',\n  '.html': 'text/html',\n  '.htm': 'text/html',\n  '.css': 'text/css',\n  '.js': 'application/javascript',\n  '.mjs': 'application/javascript',\n  '.mp3': 'audio/mpeg',\n  '.wav': 'audio/wav',\n  '.ogg': 'audio/ogg',\n  '.mp4': 'video/mp4',\n  '.webm': 'video/webm',\n  '.avi': 'video/x-msvideo',\n  '.mov': 'video/quicktime'\n};\n\nfunction getMimeType (ext) {\n  return MIME_TYPES[ext.toLowerCase()] || 'application/octet-stream';\n}\n\nfunction getExtname (filename) {\n  const lastDot = filename.lastIndexOf('.');\n  return lastDot >= 0 ? filename.slice(lastDot) : '';\n}\n\n// service is require \"after\" to allow circular require\nconst Service = require('./Service');\n\n/**\n * API Method call, for batch call https://api.pryv.com/reference/#call-batch\n * @typedef {Object} MethodCall\n * @property {string} method - The method id\n * @property {(Object|Array)}  params - The call parameters as required by the method.\n * @property {(Function|Promise)} [handleResult] - Will be called with the result corresponding to this specific call.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * `pryv` library\n * @exports pryv\n * @property {pryv.Service} Service - To interact with Pryv.io at a \"Platform level\"\n * @property {pryv.Connection} Connection - To interact with an individual's (user) data set\n * @property {pryv.Browser} Browser - Browser Tools - Access request helpers and visuals (button)\n * @property {pryv.utils} utils - Exposes some utils for HTTP calls and tools to manipulate Pryv's API endpoints\n * @property {pryv.PryvError} PryvError - Custom error class with innerObject support\n */\nmodule.exports = {\n  Service: require('./Service'),\n  Connection: require('./Connection'),\n  Auth: require('./Auth'),\n  Browser: require('./Browser'),\n  utils: require('./utils'),\n  PryvError: require('./lib/PryvError'),\n  version: require('../package.json').version\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nmodule.exports = get;\n\nconst Messages = {\n  LOADING: {\n    en: '...'\n  },\n  ERROR: {\n    en: 'Error',\n    fr: 'Erreur'\n  },\n  LOGIN: {\n    en: 'Signin',\n    fr: 'Login'\n  },\n  SIGNOUT_CONFIRM: {\n    en: 'Logout?',\n    fr: 'Se dconnecter ?'\n  }\n};\n\nfunction get (languageCode, definitions) {\n  const myMessages = definitions || Messages;\n  const res = {};\n  Object.keys(myMessages).forEach((key) => {\n    res[key] = myMessages[key][languageCode] || myMessages[key].en;\n  });\n  return res;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst LoginButton = require('./LoginButton');\nconst CookieUtils = require('./CookieUtils');\nconst utils = require('../utils');\n\n/**\n * @memberof pryv\n * @namespace pryv.Browser\n */\nmodule.exports = {\n  LoginButton,\n  CookieUtils,\n  // retro-compatibility for lib-js < 2.0.9\n  AuthStates: require('../Auth/AuthStates'),\n  setupAuth: require('../Auth').setupAuth,\n  serviceInfoFromUrl: getServiceInfoFromURL\n};\n\n/**\n * Util to grab parameters from url query string\n * @param {*} url\n */\nfunction getServiceInfoFromURL (url) {\n  const queryParams = utils.getQueryParamsFromURL(url || window.location.href);\n  return queryParams.pryvServiceInfoUrl;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(47908);\n"],"names":["regexAPIandToken","regexSchemaAndPath","buildSearchParams","require","utils","module","exports","fetchGet","url","queryParams","arguments","length","undefined","headers","queryStr","Object","keys","myHeaders","assign","Accept","response","fetch","body","json","fetchGetText","text","fetchPost","data","method","JSON","stringify","isBrowser","window","document","extractTokenAndAPIEndpoint","apiEndpoint","lastIndex","res","exec","endsWith","endpoint","token","res2","Error","buildAPIEndpoint","tokenAndAPI","browserIsMobileOrTablet","navigator","check","a","userAgent","vendor","opera","test","substr","cleanURLFromPrYvParams","replace","getQueryParamsFromURL","vars","m","key","value","decodeURIComponent","extractTokenAndApiEndpoint","buildPryvApiEndpoint","ServiceAssets","constructor","assets","assetsURL","this","_assets","_assetsURL","setup","pryvServiceAssetsSourceUrl","get","keyPath","result","split","forEach","getUrl","relativeURL","baseUrlString","sRelPath","baseLocation","location","createElement","href","nUpLn","nEnd","sDir","sPath","pathname","nStart","indexOf","slice","substring","RegExp","portStr","port","protocol","hostname","relPathToAbs","baseUrl","setAllDefaults","setFavicon","loadCSS","link","querySelector","type","rel","favicon","default","getElementsByTagName","appendChild","css","loginButtonLoadCSS","buttonSignIn","loginButtonGetHTML","html","loginButtonGetMessages","messages","head","id","media","Assets","Service","serviceInfoUrl","serviceCustomizations","_serviceInfo","_polling","_serviceInfoUrl","_pryvServiceCustomizations","info","forceFetch","baseServiceInfo","setServiceInfo","supportsHF","infos","features","noHF","isDnsLess","api","includes","serviceInfo","name","definitions","console","log","infoSync","apiEndpointFor","username","login","password","appId","originHeader","register","Origin","ok","error","message","Connection","params","searchParams","URLSearchParams","entries","Array","isArray","item","append","toString","ERROR","LOADING","INITIALIZED","NEED_SIGNIN","AUTHORIZED","SIGNOUT","REFUSED","AuthStates","Messages","settings","service","loginButton","authRequest","returnURL","getReturnURL","requestingAppId","requestedPermissions","call","stateChangeListeners","onStateChange","push","languageCode","init","state","status","async","authController","loadedAssets","thisMessages","e","loadAssets","bind","storedCredentials","getAuthorizationData","checkAutoLogin","finishAuthProcessAfterRedirection","stopAuthRequest","msg","handleClick","startAuthRequest","_state","windowLocationForTest","navigatorForTests","RETURN_URL_AUTO","trailer","returnUrlIsAuto","access","doPolling","pollResponse","pollUrl","pollAccess","poll","setTimeout","poll_rate_ms","newState","listener","AuthController","LoginButton","setupAuth","HumanInteraction","humanInteraction","Cookies","authSettings","loginBtn","loginButtonSpan","getElementById","spanButtonID","loginButtonText","addEventListener","onClick","innerHTML","_cookieKey","auth","serviceName","LOGIN","loginUrl","authUrl","screenX","screenLeft","screenY","screenTop","outerWidth","clientWidth","outerHeight","clientHeight","Math","floor","popup","open","focus","startLoginScreen","saveAuthorizationData","SIGNOUT_CONFIRM","confirm","deleteAuthorizationData","getErrorMessage","authData","set","del","prYvkey","prYvpoll","retrievePollUrl","EVENTMARKERS","foreachEvent","includeDeletions","eventOrEventDeletions","buffer","depth","inString","skipNextOne","cursorPos","eventsCount","eventDeletionsCount","processEvents","charCodeAt","eventsOrDeletionMsg","ignoreComa","eventStr","addEvent","fn","setEncoding","on","chunk","n","searchStartEvents","processBuffer","err","bodyObject","parse","err_","rawResponse","statusCode","strEvent","conn","queryParam","parser","parserSettings","ondata","onend","encoding","fakeRes","f","errResult","bodyObjectResult","URL","search","fetchParams","Authorization","reader","getReader","done","read","TextDecoder","decode","pair","global","Pryv","PryvError","innerObject","super","captureStackTrace","cookieKey","expireInDays","myDate","Date","hostName","path","setDate","getDate","cookieStr","encodeURIComponent","toUTCString","cookie","parts","pop","shift","deleted","jsonParser","libGetEventStreamed","getTimestamp","now","options","chunkSize","_deltaTime","weight","_service","accessInfo","user","arrayOfAPICalls","progress","_chunkedBatchCall","batchCall","post","apiOne","expectedKey","revoke","throwOnFail","usingConnection","callHandler","percent","cursor","thisBatch","cursorMax","min","i","resRequest","results","handleResult","prototype","apply","round","_postFetch","_handleMeta","_postFetchRaw","contentType","_getFetchRaw","addPointsToHFEvent","eventId","fields","points","format","getEventsStreamed","forEachEvent","myParser","createEventWithFile","event","filePath","fs","fileName","basename","mimeType","getMimeType","extname","fileBlob","openAsBlob","formData","FormData","createEventWithFileFromBuffer","bufferData","filename","lastDot","lastIndexOf","getExtname","Blob","createEventWithFormData","deltaTime","requestLocalTimestamp","meta","serverTime","MIME_TYPES","ext","toLowerCase","Auth","Browser","version","myMessages","en","fr","CookieUtils","serviceInfoFromUrl","pryvServiceInfoUrl","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","g","globalThis","Function","__webpack_exports__"],"ignoreList":[],"sourceRoot":""}