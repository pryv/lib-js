{"version":3,"file":"pryv.js","mappings":"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","sources":["webpack://lib-js/./components/pryv/src/utils.js","webpack://lib-js/./components/pryv/src/ServiceAssets.js","webpack://lib-js/./components/pryv/src/Service.js","webpack://lib-js/./components/pryv/src/Auth/AuthStates.js","webpack://lib-js/./components/pryv/src/Auth/AuthController.js","webpack://lib-js/./components/pryv/src/Auth/index.js","webpack://lib-js/./components/pryv/src/Browser/LoginButton.js","webpack://lib-js/./components/pryv/src/lib/json-parser.js","webpack://lib-js/./components/pryv/src/lib/getEventStreamed.js","webpack://lib-js/./components/pryv/src/browser-index.js","webpack://lib-js/./components/pryv/src/lib/PryvError.js","webpack://lib-js/./components/pryv/src/Browser/CookieUtils.js","webpack://lib-js/./components/pryv/src/Connection.js","webpack://lib-js/./components/pryv/src/index.js","webpack://lib-js/./components/pryv/src/Auth/LoginMessages.js","webpack://lib-js/./components/pryv/src/Browser/index.js","webpack://lib-js/webpack/bootstrap","webpack://lib-js/webpack/runtime/global","webpack://lib-js/webpack/startup"],"sourcesContent":["/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst regexAPIandToken = /(.+):\\/\\/(.+)@(.+)/gm;\nconst regexSchemaAndPath = /(.+):\\/\\/(.+)/gm;\n\n/**\n * Utilities to access Pryv API.\n * @memberof pryv\n * @namespace pryv.utils\n */\nconst utils = module.exports = {\n  /**\n   * Perform a GET request and parse JSON response\n   * @param {string} url - URL to fetch\n   * @param {Object} [queryParams={}] - Query parameters to append\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchGet (url, queryParams = {}, headers = {}) {\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + new URLSearchParams(queryParams).toString();\n    }\n    const myHeaders = Object.assign({ Accept: 'application/json' }, headers);\n    const response = await fetch(url + queryStr, { headers: myHeaders });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Perform a GET request and return text response\n   * @param {string} url - URL to fetch\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, text: string}>} Promise resolving to response and text body\n   */\n  async fetchGetText (url, headers = {}) {\n    const myHeaders = Object.assign({ Accept: 'text/html' }, headers);\n    const response = await fetch(url, { headers: myHeaders });\n    const text = await response.text();\n    return { response, text };\n  },\n\n  /**\n   * Perform a POST request with JSON data\n   * @param {string} url - URL to post to\n   * @param {Object} [data] - Data to send as JSON\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchPost (url, data, headers = {}) {\n    const myHeaders = Object.assign({\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    }, headers);\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: myHeaders,\n      body: JSON.stringify(data)\n    });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Returns true is run in a browser\n   * @memberof pryv.utils\n   * @returns {boolean}\n   */\n  isBrowser: function () {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n  },\n\n  /**\n   * From a APIEndpoint URL, return an object (TokenAndAPI) with two properties\n   * @memberof pryv.utils\n   * @param {APIEndpoint} apiEndpoint\n   * @returns {TokenAndEndpoint}\n   */\n  extractTokenAndAPIEndpoint: function (apiEndpoint) {\n    regexAPIandToken.lastIndex = 0;\n    const res = regexAPIandToken.exec(apiEndpoint);\n\n    if (res !== null) { // has token\n      // add a trailing '/' to end point if missing\n      if (!res[3].endsWith('/')) {\n        res[3] += '/';\n      }\n      return { endpoint: res[1] + '://' + res[3], token: res[2] };\n    }\n    // else check if valid url\n    regexSchemaAndPath.lastIndex = 0;\n    const res2 = regexSchemaAndPath.exec(apiEndpoint);\n    if (res2 === null) {\n      throw new Error('Cannot find endpoint, invalid URL format');\n    }\n    // add a trailing '/' to end point if missing\n    if (!res2[2].endsWith('/')) {\n      res2[2] += '/';\n    }\n\n    return { endpoint: res2[1] + '://' + res2[2], token: null };\n  },\n\n  /**\n   * Get a APIEndpoint URL from a TokenAndAPI object\n   * @memberof pryv.utils\n   * @param {TokenAndEndpoint} tokenAndAPI\n   * @returns {APIEndpoint}\n   */\n  buildAPIEndpoint: function (tokenAndAPI) {\n    if (!tokenAndAPI.token) {\n      let res = tokenAndAPI.endpoint + '';\n      if (!tokenAndAPI.endpoint.endsWith('/')) {\n        res += '/';\n      }\n      return res;\n    }\n    regexSchemaAndPath.lastIndex = 0;\n    const res = regexSchemaAndPath.exec(tokenAndAPI.endpoint);\n    // add a trailing '/' to end point if missing\n    if (!res[2].endsWith('/')) {\n      res[2] += '/';\n    }\n    return res[1] + '://' + tokenAndAPI.token + '@' + res[2];\n  },\n\n  /**\n   * Check if the browser is running on a mobile device or tablet\n   * @memberof pryv.utils\n   * @param {string|Navigator} [navigator] - Navigator object or user agent string (for testing)\n   * @returns {boolean} True if mobile or tablet\n   */\n  browserIsMobileOrTablet: function (navigator) {\n    if (navigator == null) {\n      return false;\n    }\n    let check = false;\n    // @ts-ignore - navigator is Navigator when not null\n    // eslint-disable-next-line no-useless-escape\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || navigator.opera);\n    return check;\n  },\n\n  /**\n   * Remove Pryv-specific query parameters from URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to clean\n   * @returns {string} URL without prYv* parameters\n   */\n  cleanURLFromPrYvParams: function (url) {\n    const PRYV_REGEXP = /[?#&]+prYv([^=&]+)=([^&]*)/g;\n    return url.replace(PRYV_REGEXP, '');\n  },\n\n  /**\n   * Extract query parameters from a URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to parse\n   * @returns {Object.<string, string>} Object with key-value pairs of query parameters\n   */\n  getQueryParamsFromURL: function (url) {\n    /** @type {Object.<string, string>} */\n    const vars = {};\n    const QUERY_REGEXP = /[?#&]+([^=&]+)=([^&]*)/g;\n    url.replace(QUERY_REGEXP,\n      // @ts-ignore - replace callback is used for side effects\n      function (m, key, value) {\n        vars[key] = decodeURIComponent(value);\n      });\n    return vars;\n  }\n};\n\n// TODO: remove following deprecated aliases with next major version\n\n/**\n * @deprecated Renamed to `extractTokenAndAPIEndpoint()`\n */\nutils.extractTokenAndApiEndpoint = utils.extractTokenAndAPIEndpoint;\n\n/**\n * @deprecated Renamed to `buildAPIEndpoint()`\n */\n// TODO: remove deprecated alias with next major version\nutils.buildPryvApiEndpoint = utils.buildAPIEndpoint;\n\n// --------------- typedfs ------------------------------- //\n\n/**\n * An object with two properties: token & apiEndpoint\n * @typedef {Object} TokenAndEndpoint\n * @property {string} [token] Authorization token\n * @property {string} endpoint url of API endpoint\n */\n\n/**\n * A String url of the form http(s)://{token}@{apiEndpoint}\n * @typedef {string} APIEndpoint\n */\n\n/**\n * Common Meta are returned by each standard call on the API https://api.pryv.com/reference/#in-method-results\n * @typedef {Object} CommonMeta\n * @property {string} apiVersion The version of the API in the form {major}.{minor}.{revision}. Mirrored in HTTP header API-Version.\n * @property {number} serverTime The current server time as a timestamp in second. Keeping track of server time is necessary to properly handle time in API calls.\n * @property {string} serial The serial will change every time the core or register is updated. If you compare it with the serial of a previous response and notice a difference, you should reload the service information.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n\n/* global location */\n\n/**\n * Holds Pryv Service informations.\n *\n * It's returned by `service.assets()`\n *\n * @memberof pryv\n **/\nclass ServiceAssets {\n  /**\n   * Private => use ServiceAssets.setup()\n   * @param {Object} assets The content of service/info.assets properties.\n   * @param {string} assetsURL Url point to assets of the service of a Pryv platform\n   */\n  constructor (assets, assetsURL) {\n    this._assets = assets;\n    this._assetsURL = assetsURL;\n  }\n\n  /**\n   * Load Assets definition from URL\n   * @param {string} pryvServiceAssetsSourceUrl - URL to the assets definition JSON\n   * @returns {Promise<ServiceAssets>} Promise resolving to ServiceAssets instance\n   */\n  static async setup (pryvServiceAssetsSourceUrl) {\n    const { body } = await utils.fetchGet(pryvServiceAssetsSourceUrl);\n    return new ServiceAssets(body, pryvServiceAssetsSourceUrl);\n  }\n\n  /**\n   * get a value from path separated by `:`\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  get (keyPath) {\n    let result = Object.assign({}, this._assets);\n    if (keyPath) {\n      keyPath.split(':').forEach((key) => {\n        result = result[key];\n        if (typeof result === 'undefined') return result;\n      });\n    }\n    return result;\n  }\n\n  /**\n   * get an Url from path separated by `:`\n   * identical to doing assets.relativeURL(assets.get(keyPath))\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  getUrl (keyPath) {\n    const url = this.get(keyPath);\n    if (typeof url !== 'string') {\n      throw new Error(`Unexpected value for ${keyPath}: ${url}`);\n    }\n    return this.relativeURL(url);\n  }\n\n  /**\n   * get relativeUrl\n   */\n  relativeURL (url) {\n    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);\n  }\n\n  // ---------------- Default service resources\n\n  /**\n   * Set all defaults Favicon, CSS\n   */\n  async setAllDefaults () {\n    this.setFavicon();\n    await this.loadCSS();\n  }\n\n  /**\n   * Set service Favicon to Web Page\n   */\n  setFavicon () {\n    /** @type {HTMLLinkElement} */\n    // @ts-ignore - querySelector returns Element but we know it's HTMLLinkElement\n    const link = document.querySelector(\"link[rel*='icon']\") || document.createElement('link');\n    link.type = 'image/x-icon';\n    link.rel = 'shortcut icon';\n    link.href = this.relativeURL(this._assets.favicon.default.url);\n    document.getElementsByTagName('head')[0].appendChild(link);\n  }\n\n  /**\n   * Set default service CSS\n   */\n  async loadCSS () {\n    loadCSS(this.relativeURL(this._assets.css.default.url));\n  }\n\n  // ---- Login\n\n  /**\n   * Load CSS for Login button\n   */\n  async loginButtonLoadCSS () {\n    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));\n  }\n\n  /**\n   * Get HTML for Login Button\n   * @returns {Promise<string>} Promise resolving to HTML string\n   */\n  async loginButtonGetHTML () {\n    const { text } = await utils.fetchGetText(this.relativeURL(this._assets['lib-js'].buttonSignIn.html));\n    return text;\n  }\n\n  /**\n   * Get Messages strings for Login Button\n   * @returns {Promise<Object.<string, string>>} Promise resolving to messages object\n   */\n  async loginButtonGetMessages () {\n    const { body } = await utils.fetchGet(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages));\n    return body;\n  }\n}\n\nmodule.exports = ServiceAssets;\n\nfunction loadCSS (url) {\n  const head = document.getElementsByTagName('head')[0];\n  const link = document.createElement('link');\n  link.id = url;\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n  link.media = 'all';\n  head.appendChild(link);\n}\n\n/* HACK: disabling linting until code is cleaned up */\n/* eslint-disable */\n\n  /*\\\n  |*| Modified version of\n  |*| :: translate relative paths to absolute paths ::\n  |*|\n  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n  |*|\n  |*| The following code is released under the GNU Public License, version 3 or later.\n  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html\n  |*|\n  \\*/\n\nfunction relPathToAbs (baseUrlString, sRelPath) {\n  /** @type {Location|HTMLAnchorElement} */\n  var baseLocation = location;\n  if (baseUrlString) {\n    // @ts-ignore - HTMLAnchorElement has compatible URL properties\n    baseLocation = document.createElement('a');\n    baseLocation.href = baseUrlString;\n  }\n\n  var nUpLn, sDir = \"\", sPath = baseLocation.pathname.replace(/[^\\/]*$/, sRelPath.replace(/(\\/|^)(?:\\.?\\/+)+/g, \"$1\"));\n  for (var nEnd, nStart = 0; nEnd = sPath.indexOf(\"/../\", nStart), nEnd > -1; nStart = nEnd + nUpLn) {\n    nUpLn = /^\\/(?:\\.\\.\\/)*/.exec(sPath.slice(nEnd))[0].length;\n    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp(\"(?:\\\\\\/+[^\\\\\\/]*){0,\" + ((nUpLn - 1) / 3) + \"}$\"),\n      \"/\");\n  }\n  const portStr = baseLocation.port ? ':' + baseLocation.port : '';\n  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n// Connection is required at the end of this file to allow circular requires.\nconst Assets = require('./ServiceAssets.js');\n\n/**\n * @class pryv.Service\n * A Pryv.io deployment is a unique \"Service\", as an example **Pryv Lab** is a service, deployed with the domain name **pryv.me**.\n *\n * `pryv.Service` exposes tools to interact with Pryv.io at a \"Platform\" level.\n *\n *  ##### Initizalization with a service info URL\n```js\nconst service = new pryv.Service('https://reg.pryv.me/service/info');\n```\n\n- With the content of a serviceInfo configuration\n\nService information properties can be overriden with specific values. This might be usefull to test new designs on production platforms.\n\n```js\nconst serviceInfoUrl = 'https://reg.pryv.me/service/info';\nconst serviceCustomizations = {\n  name: 'Pryv Lab 2',\n  assets: {\n    definitions: 'https://pryv.github.io/assets-pryv.me/index.json'\n  }\n}\nconst service = new pryv.Service(serviceInfoUrl, serviceCustomizations);\n```\n\n * @memberof pryv\n *\n * @constructor\n * @param {string} serviceInfoUrl Url point to /service/info of a Pryv platform see: {@link https://api.pryv.com/reference/#service-info}\n */\nclass Service {\n  constructor (serviceInfoUrl, serviceCustomizations) {\n    this._serviceInfo = null;\n    this._assets = null;\n    this._polling = false;\n    this._serviceInfoUrl = serviceInfoUrl;\n    this._pryvServiceCustomizations = serviceCustomizations;\n  }\n\n  /**\n   * Return service info parameters info known of fetch it if needed.\n   * Example\n   *  - name of a platform\n   *    `const serviceName = await service.info().name`\n   * @see ServiceInfo For details on available properties.\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceInfo>} Promise to Service info Object\n   */\n  async info (forceFetch) {\n    if (forceFetch || !this._serviceInfo) {\n      let baseServiceInfo = {};\n      if (this._serviceInfoUrl) {\n        const { body } = await utils.fetchGet(this._serviceInfoUrl);\n        baseServiceInfo = body;\n      }\n      Object.assign(baseServiceInfo, this._pryvServiceCustomizations);\n      // @ts-ignore - baseServiceInfo is populated from body or customizations\n      this.setServiceInfo(baseServiceInfo);\n    }\n    return this._serviceInfo;\n  }\n\n  /**\n   * Check if a service supports High Frequency Data Sets\n   * @returns {Promise<boolean>} Promise resolving to true if HF is supported\n   */\n  async supportsHF () {\n    const infos = await this.info();\n    return (infos.features == null || infos.features.noHF !== true);\n  }\n\n  /**\n   * Check if a service has username in the hostname or in the path of the API.\n   * @returns {Promise<boolean>} Promise resolving to true if the service does not rely on DNS to find a host related to a username\n   */\n  async isDnsLess () {\n    const infos = await this.info();\n    const hostname = infos.api.split('/')[2];\n    return !hostname.includes('{username}');\n  }\n\n  /**\n   * @private\n   * @param {ServiceInfo} serviceInfo\n   */\n  setServiceInfo (serviceInfo) {\n    if (!serviceInfo.name) {\n      throw new Error('Invalid data from service/info');\n    }\n    // cleanup serviceInfo for eventual url not finishing by \"/\"\n    // code will be obsolete with next version of register\n    ['access', 'api', 'register'].forEach((key) => {\n      if (serviceInfo[key].slice(-1) !== '/') {\n        serviceInfo[key] += '/';\n      }\n    });\n    this._serviceInfo = serviceInfo;\n  }\n\n  /**\n   * Return assets property content\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceAssets|null>} Promise to ServiceAssets\n   */\n  async assets (forceFetch) {\n    if (!forceFetch && this._assets) {\n      return this._assets;\n    } else {\n      const serviceInfo = await this.info();\n      if (!serviceInfo.assets || !serviceInfo.assets.definitions) {\n        console.log('Warning: no assets for this service');\n        return null;\n      }\n      this._assets = await Assets.setup(serviceInfo.assets.definitions);\n      return this._assets;\n    }\n  }\n\n  /**\n   * Return service info parameters info known or null if not yet loaded\n   * @returns {ServiceInfo} Service Info definition\n   */\n  infoSync () {\n    return this._serviceInfo;\n  }\n\n  /**\n   * Return an API endpoint from a username and token\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {Promise<APIEndpoint>} Promise resolving to the API endpoint URL\n   */\n  async apiEndpointFor (username, token) {\n    const serviceInfo = await this.info();\n    return Service.buildAPIEndpoint(serviceInfo, username, token);\n  }\n\n  /**\n   * Return an API endpoint from a username, token and ServiceInfo.\n   * This method is rarely used. See **apiEndpointFor** as an alternative.\n   * @param {ServiceInfo} serviceInfo - The service info object containing API URL template\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {APIEndpoint} The constructed API endpoint URL\n   */\n  static buildAPIEndpoint (serviceInfo, username, token) {\n    const endpoint = serviceInfo.api.replace('{username}', username);\n    return utils.buildAPIEndpoint({ endpoint, token });\n  }\n\n  /**\n   * Issue a \"login call on the Service\" return a Connection on success\n   * **! Warning**: the token of the connection will be a \"Personal\" token that expires\n   * @see https://api.pryv.com/reference-full/#login-user\n   * @param {string} username\n   * @param {string} password\n   * @param {string} appId\n   * @param {string} [originHeader=service-info.register] Only for Node.js. If not set will use the register value of service info. In browsers this will overridden by current page location.\n   * @throws {Error} on invalid login\n   */\n  async login (username, password, appId, originHeader) {\n    const apiEndpoint = await this.apiEndpointFor(username);\n\n    const headers = {};\n    originHeader = originHeader || (await this.info()).register;\n    if (!utils.isBrowser()) {\n      headers.Origin = originHeader;\n    }\n    const { response, body } = await utils.fetchPost(\n      apiEndpoint + 'auth/login',\n      { username, password, appId },\n      headers\n    );\n\n    if (!response.ok) {\n      if (body?.error?.message) {\n        throw new Error(body.error.message);\n      }\n      throw new Error('Login failed: ' + JSON.stringify(body));\n    }\n\n    if (!body.token) {\n      throw new Error('Invalid login response: ' + JSON.stringify(body));\n    }\n    return new Connection(\n      Service.buildAPIEndpoint(await this.info(), username, body.token),\n      this // Pre load Connection with service\n    );\n  }\n}\n\nmodule.exports = Service;\n\n// Require is done after exports to allow circular references\nconst Connection = require('./Connection');\n\n/**\n * Object to handle Pryv Service Informations https://api.pryv.com/reference/#service-info\n * @typedef {Object} ServiceInfo\n * @property {string} register The URL of the register service.\n * @property {string} access The URL of the access page.\n * @property {string} api The API endpoint format.\n * @property {string} name The platform name.\n * @property {string} home The URL of the platform's home page.\n * @property {string} support The email or URL of the support page.\n * @property {string} terms The terms and conditions, in plain text or the URL displaying them.\n * @property {string} eventTypes The URL of the list of validated event types.\n * @property {Object} [assets] Holder for service specific Assets (icons, css, ...)\n * @property {string} [assets.definitions] URL to json object with assets definitions\n * @property {Object} [features] Platform feature flags\n * @property {boolean} [features.noHF] True if HF data is not supported\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * The possible auth states:\n * ERROR, LOADING, INITIALIZED, NEED_SIGNIN, AUTHORIZED, SIGNOUT, REFUSED\n * @readonly\n * @enum {string}\n * @memberof pryv.Browser\n */\nmodule.exports = {\n  ERROR: 'ERROR',\n  LOADING: 'LOADING',\n  INITIALIZED: 'INITIALIZED',\n  NEED_SIGNIN: 'NEED_SIGNIN',\n  AUTHORIZED: 'ACCEPTED',\n  SIGNOUT: 'SIGNOUT',\n  REFUSED: 'REFUSED'\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('../utils');\nconst AuthStates = require('./AuthStates');\nconst Messages = require('./LoginMessages');\n\n/**\n * Controller for authentication flow\n * @memberof pryv.Auth\n */\nclass AuthController {\n  /**\n   * Create an AuthController\n   * @param {AuthSettings} settings - Authentication settings\n   * @param {Service} service - Pryv service instance\n   * @param {CustomLoginButton} loginButton - Login button implementation\n   */\n  constructor (settings, service, loginButton) {\n    this.settings = settings;\n    validateSettings.call(this, settings);\n\n    this.stateChangeListeners = [];\n    if (this.settings.onStateChange) {\n      this.stateChangeListeners.push(this.settings.onStateChange);\n    }\n    this.service = service;\n\n    // probably remove\n    this.languageCode = this.settings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n\n    this.loginButton = loginButton;\n\n    function validateSettings (settings) {\n      if (!settings) { throw new Error('settings cannot be null'); }\n      // -- settings\n      if (!settings.authRequest) { throw new Error('Missing settings.authRequest'); }\n\n      // -- Extract returnURL\n      settings.authRequest.returnURL =\n        this.getReturnURL(settings.authRequest.returnURL);\n\n      if (!settings.authRequest.requestingAppId) {\n        throw new Error('Missing settings.authRequest.requestingAppId');\n      }\n      if (!settings.authRequest.requestedPermissions) {\n        throw new Error('Missing settings.authRequest.requestedPermissions');\n      }\n    }\n  }\n\n  /**\n   * Initialize the auth controller. Call this right after instantiation.\n   * @returns {Promise<Service>} Promise resolving to the Service instance\n   */\n  async init () {\n    this.serviceInfo = this.service.infoSync();\n    this.state = { status: AuthStates.LOADING };\n    this.assets = await loadAssets(this);\n\n    const loginButton = this.loginButton;\n    // initialize human interaction interface\n    if (loginButton != null) {\n      this.stateChangeListeners.push(loginButton.onStateChange.bind(loginButton));\n      // autologin needs cookies/storage implemented in human interaction interface\n      await checkAutoLogin(this);\n    }\n\n    // if auto login is not prompted\n    if (this.state.status !== AuthStates.AUTHORIZED) {\n      this.state = { status: AuthStates.INITIALIZED, serviceInfo: this.serviceInfo };\n    }\n\n    if (loginButton != null && loginButton.finishAuthProcessAfterRedirection != null) {\n      // @ts-ignore - this is a valid AuthController\n      await loginButton.finishAuthProcessAfterRedirection(this);\n    }\n\n    return this.service;\n  }\n\n  /**\n   * Stops poll for auth request\n   */\n  stopAuthRequest (msg) {\n    this.state = { status: AuthStates.ERROR, message: msg };\n  }\n\n  /**\n   * Handle button click - triggers appropriate action based on current state\n   * @returns {Promise<void>}\n   */\n  async handleClick () {\n    if (isAuthorized.call(this)) {\n      this.state = { status: AuthStates.SIGNOUT };\n    } else if (isInitialized.call(this)) {\n      this.startAuthRequest();\n    } else if (isNeedSignIn.call(this)) {\n      // reopen popup (HACK for now: set to private property to avoid self-assignment)\n      this.state = this._state;\n    } else {\n      console.log('Unhandled action in \"handleClick()\" for status:', this.state.status);\n    }\n\n    function isAuthorized () {\n      return this.state.status === AuthStates.AUTHORIZED;\n    }\n    function isInitialized () {\n      return this.state.status === AuthStates.INITIALIZED;\n    }\n    function isNeedSignIn () {\n      return this.state.status === AuthStates.NEED_SIGNIN;\n    }\n  }\n\n  /**\n   * Compute the return URL for authentication redirect.\n   * Used only in browser environments.\n   * @param {string} [returnURL] - The return URL setting ('auto#', 'self#', or custom URL)\n   * @param {string} [windowLocationForTest] - Mock window.location.href for testing\n   * @param {string|Navigator} [navigatorForTests] - Mock navigator for testing\n   * @returns {string|boolean} The computed return URL, or false if using popup mode\n   */\n  getReturnURL (\n    returnURL,\n    windowLocationForTest,\n    navigatorForTests\n  ) {\n    const RETURN_URL_AUTO = 'auto';\n\n    returnURL = returnURL || RETURN_URL_AUTO + '#';\n\n    // check the trailer\n    const trailer = returnURL.slice(-1);\n    if ('#&?'.indexOf(trailer) < 0) {\n      throw new Error('Pryv access: Last character of --returnURL setting-- is not ' +\n        '\"?\", \"&\" or \"#\": ' + returnURL);\n    }\n    // auto mode for desktop\n    if (returnUrlIsAuto(returnURL) &&\n        !utils.browserIsMobileOrTablet(navigatorForTests)) {\n      return false;\n    // auto mode for mobile or self\n    } else if ((returnUrlIsAuto(returnURL) &&\n                utils.browserIsMobileOrTablet(navigatorForTests)) ||\n               returnURL.indexOf('self') === 0) {\n      // set self as return url?\n      // eventually clean-up current url from previous pryv returnURL\n      const locationHref = windowLocationForTest || window.location.href;\n      returnURL = locationHref + returnURL.substring(4);\n    }\n    return utils.cleanURLFromPrYvParams(returnURL);\n\n    function returnUrlIsAuto (returnURL) {\n      return returnURL.indexOf(RETURN_URL_AUTO) === 0;\n    }\n  }\n\n  /**\n   * Start the authentication request and polling process\n   * @returns {Promise<void>}\n   * @see https://pryv.github.io/reference/#auth-request\n   */\n  async startAuthRequest () {\n    // @ts-ignore - postAccess uses .call(this) for context\n    this.state = await postAccess.call(this);\n\n    await doPolling.call(this);\n\n    /** @this {AuthController} */\n    async function postAccess () {\n      try {\n        const { response, body } = await utils.fetchPost(\n          // @ts-ignore - this is bound via .call()\n          this.serviceInfo.access,\n          // @ts-ignore - this is bound via .call()\n          this.settings.authRequest\n        );\n        if (!response.ok) {\n          throw new Error('Access request failed: ' + JSON.stringify(body));\n        }\n        return body;\n      } catch (e) {\n        this.state = {\n          status: AuthStates.ERROR,\n          message: 'Requesting access',\n          error: e\n        };\n        throw e; // forward error\n      }\n    }\n\n    /** @this {AuthController} */\n    async function doPolling () {\n      // @ts-ignore - this is bound via .call()\n      if (this.state?.status !== AuthStates.NEED_SIGNIN) {\n        return;\n      }\n      // @ts-ignore - this is bound via .call()\n      const pollResponse = await pollAccess(this.state?.poll);\n\n      if (pollResponse.status === AuthStates.NEED_SIGNIN) {\n        // @ts-ignore - this is bound via .call()\n        setTimeout(await doPolling.bind(this), this.state?.poll_rate_ms);\n      } else {\n        this.state = pollResponse;\n      }\n\n      async function pollAccess (pollUrl) {\n        try {\n          const { response, body } = await utils.fetchGet(pollUrl);\n          if (response.status === 403 && body?.status === 'REFUSED') {\n            return { status: AuthStates.INITIALIZED };\n          }\n          return body;\n        } catch (e) {\n          return { status: AuthStates.ERROR, message: 'Error while polling for auth request', error: e };\n        }\n      }\n    }\n  }\n\n  // -------------- state listeners ---------------------\n  set state (newState) {\n    // retro-compatibility for lib-js < 2.0.9\n    newState.id = newState.status;\n\n    this._state = newState;\n\n    this.stateChangeListeners.forEach((listener) => {\n      try {\n        listener(this.state);\n      } catch (e) {\n        console.log('Error during set state ()', e);\n      }\n    });\n  }\n\n  get state () {\n    return this._state;\n  }\n}\n\n// ----------- private methods -------------\n\nasync function checkAutoLogin (authController) {\n  const loginButton = authController.loginButton;\n  if (loginButton == null) {\n    return;\n  }\n\n  const storedCredentials = await loginButton.getAuthorizationData();\n  if (storedCredentials != null) {\n    authController.state = Object.assign({}, { status: AuthStates.AUTHORIZED }, storedCredentials);\n  }\n}\n\n// ------------------ ACTIONS  ----------- //\n\nasync function loadAssets (authController) {\n  let loadedAssets = {};\n  try {\n    loadedAssets = await authController.service.assets();\n    if (typeof location !== 'undefined') {\n      await loadedAssets.loginButtonLoadCSS();\n      const thisMessages = await loadedAssets.loginButtonGetMessages();\n      if (thisMessages.LOADING) {\n        authController.messages = Messages(authController.languageCode, thisMessages);\n      } else {\n        console.log('WARNING Messages cannot be loaded using defaults: ', thisMessages);\n      }\n    }\n  } catch (e) {\n    authController.state = {\n      status: AuthStates.ERROR,\n      message: 'Cannot fetch button visuals',\n      error: e\n    };\n    throw e; // forward error\n  }\n  return loadedAssets;\n}\n\nmodule.exports = AuthController;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst AuthController = require('./AuthController');\nconst AuthStates = require('./AuthStates');\nconst LoginButton = require('../Browser/LoginButton');\nconst Service = require('../Service');\n\n/**\n * @memberof pryv\n * @namespace pryv.Auth\n */\nmodule.exports = {\n  setupAuth,\n  AuthStates,\n  AuthController\n};\n\n/**\n * Start an authentication process\n *\n * @memberof pryv.Auth\n * @param {Object} settings\n * @param {Object} settings.authRequest See https://api.pryv.com/reference/#data-structure-access\n * @param {string} [settings.authRequest.languageCode] Language code, as per LoginButton Messages: 'en', 'fr\n * @param {string} settings.authRequest.requestingAppId Application id, ex: 'my-app'\n * @param {Object} settings.authRequest.requestedPermissions\n * @param {string | boolean} settings.authRequest.returnURL : false, // set this if you don't want a popup\n * @param {string} [settings.authRequest.referer] To track registration source\n * @param {string} settings.spanButtonID set and <span> id in DOM to insert default login button or null for custom\n * @param {Function} settings.onStateChange\n * @param {string} [settings.returnURL] Set to \"self#\" to disable popup and force using the same page\n * @param {string} serviceInfoUrl\n * @param {Object} [serviceCustomizations] override properties of serviceInfoUrl\n * @returns {Promise<Service>}\n */\nasync function setupAuth (settings, serviceInfoUrl, serviceCustomizations, HumanInteraction = LoginButton) {\n  const service = new Service(serviceInfoUrl, serviceCustomizations);\n  await service.info();\n\n  const humanInteraction = new HumanInteraction(settings, service);\n  await humanInteraction.init();\n\n  return service;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Cookies = require('./CookieUtils');\nconst AuthStates = require('../Auth/AuthStates');\nconst AuthController = require('../Auth/AuthController');\nconst Messages = require('../Auth/LoginMessages');\nconst utils = require('../utils');\n\n/* global location, confirm */\n\n/**\n * @memberof pryv.Browser\n */\nclass LoginButton {\n  constructor (authSettings, service) {\n    this.authSettings = authSettings;\n    this.service = service;\n    this.serviceInfo = service.infoSync();\n  }\n\n  /**\n   * setup button and load assets\n   */\n  async init () {\n    // initialize button visuals\n    setupButton(this);\n    this.languageCode = this.authSettings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      await loadAssets(this);\n    }\n    // set cookie key for authorization data\n    this._cookieKey = 'pryv-libjs-' + this.authSettings.authRequest.requestingAppId;\n\n    // initialize controller\n    this.auth = new AuthController(this.authSettings, this.service, this);\n    await this.auth.init();\n\n    return this.service;\n  }\n\n  onClick () {\n    this.auth.handleClick();\n  }\n\n  async onStateChange (state) {\n    switch (state.status) {\n      case AuthStates.LOADING:\n        this.text = getLoadingMessage(this);\n        break;\n      case AuthStates.INITIALIZED:\n        this.text = getInitializedMessage(this, this.serviceInfo.name);\n        break;\n      case AuthStates.NEED_SIGNIN: {\n        const loginUrl = state.authUrl || state.url; // url is deprecated\n        if (this.authSettings.authRequest.returnURL) { // open on same page (no Popup)\n          location.href = loginUrl;\n          return;\n        } else {\n          startLoginScreen(this, loginUrl);\n        }\n        break;\n      }\n      case AuthStates.AUTHORIZED:\n        this.text = state.username;\n        this.saveAuthorizationData({\n          apiEndpoint: state.apiEndpoint,\n          username: state.username\n        });\n        break;\n      case AuthStates.SIGNOUT: {\n        const message = this.messages.SIGNOUT_CONFIRM ? this.messages.SIGNOUT_CONFIRM : 'Logout ?';\n        if (confirm(message)) {\n          this.deleteAuthorizationData();\n          this.auth.init();\n        }\n        break;\n      }\n      case AuthStates.ERROR:\n        this.text = getErrorMessage(this, state.message);\n        break;\n      default:\n        console.log('WARNING Unhandled state for Login: ' + state.status);\n    }\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      // @ts-ignore\n      this.loginButtonText.innerHTML = this.text;\n    }\n  }\n\n  getAuthorizationData () {\n    return Cookies.get(this._cookieKey);\n  }\n\n  saveAuthorizationData (authData) {\n    Cookies.set(this._cookieKey, authData);\n  }\n\n  async deleteAuthorizationData () {\n    Cookies.del(this._cookieKey);\n  }\n\n  /**\n   * not mandatory to implement as non-browsers don't have this behaviour\n   * @param {*} authController\n   */\n  async finishAuthProcessAfterRedirection (authController) {\n    // this step should be applied only for the browser\n    if (!utils.isBrowser()) return;\n\n    // 3. Check if there is a prYvkey as result of \"out of page login\"\n    const url = window.location.href;\n    const pollUrl = retrievePollUrl(url);\n    if (pollUrl !== null) {\n      try {\n        const { body } = await utils.fetchGet(pollUrl);\n        authController.state = body;\n      } catch (e) {\n        authController.state = {\n          status: AuthStates.ERROR,\n          message: 'Cannot fetch result',\n          error: e\n        };\n      }\n    }\n\n    function retrievePollUrl (url) {\n      const params = utils.getQueryParamsFromURL(url);\n      let pollUrl = null;\n      if (params.prYvkey) { // deprecated method - To be removed\n        pollUrl = authController.serviceInfo.access + params.prYvkey;\n      }\n      if (params.prYvpoll) {\n        pollUrl = params.prYvpoll;\n      }\n      return pollUrl;\n    }\n  }\n}\n\nmodule.exports = LoginButton;\n\nasync function startLoginScreen (loginButton, authUrl) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n  const width = 400;\n  const height = 620;\n  const left = Math.floor(screenX + ((outerWidth - width) / 2));\n  const top = Math.floor(screenY + ((outerHeight - height) / 2.5));\n  const features = (\n    'width=' + width +\n    ',height=' + height +\n    ',left=' + left +\n    ',top=' + top +\n    ',scrollbars=yes'\n  );\n  loginButton.popup = window.open(authUrl, 'prYv Sign-in', features);\n\n  if (!loginButton.popup) {\n    // loginButton.auth.stopAuthRequest('FAILED_TO_OPEN_WINDOW');\n    console.log('Pop-up blocked. A second click should allow it.');\n  } else if (window.focus) {\n    loginButton.popup.focus();\n  }\n}\n\nfunction setupButton (loginBtn) {\n  loginBtn.loginButtonSpan = document.getElementById(loginBtn.authSettings.spanButtonID);\n\n  if (!loginBtn.loginButtonSpan) {\n    console.log('WARNING: pryv.Browser initialized with no spanButtonID');\n  } else {\n    // up to the time the button is loaded use the Span to display eventual\n    // error messages\n    loginBtn.loginButtonText = loginBtn.loginButtonSpan;\n\n    // bind actions dynamically to the button click\n    loginBtn.loginButtonSpan.addEventListener('click', loginBtn.onClick.bind(loginBtn));\n  }\n}\n\n/**\n * Loads the style from the service info\n */\nasync function loadAssets (loginBtn) {\n  const assets = await loginBtn.service.assets();\n  loginBtn.loginButtonSpan.innerHTML = await assets.loginButtonGetHTML();\n  loginBtn.loginButtonText = document.getElementById('pryv-access-btn-text');\n}\n\nfunction getErrorMessage (loginButton, message) {\n  return loginButton.messages.ERROR + ': ' + message;\n}\n\nfunction getLoadingMessage (loginButton) {\n  return loginButton.messages.LOADING;\n}\n\nfunction getInitializedMessage (loginButton, serviceName) {\n  return loginButton.messages.LOGIN + ': ' + serviceName;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// there two steps 1 find events, then eventDeletions\nconst EVENTMARKERS = ['\"events\":[', '\"eventDeletions\":['];\n\n/**\n * Stremed JSON parser for events\n */\nmodule.exports = function (foreachEvent, includeDeletions) {\n  let eventOrEventDeletions = 0; // start with event\n  let buffer = ''; // temp data\n  let body = null; // to be returned\n\n  // IN EVENTS VARS\n  let depth = 0; // level of depth in brackets\n  let inString = false; // cursor is in a String\n  let skipNextOne = false; // when a backslash is found\n  let cursorPos = 0; // position of Character Cursor\n\n  // counters\n  let eventsCount = 0;\n  let eventDeletionsCount = 0;\n\n  const states = {\n    A_BEFORE_EVENTS: 0,\n    B_IN_EVENTS: 1,\n    D_AFTER_EVENTS: 2\n  };\n\n  let state = states.A_BEFORE_EVENTS;\n\n  function processBuffer () {\n    switch (state) {\n      case states.A_BEFORE_EVENTS:\n        searchStartEvents();\n        break;\n      case states.B_IN_EVENTS:\n        processEvents();\n        break;\n      default:\n        afterEvents();\n        break;\n    }\n  }\n\n  function searchStartEvents () {\n    // search for \"events\": and happend any info before to the body\n    const n = buffer.indexOf(EVENTMARKERS[eventOrEventDeletions]);\n    if (n > 0) {\n      if (eventOrEventDeletions === 0) { // do only once\n        body = buffer.substring(0, n);\n      }\n      buffer = buffer.substr(n + EVENTMARKERS[eventOrEventDeletions].length);\n      state = states.B_IN_EVENTS;\n      processEvents();\n    }\n  }\n\n  function processEvents () {\n    /// ---- in Event\n    while (cursorPos < buffer.length && (state === states.B_IN_EVENTS)) {\n      if (skipNextOne) { // ignore next character\n        skipNextOne = false;\n        cursorPos++;\n        continue;\n      }\n      switch (buffer.charCodeAt(cursorPos)) {\n        case 93: // ]\n          if (depth === 0) { // end of events\n            if (cursorPos !== 0) {\n              throw new Error('Found trailling ] in mid-course');\n            }\n            if (eventOrEventDeletions === 0 && includeDeletions) {\n              state = states.A_BEFORE_EVENTS;\n              eventOrEventDeletions = 1; // now look for eventDeletions\n              return;\n            } else { // done\n              state = states.D_AFTER_EVENTS;\n              let eventsOrDeletionMsg = '';\n              if (eventOrEventDeletions === 1) {\n                eventsOrDeletionMsg = '\"eventDeletionsCount\":' + eventDeletionsCount + ',';\n              }\n              buffer = eventsOrDeletionMsg + '\"eventsCount\":' + eventsCount + '' + buffer.substr(1);\n            }\n          }\n          break;\n        case 92: // \\\n          skipNextOne = true;\n          break;\n        case 123: // {\n          if (!inString) depth++;\n          break;\n        case 34: // \"\n          inString = !inString;\n          break;\n        case 125: // }\n          if (!inString) depth--;\n          if (depth === 0) {\n            // ignore possible coma ',' if first char\n            const ignoreComa = (buffer.charCodeAt(0) === 44) ? 1 : 0;\n            const eventStr = buffer.substring(ignoreComa, cursorPos + 1);\n\n            if (eventOrEventDeletions === 0) {\n              eventsCount++;\n            } else {\n              eventDeletionsCount++;\n            }\n            buffer = buffer.substr(cursorPos + 1);\n            addEvent(eventStr);\n            cursorPos = -1;\n          }\n          break;\n      }\n      cursorPos++;\n    }\n  }\n\n  function afterEvents () {\n    // just happend the end of message;\n    body += buffer;\n    buffer = '';\n  }\n\n  return function (res, fn) {\n    res.setEncoding('utf8'); // Already UTF8 in browsers\n    res.on('data', chunk => {\n      buffer += chunk;\n      processBuffer();\n    });\n    res.on('end', () => {\n      let err;\n      let bodyObject;\n      try {\n        res.text = body + buffer;\n        bodyObject = res.text && JSON.parse(res.text);\n      } catch (err_) {\n        err = err_;\n        // issue #675: return the raw response if the response parsing fails\n        err.rawResponse = res.text || null;\n        // issue #876: return the http status code if the response parsing fails\n        err.statusCode = res.statusCode;\n      } finally {\n        fn(err, bodyObject);\n      }\n    });\n  };\n\n  /// --- Direct Push\n  function addEvent (strEvent) {\n    foreachEvent(JSON.parse(strEvent));\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/* global fetch */\n\nmodule.exports = getEventStreamed;\n\nasync function getEventStreamed (conn, queryParam, parser) {\n  /**\n   * Holds Parser's settings\n   */\n  const parserSettings = {\n    ondata: null,\n    onend: null,\n    encoding: 'utf8'\n  };\n\n  /**\n   * Mock Response\n   */\n  const fakeRes = {\n    setEncoding: function (encoding) {\n      parserSettings.encoding = encoding;\n    }, // will receive 'data' and 'end' callbacks\n    on: function (key, f) {\n      parserSettings['on' + key] = f;\n    }\n  };\n\n  /**\n   * Holds results from the parser\n   */\n  let errResult;\n  let bodyObjectResult;\n  /**\n   *\n   */\n  parser(fakeRes, function (err, bodyObject) {\n    errResult = err;\n    bodyObjectResult = bodyObject;\n  });\n\n  // ------------   fetch ------------------- //\n  const url = new URL(conn.endpoint + 'events');\n  url.search = new URLSearchParams(queryParam).toString();\n  const fetchParams = { method: 'GET', headers: { Accept: 'application/json' } };\n  if (conn.token) fetchParams.headers.Authorization = conn.token;\n\n  const response = await fetch(url, fetchParams);\n  const reader = response.body.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    parserSettings.ondata(new TextDecoder(parserSettings.encoding).decode(value));\n    if (done) { parserSettings.onend(); break; }\n  }\n\n  if (errResult) {\n    throw new Error(errResult);\n  }\n\n  // We're done!\n  const result = {\n    text: fakeRes.text, // from the parser\n    body: bodyObjectResult, // from the parser\n    statusCode: response.status,\n    headers: {}\n  };\n  // add headers to result\n  // @ts-ignore - Headers.entries() exists in modern environments\n  for (const pair of response.headers.entries()) {\n    result.headers[pair[0]] = pair[1];\n  }\n\n  return result;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// make lib available as `Pryv` (with capital P, deprecated) for backward-compatibility with apps importing via <script>\n// TODO: remove deprecated alias with next major version\nmodule.exports = global.Pryv = require('./index');\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Custom error class for Pryv library errors.\n * Includes an innerObject property for wrapping underlying errors.\n * @extends Error\n */\nclass PryvError extends Error {\n  /**\n   * Create a PryvError\n   * @param {string} message - Error message\n   * @param {Error|Object} [innerObject] - The underlying error or object that caused this error\n   */\n  constructor (message, innerObject) {\n    super(message);\n    this.name = 'PryvError';\n    /** @type {Error|Object|undefined} */\n    this.innerObject = innerObject;\n\n    // Maintains proper stack trace for where error was thrown (only in V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, PryvError);\n    }\n  }\n}\n\nmodule.exports = PryvError;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst utils = require('../utils');\n\n/**\n * @memberof pryv.Browser\n * @namespace pryv.Browser.CookieUtils\n */\nmodule.exports = {\n  get,\n  set,\n  del\n};\n\n/**\n  * Set a local cookie\n  * @memberof pryv.Browser.CookieUtils\n  * @template T\n  * @param {string} cookieKey - The key for the cookie\n  * @param {T} value - The value (will be JSON stringified)\n  * @param {number} [expireInDays=365] - Expiration date in days from now\n  */\nfunction set (cookieKey, value, expireInDays) {\n  if (!utils.isBrowser()) return;\n  expireInDays = expireInDays || 365;\n  const myDate = new Date();\n  const hostName = window.location.hostname;\n  const path = window.location.pathname;\n  myDate.setDate(myDate.getDate() + expireInDays);\n  let cookieStr = encodeURIComponent(cookieKey) + '=' +\n    encodeURIComponent(JSON.stringify(value)) +\n    ';expires=' + myDate.toUTCString() +\n    ';domain=.' + hostName + ';path=' + path;\n  // do not add SameSite when removing a cookie\n  if (expireInDays >= 0) cookieStr += ';SameSite=Strict';\n  document.cookie = cookieStr;\n}\n\n/**\n * Return the value of a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @template T\n * @param {string} cookieKey - The key\n * @returns {T|undefined} The parsed cookie value or undefined if not found\n */\nfunction get (cookieKey) {\n  const name = encodeURIComponent(cookieKey);\n  if (!utils.isBrowser()) return;\n  const value = '; ' + document.cookie;\n  const parts = value.split('; ' + name + '=');\n  if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));\n}\n\n/**\n * Delete a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @param {string} cookieKey - The key\n */\nfunction del (cookieKey) {\n  set(cookieKey, { deleted: true }, -1);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\nconst jsonParser = require('./lib/json-parser');\nconst libGetEventStreamed = require('./lib/getEventStreamed');\nconst PryvError = require('./lib/PryvError');\n\n/**\n * @class Connection\n * A connection is an authenticated link to a Pryv.io account.\n *\n * @type {TokenAndEndpoint}\n *\n * @example\n * create a connection for the user 'tom' on 'pryv.me' backend with the token 'TTZycvBTiq'\n * const conn = new pryv.Connection('https://TTZycvBTiq@tom.pryv.me');\n *\n * @property {string} [token]\n * @property {string} endpoint\n * @memberof pryv\n *\n * @constructor\n * @this {Connection}\n * @param {APIEndpoint} apiEndpoint\n * @param {pryv.Service} [service] - eventually initialize Connection with a Service\n */\nclass Connection {\n  constructor (apiEndpoint, service) {\n    const { token, endpoint } = utils.extractTokenAndAPIEndpoint(apiEndpoint);\n    this.token = token;\n    this.endpoint = endpoint;\n    this.options = {};\n    this.options.chunkSize = 1000;\n    this._deltaTime = { value: 0, weight: 0 };\n    if (service && !(service instanceof Service)) {\n      throw new Error('Invalid service param');\n    }\n    this._service = service;\n  }\n\n  /**\n   * get pryv.Service object relative to this connection\n   * @readonly\n   * @property {pryv.Service} service\n   */\n  get service () {\n    if (this._service) return this._service;\n    this._service = new Service(this.endpoint + 'service/info');\n    return this._service;\n  }\n\n  /**\n   * Get username for this connection.\n   * It's async as it's constructed from access info.\n   * @returns {Promise<string>} Promise resolving to the username\n   */\n  async username () {\n    const accessInfo = await this.accessInfo();\n    if (accessInfo.error) {\n      throw new PryvError(\n        'Failed fetching accessinfo: ' + accessInfo.error.message,\n        accessInfo.error\n      );\n    }\n    // @ts-ignore - username is always a string\n    return accessInfo.user.username;\n  }\n\n  /**\n   * Get access info for this connection.\n   * It's async as it is fetched from the API.\n   * @returns {Promise<AccessInfo>} Promise resolving to the access info\n   */\n  async accessInfo () {\n    return this.get('access-info', null);\n  }\n\n  /**\n   * Issue a Batch call https://api.pryv.com/reference/#call-batch .\n   * arrayOfAPICalls will be splited in multiple calls if the size is > `conn.options.chunkSize` .\n   * Default chunksize is 1000.\n   * @param {Array.<MethodCall>} arrayOfAPICalls Array of Method Calls\n   * @param {Function} [progress] Return percentage of progress (0 - 100);\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    function httpHandler (batchCall) {\n      return this.post('', batchCall);\n    }\n    return await this._chunkedBatchCall(\n      arrayOfAPICalls,\n      progress,\n      httpHandler.bind(this)\n    );\n  }\n\n  /**\n   * Make one API call\n   * @param {string} method - Method ID (e.g., 'events.get', 'streams.create')\n   * @param {Object|Array} [params={}] - The params associated with this method\n   * @param {string} [expectedKey] - If given, returns the value of this key or throws an error if not present\n   * @returns {Promise<Object>} Promise resolving to the API result or the value of expectedKey\n   * @throws {Error} If .error is present in the response or expectedKey is missing\n   */\n  async apiOne (method, params = {}, expectedKey) {\n    const result = await this.api([{ method, params }]);\n    if (\n      result[0] == null ||\n      result[0].error ||\n      (expectedKey != null && result[0][expectedKey] == null)\n    ) {\n      const innerObject = result[0]?.error || result;\n      throw new PryvError(\n        `Error for api method: \"${method}\" with params: ${JSON.stringify(\n          params\n        )} >> Result: ${JSON.stringify(innerObject)}\"`,\n        innerObject\n      );\n    }\n    if (expectedKey != null) return result[0][expectedKey];\n    return result[0];\n  }\n\n  /**\n   * Revoke : Delete the accessId\n   * - Do not throw error if access is already revoked, just return null;\n   * @param {boolean} [throwOnFail=true] - if set to false do not throw Error on failure\n   * @param {Connection} [usingConnection] - specify which connection issues the revoke, might be necessary when selfRevoke\n   * @returns {Promise<Object|null>} Promise resolving to deletion result or null if already revoked/failed\n   */\n  async revoke (throwOnFail = true, usingConnection) {\n    usingConnection = usingConnection || this;\n    let accessInfo = null;\n    // get accessId\n    try {\n      accessInfo = await this.accessInfo();\n    } catch (e) {\n      if (e.response?.body?.error?.id === 'invalid-access-token') {\n        return null; // Already revoked OK..\n      }\n      if (throwOnFail) throw e;\n      return null;\n    }\n    // delete access\n    try {\n      const result = usingConnection.apiOne('accesses.delete', {\n        id: accessInfo.id\n      });\n      return result;\n    } catch (e) {\n      if (throwOnFail) throw e;\n      return null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  async _chunkedBatchCall (arrayOfAPICalls, progress, callHandler) {\n    if (!Array.isArray(arrayOfAPICalls)) {\n      throw new Error('Connection.api() takes an array as input');\n    }\n\n    const res = [];\n    let percent = 0;\n    for (\n      let cursor = 0;\n      arrayOfAPICalls.length >= cursor;\n      cursor += this.options.chunkSize\n    ) {\n      const thisBatch = [];\n      const cursorMax = Math.min(\n        cursor + this.options.chunkSize,\n        arrayOfAPICalls.length\n      );\n      // copy only method and params into a back call to be exuted\n      for (let i = cursor; i < cursorMax; i++) {\n        thisBatch.push({\n          method: arrayOfAPICalls[i].method,\n          params: arrayOfAPICalls[i].params\n        });\n      }\n      const resRequest = await callHandler(thisBatch);\n      // result checks\n      if (!resRequest || !Array.isArray(resRequest.results)) {\n        throw new Error(\n          'API call result is not an Array: ' + JSON.stringify(resRequest)\n        );\n      }\n      if (resRequest.results.length !== thisBatch.length) {\n        throw new Error(\n          'API call result Array does not match request: ' +\n            JSON.stringify(resRequest)\n        );\n      }\n\n      // eventually call handleResult\n      for (let i = 0; i < resRequest.results.length; i++) {\n        if (arrayOfAPICalls[i + cursor].handleResult) {\n          await arrayOfAPICalls[i + cursor].handleResult.call(\n            null,\n            resRequest.results[i],\n            thisBatch[i] // request\n          );\n        }\n      }\n      Array.prototype.push.apply(res, resRequest.results);\n      percent = Math.round((100 * res.length) / arrayOfAPICalls.length);\n      if (progress) {\n        progress(percent, res);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Post to API and return results\n   * @param {string} path - API path\n   * @param {(Array | Object)} data - Data to post\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async post (path, data) {\n    const now = getTimestamp();\n    const res = await this._postFetch(path, data);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Post object as JSON to API\n   * @param {string} path - API path\n   * @param {Array | Object} data - Data to post as JSON\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetch (path, data) {\n    return this._postFetchRaw(path, JSON.stringify(data), 'application/json');\n  }\n\n  /**\n   * @private\n   * Raw Post to API\n   * @param {string} path - API path\n   * @param {any} data - Raw data to post\n   * @param {string} [contentType] - Content-Type header (optional, allows fetch to set it for FormData)\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetchRaw (path, data, contentType) {\n    const headers = {\n      Authorization: this.token,\n      Accept: 'application/json'\n    };\n    // optional for form-data llowing fetch to\n    // automatically set multipart/form-data with the correct boundary\n    if (contentType) {\n      headers['Content-Type'] = contentType;\n    }\n    const response = await fetch(this.endpoint + path, {\n      method: 'POST',\n      headers,\n      body: data\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * GET from API and return results\n   * @param {string} path - API path\n   * @param {Object} [queryParams] - Query parameters\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async get (path, queryParams) {\n    const now = getTimestamp();\n    const res = await this._getFetchRaw(path, queryParams);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Raw GET from API\n   * @param {string} path - API path\n   * @param {Object} [queryParams={}] - Query parameters\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _getFetchRaw (path, queryParams = {}) {\n    path = path || '';\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + new URLSearchParams(queryParams).toString();\n    }\n    const response = await fetch(this.endpoint + path + queryStr, {\n      headers: {\n        Authorization: this.token,\n        Accept: 'application/json'\n      }\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * Add data points to an HF (High Frequency) series event (flatJSON format)\n   * @param {string} eventId - The HF event ID\n   * @param {string[]} fields - Array of field names for the series\n   * @param {Array<Array<number|string>>} points - Array of data points, each point is an array of values\n   * @returns {Promise<HFSeriesAddResult>} Promise resolving to status response\n   * @see https://api.pryv.com/reference/#add-hf-series-data-points\n   */\n  async addPointsToHFEvent (eventId, fields, points) {\n    const res = await this.post('events/' + eventId + '/series', {\n      format: 'flatJSON',\n      fields,\n      points\n    });\n    if (res.status !== 'ok') {\n      throw new Error('Failed loading serie: ' + JSON.stringify(res.status));\n    }\n    return res;\n  }\n\n  /**\n   * Streamed get Event.\n   * @see https://api.pryv.com/reference/#get-events\n   * @param {Object} queryParams See `events.get` parameters\n   * @param {Function} forEachEvent Function taking one event as parameter. Will be called for each event\n   * @returns {Promise<Object>} Promise to result.body transformed with `eventsCount: {count}` replacing `events: [...]`\n   */\n  async getEventsStreamed (queryParams, forEachEvent) {\n    const myParser = jsonParser(forEachEvent, queryParams.includeDeletions);\n    const res = await libGetEventStreamed(this, queryParams, myParser);\n    const now = getTimestamp();\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * Create an event with attached file\n   * NODE.jS ONLY\n   * @param {Event} event\n   * @param {string} filePath\n   */\n  async createEventWithFile (event, filePath) {\n    const fs = require('fs');\n    const path = require('path');\n\n    if (!fs || !path) {\n      throw new Error('createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.');\n    }\n\n    const fileName = path.basename(filePath);\n    const mimeType = getMimeType(path.extname(filePath));\n    const fileBlob = await fs.openAsBlob(filePath, { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('event', JSON.stringify(event));\n    formData.append('file', fileBlob, fileName);\n\n    const now = getTimestamp();\n    const { body } = await this._postFetchRaw('events', formData);\n    this._handleMeta(body, now);\n    return body;\n  }\n\n  /**\n   * Create an event from a Buffer\n   * @param {Object} event\n   * @param {Buffer|Blob} bufferData - Buffer for node, Blob for browser\n   * @param {string} filename\n   */\n  async createEventWithFileFromBuffer (event, bufferData, filename) {\n    const mimeType = getMimeType(getExtname(filename));\n    const fileBlob = bufferData instanceof Blob\n      ? bufferData\n      // @ts-ignore - Buffer is valid for Blob in Node.js\n      : new Blob([bufferData], { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('file', fileBlob, filename);\n    const body = await this.createEventWithFormData(event, formData);\n    return body;\n  }\n\n  /**\n   * Create an event with attached formData\n   * !! BROWSER ONLY\n   * @param {Event} event\n   * @param {FormData} formData https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\n   */\n  async createEventWithFormData (event, formData) {\n    formData.append('event', JSON.stringify(event));\n    const { body } = await this._postFetchRaw('events', formData);\n    return body;\n  }\n\n  /**\n   * Difference in seconds between the Pryv.io API and local time\n   * deltaTime is refined at each (non-raw) API call\n   * @readonly\n   * @property {number} deltaTime\n   */\n  get deltaTime () {\n    return this._deltaTime.value;\n  }\n\n  /**\n   * API endpoint of this connection (includes token if present)\n   * @readonly\n   * @property {APIEndpoint} apiEndpoint\n   */\n  get apiEndpoint () {\n    return utils.buildAPIEndpoint(this);\n  }\n\n  // private method that handle meta data parsing\n  _handleMeta (res, requestLocalTimestamp) {\n    if (!res.meta) throw new Error('Cannot find .meta in response.');\n    if (!res.meta.serverTime) { throw new Error('Cannot find .meta.serverTime in response.'); }\n\n    // update deltaTime and weight it\n    this._deltaTime.value =\n      (this._deltaTime.value * this._deltaTime.weight +\n        res.meta.serverTime -\n        requestLocalTimestamp) /\n      ++this._deltaTime.weight;\n  }\n}\n\nmodule.exports = Connection;\n\nfunction getTimestamp () {\n  return Date.now() / 1000;\n}\n\nconst MIME_TYPES = {\n  '.png': 'image/png',\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.gif': 'image/gif',\n  '.webp': 'image/webp',\n  '.svg': 'image/svg+xml',\n  '.bmp': 'image/bmp',\n  '.ico': 'image/x-icon',\n  '.pdf': 'application/pdf',\n  '.json': 'application/json',\n  '.xml': 'application/xml',\n  '.zip': 'application/zip',\n  '.gz': 'application/gzip',\n  '.tar': 'application/x-tar',\n  '.txt': 'text/plain',\n  '.html': 'text/html',\n  '.htm': 'text/html',\n  '.css': 'text/css',\n  '.js': 'application/javascript',\n  '.mjs': 'application/javascript',\n  '.mp3': 'audio/mpeg',\n  '.wav': 'audio/wav',\n  '.ogg': 'audio/ogg',\n  '.mp4': 'video/mp4',\n  '.webm': 'video/webm',\n  '.avi': 'video/x-msvideo',\n  '.mov': 'video/quicktime'\n};\n\nfunction getMimeType (ext) {\n  return MIME_TYPES[ext.toLowerCase()] || 'application/octet-stream';\n}\n\nfunction getExtname (filename) {\n  const lastDot = filename.lastIndexOf('.');\n  return lastDot >= 0 ? filename.slice(lastDot) : '';\n}\n\n// service is require \"after\" to allow circular require\nconst Service = require('./Service');\n\n/**\n * API Method call, for batch call https://api.pryv.com/reference/#call-batch\n * @typedef {Object} MethodCall\n * @property {string} method - The method id\n * @property {(Object|Array)}  params - The call parameters as required by the method.\n * @property {(Function|Promise)} [handleResult] - Will be called with the result corresponding to this specific call.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * `pryv` library\n * @exports pryv\n * @property {pryv.Service} Service - To interact with Pryv.io at a \"Platform level\"\n * @property {pryv.Connection} Connection - To interact with an individual's (user) data set\n * @property {pryv.Browser} Browser - Browser Tools - Access request helpers and visuals (button)\n * @property {pryv.utils} utils - Exposes some utils for HTTP calls and tools to manipulate Pryv's API endpoints\n * @property {pryv.PryvError} PryvError - Custom error class with innerObject support\n */\nmodule.exports = {\n  Service: require('./Service'),\n  Connection: require('./Connection'),\n  Auth: require('./Auth'),\n  Browser: require('./Browser'),\n  utils: require('./utils'),\n  PryvError: require('./lib/PryvError'),\n  version: require('../package.json').version\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nmodule.exports = get;\n\nconst Messages = {\n  LOADING: {\n    en: '...'\n  },\n  ERROR: {\n    en: 'Error',\n    fr: 'Erreur'\n  },\n  LOGIN: {\n    en: 'Signin',\n    fr: 'Login'\n  },\n  SIGNOUT_CONFIRM: {\n    en: 'Logout?',\n    fr: 'Se dconnecter ?'\n  }\n};\n\nfunction get (languageCode, definitions) {\n  const myMessages = definitions || Messages;\n  const res = {};\n  Object.keys(myMessages).forEach((key) => {\n    res[key] = myMessages[key][languageCode] || myMessages[key].en;\n  });\n  return res;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst LoginButton = require('./LoginButton');\nconst CookieUtils = require('./CookieUtils');\nconst utils = require('../utils');\n\n/**\n * @memberof pryv\n * @namespace pryv.Browser\n */\nmodule.exports = {\n  LoginButton,\n  CookieUtils,\n  // retro-compatibility for lib-js < 2.0.9\n  AuthStates: require('../Auth/AuthStates'),\n  setupAuth: require('../Auth').setupAuth,\n  serviceInfoFromUrl: getServiceInfoFromURL\n};\n\n/**\n * Util to grab parameters from url query string\n * @param {*} url\n */\nfunction getServiceInfoFromURL (url) {\n  const queryParams = utils.getQueryParamsFromURL(url || window.location.href);\n  return queryParams.pryvServiceInfoUrl;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(47908);\n"],"names":["regexAPIandToken","regexSchemaAndPath","utils","module","exports","fetchGet","url","queryParams","arguments","length","undefined","headers","queryStr","Object","keys","URLSearchParams","toString","myHeaders","assign","Accept","response","fetch","body","json","fetchGetText","text","fetchPost","data","method","JSON","stringify","isBrowser","window","document","extractTokenAndAPIEndpoint","apiEndpoint","lastIndex","res","exec","endsWith","endpoint","token","res2","Error","buildAPIEndpoint","tokenAndAPI","browserIsMobileOrTablet","navigator","check","a","userAgent","vendor","opera","test","substr","cleanURLFromPrYvParams","replace","getQueryParamsFromURL","vars","m","key","value","decodeURIComponent","extractTokenAndApiEndpoint","buildPryvApiEndpoint","require","ServiceAssets","constructor","assets","assetsURL","this","_assets","_assetsURL","setup","pryvServiceAssetsSourceUrl","get","keyPath","result","split","forEach","getUrl","relativeURL","baseUrlString","sRelPath","baseLocation","location","createElement","href","nUpLn","nEnd","sDir","sPath","pathname","nStart","indexOf","slice","substring","RegExp","portStr","port","protocol","hostname","relPathToAbs","baseUrl","setAllDefaults","setFavicon","loadCSS","link","querySelector","type","rel","favicon","default","getElementsByTagName","appendChild","css","loginButtonLoadCSS","buttonSignIn","loginButtonGetHTML","html","loginButtonGetMessages","messages","head","id","media","Assets","Service","serviceInfoUrl","serviceCustomizations","_serviceInfo","_polling","_serviceInfoUrl","_pryvServiceCustomizations","info","forceFetch","baseServiceInfo","setServiceInfo","supportsHF","infos","features","noHF","isDnsLess","api","includes","serviceInfo","name","definitions","console","log","infoSync","apiEndpointFor","username","login","password","appId","originHeader","register","Origin","ok","error","message","Connection","ERROR","LOADING","INITIALIZED","NEED_SIGNIN","AUTHORIZED","SIGNOUT","REFUSED","AuthStates","Messages","settings","service","loginButton","authRequest","returnURL","getReturnURL","requestingAppId","requestedPermissions","call","stateChangeListeners","onStateChange","push","languageCode","init","state","status","async","authController","loadedAssets","thisMessages","e","loadAssets","bind","storedCredentials","getAuthorizationData","checkAutoLogin","finishAuthProcessAfterRedirection","stopAuthRequest","msg","handleClick","startAuthRequest","_state","windowLocationForTest","navigatorForTests","RETURN_URL_AUTO","trailer","returnUrlIsAuto","access","doPolling","pollResponse","pollUrl","pollAccess","poll","setTimeout","poll_rate_ms","newState","listener","AuthController","LoginButton","setupAuth","HumanInteraction","humanInteraction","Cookies","authSettings","loginBtn","loginButtonSpan","getElementById","spanButtonID","loginButtonText","addEventListener","onClick","innerHTML","_cookieKey","auth","serviceName","LOGIN","loginUrl","authUrl","screenX","screenLeft","screenY","screenTop","outerWidth","clientWidth","outerHeight","clientHeight","Math","floor","popup","open","focus","startLoginScreen","saveAuthorizationData","SIGNOUT_CONFIRM","confirm","deleteAuthorizationData","getErrorMessage","authData","set","del","params","prYvkey","prYvpoll","retrievePollUrl","EVENTMARKERS","foreachEvent","includeDeletions","eventOrEventDeletions","buffer","depth","inString","skipNextOne","cursorPos","eventsCount","eventDeletionsCount","processEvents","charCodeAt","eventsOrDeletionMsg","ignoreComa","eventStr","addEvent","fn","setEncoding","on","chunk","n","searchStartEvents","processBuffer","err","bodyObject","parse","err_","rawResponse","statusCode","strEvent","conn","queryParam","parser","parserSettings","ondata","onend","encoding","fakeRes","f","errResult","bodyObjectResult","URL","search","fetchParams","Authorization","reader","getReader","done","read","TextDecoder","decode","pair","entries","global","Pryv","PryvError","innerObject","super","captureStackTrace","cookieKey","expireInDays","myDate","Date","hostName","path","setDate","getDate","cookieStr","encodeURIComponent","toUTCString","cookie","parts","pop","shift","deleted","jsonParser","libGetEventStreamed","getTimestamp","now","options","chunkSize","_deltaTime","weight","_service","accessInfo","user","arrayOfAPICalls","progress","_chunkedBatchCall","batchCall","post","apiOne","expectedKey","revoke","throwOnFail","usingConnection","callHandler","Array","isArray","percent","cursor","thisBatch","cursorMax","min","i","resRequest","results","handleResult","prototype","apply","round","_postFetch","_handleMeta","_postFetchRaw","contentType","_getFetchRaw","addPointsToHFEvent","eventId","fields","points","format","getEventsStreamed","forEachEvent","myParser","createEventWithFile","event","filePath","fs","fileName","basename","mimeType","getMimeType","extname","fileBlob","openAsBlob","formData","FormData","append","createEventWithFileFromBuffer","bufferData","filename","lastDot","lastIndexOf","getExtname","Blob","createEventWithFormData","deltaTime","requestLocalTimestamp","meta","serverTime","MIME_TYPES","ext","toLowerCase","Auth","Browser","version","myMessages","en","fr","CookieUtils","serviceInfoFromUrl","pryvServiceInfoUrl","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","g","globalThis","Function","__webpack_exports__"],"ignoreList":[],"sourceRoot":""}