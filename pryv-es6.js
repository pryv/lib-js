/*! For license information please see pryv-es6.js.LICENSE.txt */
var pryv;(()=>{var t={8(){},1767(t,e,s){const n=s(6518);function i(t,e,s){if(!n.isBrowser())return;s=s||365;const i=new Date,o=window.location.hostname,a=window.location.pathname;i.setDate(i.getDate()+s);let r=encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e))+";expires="+i.toUTCString()+";domain=."+o+";path="+a;s>=0&&(r+=";SameSite=Strict"),document.cookie=r}t.exports={get:function(t){const e=encodeURIComponent(t);if(!n.isBrowser())return;const s=("; "+document.cookie).split("; "+e+"=");return 2===s.length?JSON.parse(decodeURIComponent(s.pop().split(";").shift())):void 0},set:i,del:function(t){i(t,{deleted:!0},-1)}}},1870(t,e,s){t.exports=s.g.Pryv=s(9755)},2168(){},2597(t){t.exports=function(t){const e=new URLSearchParams;for(const[s,n]of Object.entries(t))if(Array.isArray(n))for(const t of n)e.append(s,t);else null!=n&&e.append(s,n);return e.toString()}},2930(t,e,s){const n=s(6518),i=s(6564),o=s(5155);t.exports=class{constructor(t,e,s){this.settings=t,function(t){if(!t)throw new Error("settings cannot be null");if(!t.authRequest)throw new Error("Missing settings.authRequest");if(t.authRequest.returnURL=this.getReturnURL(t.authRequest.returnURL),!t.authRequest.requestingAppId)throw new Error("Missing settings.authRequest.requestingAppId");if(!t.authRequest.requestedPermissions)throw new Error("Missing settings.authRequest.requestedPermissions")}.call(this,t),this.stateChangeListeners=[],this.settings.onStateChange&&this.stateChangeListeners.push(this.settings.onStateChange),this.service=e,this.languageCode=this.settings.authRequest.languageCode||"en",this.messages=o(this.languageCode),this.loginButton=s}async init(){this.serviceInfo=this.service.infoSync(),this.state={status:i.LOADING},this.assets=await async function(t){let e={};try{if(e=await t.service.assets(),"undefined"!=typeof location){await e.loginButtonLoadCSS();const s=await e.loginButtonGetMessages();s.LOADING?t.messages=o(t.languageCode,s):console.log("WARNING Messages cannot be loaded using defaults: ",s)}}catch(e){throw t.state={status:i.ERROR,message:"Cannot fetch button visuals",error:e},e}return e}(this);const t=this.loginButton;return null!=t&&(this.stateChangeListeners.push(t.onStateChange.bind(t)),await async function(t){const e=t.loginButton;if(null==e)return;const s=await e.getAuthorizationData();null!=s&&(t.state=Object.assign({},{status:i.AUTHORIZED},s))}(this)),this.state.status!==i.AUTHORIZED&&(this.state={status:i.INITIALIZED,serviceInfo:this.serviceInfo}),null!=t&&null!=t.finishAuthProcessAfterRedirection&&await t.finishAuthProcessAfterRedirection(this),this.service}stopAuthRequest(t){this.state={status:i.ERROR,message:t}}async handleClick(){!function(){return this.state.status===i.AUTHORIZED}.call(this)?function(){return this.state.status===i.INITIALIZED}.call(this)?this.startAuthRequest():function(){return this.state.status===i.NEED_SIGNIN}.call(this)?this.state=this._state:console.log('Unhandled action in "handleClick()" for status:',this.state.status):this.state={status:i.SIGNOUT}}getReturnURL(t,e,s){const i="auto",o=(t=t||i+"#").slice(-1);if("#&?".indexOf(o)<0)throw new Error('Pryv access: Last character of --returnURL setting-- is not "?", "&" or "#": '+t);return!(a(t)&&!n.browserIsMobileOrTablet(s))&&((a(t)&&n.browserIsMobileOrTablet(s)||0===t.indexOf("self"))&&(t=(e||window.location.href)+t.substring(4)),n.cleanURLFromPrYvParams(t));function a(t){return 0===t.indexOf(i)}}async startAuthRequest(){this.state=await async function(){try{const{response:t,body:e}=await n.fetchPost(this.serviceInfo.access,this.settings.authRequest);if(!t.ok)throw new Error("Access request failed: "+JSON.stringify(e));return e}catch(t){throw this.state={status:i.ERROR,message:"Requesting access",error:t},t}}.call(this),await async function t(){if(this.state?.status!==i.NEED_SIGNIN)return;const e=await async function(t){try{const{response:e,body:s}=await n.fetchGet(t);return 403===e.status&&"REFUSED"===s?.status?{status:i.INITIALIZED}:s}catch(t){return{status:i.ERROR,message:"Error while polling for auth request",error:t}}}(this.state?.poll);e.status===i.NEED_SIGNIN?setTimeout(await t.bind(this),this.state?.poll_rate_ms):this.state=e}.call(this)}set state(t){t.id=t.status,this._state=t,this.stateChangeListeners.forEach(t=>{try{t(this.state)}catch(t){console.log("Error during set state ()",t)}})}get state(){return this._state}}},3565(t,e,s){const n=s(6518);class i{constructor(t,e){this._assets=t,this._assetsURL=e}static async setup(t){const{body:e}=await n.fetchGet(t);return new i(e,t)}get(t){let e=Object.assign({},this._assets);return t&&t.split(":").forEach(t=>{if(e=e[t],void 0===e)return e}),e}getUrl(t){const e=this.get(t);if("string"!=typeof e)throw new Error(`Unexpected value for ${t}: ${e}`);return this.relativeURL(e)}relativeURL(t){return function(t,e){var s=location;t&&((s=document.createElement("a")).href=t);for(var n,i,o="",a=s.pathname.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),r=0;(i=a.indexOf("/../",r))>-1;r=i+n)n=/^\/(?:\.\.\/)*/.exec(a.slice(i))[0].length,o=(o+a.substring(r,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");const c=s.port?":"+s.port:"";return s.protocol+"//"+s.hostname+c+o+a.substr(r)}(this._assets.baseUrl||this._assetsURL,t)}async setAllDefaults(){this.setFavicon(),await this.loadCSS()}setFavicon(){const t=document.querySelector("link[rel*='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=this.relativeURL(this._assets.favicon.default.url),document.getElementsByTagName("head")[0].appendChild(t)}async loadCSS(){o(this.relativeURL(this._assets.css.default.url))}async loginButtonLoadCSS(){o(this.relativeURL(this._assets["lib-js"].buttonSignIn.css))}async loginButtonGetHTML(){const{text:t}=await n.fetchGetText(this.relativeURL(this._assets["lib-js"].buttonSignIn.html));return t}async loginButtonGetMessages(){const{body:t}=await n.fetchGet(this.relativeURL(this._assets["lib-js"].buttonSignIn.messages));return t}}function o(t){const e=document.getElementsByTagName("head")[0],s=document.createElement("link");s.id=t,s.rel="stylesheet",s.type="text/css",s.href=t,s.media="all",e.appendChild(s)}t.exports=i},3808(t,e,s){const n=s(6518),i=s(3565);class o{constructor(t,e){this._serviceInfo=null,this._assets=null,this._polling=!1,this._serviceInfoUrl=t,this._pryvServiceCustomizations=e}async info(t){if(t||!this._serviceInfo){let t={};if(this._serviceInfoUrl){const{body:e}=await n.fetchGet(this._serviceInfoUrl);t=e}Object.assign(t,this._pryvServiceCustomizations),this.setServiceInfo(t)}return this._serviceInfo}async supportsHF(){const t=await this.info();return null==t.features||!0!==t.features.noHF}async isDnsLess(){return!(await this.info()).api.split("/")[2].includes("{username}")}setServiceInfo(t){if(!t.name)throw new Error("Invalid data from service/info");["access","api","register"].forEach(e=>{"/"!==t[e].slice(-1)&&(t[e]+="/")}),this._serviceInfo=t}async assets(t){if(!t&&this._assets)return this._assets;{const t=await this.info();return t.assets&&t.assets.definitions?(this._assets=await i.setup(t.assets.definitions),this._assets):(console.log("Warning: no assets for this service"),null)}}infoSync(){return this._serviceInfo}async apiEndpointFor(t,e){const s=await this.info();return o.buildAPIEndpoint(s,t,e)}static buildAPIEndpoint(t,e,s){const i=t.api.replace("{username}",e);return n.buildAPIEndpoint({endpoint:i,token:s})}async login(t,e,s,i){const r=await this.apiEndpointFor(t),c={};i=i||(await this.info()).register,n.isBrowser()||(c.Origin=i);const{response:u,body:h}=await n.fetchPost(r+"auth/login",{username:t,password:e,appId:s},c);if(!u.ok){if(h?.error?.message)throw new Error(h.error.message);throw new Error("Login failed: "+JSON.stringify(h))}if(!h.token)throw new Error("Invalid login response: "+JSON.stringify(h));return new a(o.buildAPIEndpoint(await this.info(),t,h.token),this)}}t.exports=o;const a=s(7271)},5155(t){t.exports=function(t,s){const n=s||e,i={};return Object.keys(n).forEach(e=>{i[e]=n[e][t]||n[e].en}),i};const e={LOADING:{en:"..."},ERROR:{en:"Error",fr:"Erreur"},LOGIN:{en:"Signin",fr:"Login"},SIGNOUT_CONFIRM:{en:"Logout?",fr:"Se d√©connecter ?"}}},5829(t){const e=['"events":[','"eventDeletions":['];t.exports=function(t,s){let n=0,i="",o=null,a=0,r=!1,c=!1,u=0,h=0,l=0;let d=0;function p(){for(;u<i.length&&1===d;)if(c)c=!1,u++;else{switch(i.charCodeAt(u)){case 93:if(0===a){if(0!==u)throw new Error("Found trailling ] in mid-course");if(0===n&&s)return d=0,void(n=1);{d=2;let t="";1===n&&(t='"eventDeletionsCount":'+l+","),i=t+'"eventsCount":'+h+i.substr(1)}}break;case 92:c=!0;break;case 123:r||a++;break;case 34:r=!r;break;case 125:if(r||a--,0===a){const t=44===i.charCodeAt(0)?1:0,e=i.substring(t,u+1);0===n?h++:l++,i=i.substr(u+1),f(e),u=-1}}u++}}return function(t,s){t.setEncoding("utf8"),t.on("data",t=>{i+=t,function(){switch(d){case 0:!function(){const t=i.indexOf(e[n]);t>0&&(0===n&&(o=i.substring(0,t)),i=i.substr(t+e[n].length),d=1,p())}();break;case 1:p();break;default:o+=i,i=""}}()}),t.on("end",()=>{let e,n;try{t.text=o+i,n=t.text&&JSON.parse(t.text)}catch(s){e=s,e.rawResponse=t.text||null,e.statusCode=t.statusCode}finally{s(e,n)}})};function f(e){t(JSON.parse(e))}}},6021(t){"use strict";t.exports={rE:"3.0.0"}},6136(t,e,s){const n=s(9701),i=s(1767),o=s(6518);t.exports={LoginButton:n,CookieUtils:i,AuthStates:s(6564),setupAuth:s(6682).setupAuth,serviceInfoFromUrl:function(t){return o.getQueryParamsFromURL(t||window.location.href).pryvServiceInfoUrl}}},6518(t,e,s){const n=/(.+):\/\/(.+)@(.+)/gm,i=/(.+):\/\/(.+)/gm,o=s(2597),a=t.exports={async fetchGet(t,e={},s={}){let n="";e&&Object.keys(e).length>0&&(n="?"+o(e));const i=Object.assign({Accept:"application/json"},s),a=await fetch(t+n,{headers:i}),r=await a.json();return{response:a,body:r}},async fetchGetText(t,e={}){const s=Object.assign({Accept:"text/html"},e),n=await fetch(t,{headers:s}),i=await n.text();return{response:n,text:i}},async fetchPost(t,e,s={}){const n=Object.assign({Accept:"application/json","Content-Type":"application/json"},s),i=await fetch(t,{method:"POST",headers:n,body:JSON.stringify(e)}),o=await i.json();return{response:i,body:o}},isBrowser:function(){return"undefined"!=typeof window&&"undefined"!=typeof document},extractTokenAndAPIEndpoint:function(t){n.lastIndex=0;const e=n.exec(t);if(null!==e)return e[3].endsWith("/")||(e[3]+="/"),{endpoint:e[1]+"://"+e[3],token:e[2]};i.lastIndex=0;const s=i.exec(t);if(null===s)throw new Error("Cannot find endpoint, invalid URL format");return s[2].endsWith("/")||(s[2]+="/"),{endpoint:s[1]+"://"+s[2],token:null}},buildAPIEndpoint:function(t){if(!t.token){let e=t.endpoint+"";return t.endpoint.endsWith("/")||(e+="/"),e}i.lastIndex=0;const e=i.exec(t.endpoint);return e[2].endsWith("/")||(e[2]+="/"),e[1]+"://"+t.token+"@"+e[2]},browserIsMobileOrTablet:function(t){if(null==t)return!1;let e=!1;var s;return s=t.userAgent||t.vendor||t.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(s.substr(0,4)))&&(e=!0),e},cleanURLFromPrYvParams:function(t){return t.replace(/[?#&]+prYv([^=&]+)=([^&]*)/g,"")},getQueryParamsFromURL:function(t){const e={};return t.replace(/[?#&]+([^=&]+)=([^&]*)/g,function(t,s,n){e[s]=decodeURIComponent(n)}),e}};a.extractTokenAndApiEndpoint=a.extractTokenAndAPIEndpoint,a.buildPryvApiEndpoint=a.buildAPIEndpoint},6564(t){t.exports={ERROR:"ERROR",LOADING:"LOADING",INITIALIZED:"INITIALIZED",NEED_SIGNIN:"NEED_SIGNIN",AUTHORIZED:"ACCEPTED",SIGNOUT:"SIGNOUT",REFUSED:"REFUSED"}},6682(t,e,s){const n=s(2930),i=s(6564),o=s(9701),a=s(3808);t.exports={setupAuth:async function(t,e,s,n=o){const i=new a(e,s);await i.info();const r=new n(t,i);return await r.init(),i},AuthStates:i,AuthController:n}},7271(t,e,s){const n=s(6518),i=s(5829),o=s(8670),a=s(9710),r=s(2597);function c(){return Date.now()/1e3}t.exports=class{constructor(t,e){const{token:s,endpoint:i}=n.extractTokenAndAPIEndpoint(t);if(this.token=s,this.endpoint=i,this.options={},this.options.chunkSize=1e3,this._deltaTime={value:0,weight:0},e&&!(e instanceof l))throw new Error("Invalid service param");this._service=e}get service(){return this._service||(this._service=new l(this.endpoint+"service/info")),this._service}async username(){const t=await this.accessInfo();if(t.error)throw new a("Failed fetching accessinfo: "+t.error.message,t.error);return t.user.username}async accessInfo(){return this.get("access-info",null)}async api(t,e){return await this._chunkedBatchCall(t,e,function(t){return this.post("",t)}.bind(this))}async apiOne(t,e={},s){const n=await this.api([{method:t,params:e}]);if(null==n[0]||n[0].error||null!=s&&null==n[0][s]){const s=n[0]?.error||n;throw new a(`Error for api method: "${t}" with params: ${JSON.stringify(e)} >> Result: ${JSON.stringify(s)}"`,s)}return null!=s?n[0][s]:n[0]}async revoke(t=!0,e){e=e||this;let s=null;try{s=await this.accessInfo()}catch(e){if("invalid-access-token"===e.response?.body?.error?.id)return null;if(t)throw e;return null}try{return e.apiOne("accesses.delete",{id:s.id})}catch(e){if(t)throw e;return null}}async _chunkedBatchCall(t,e,s){if(!Array.isArray(t))throw new Error("Connection.api() takes an array as input");const n=[];let i=0;for(let o=0;t.length>=o;o+=this.options.chunkSize){const a=[],r=Math.min(o+this.options.chunkSize,t.length);for(let e=o;e<r;e++)a.push({method:t[e].method,params:t[e].params});const c=await s(a);if(!c||!Array.isArray(c.results))throw new Error("API call result is not an Array: "+JSON.stringify(c));if(c.results.length!==a.length)throw new Error("API call result Array does not match request: "+JSON.stringify(c));for(let e=0;e<c.results.length;e++)t[e+o].handleResult&&await t[e+o].handleResult.call(null,c.results[e],a[e]);Array.prototype.push.apply(n,c.results),i=Math.round(100*n.length/t.length),e&&e(i,n)}return n}async post(t,e){const s=c(),n=await this._postFetch(t,e);return this._handleMeta(n.body,s),n.body}async _postFetch(t,e){return this._postFetchRaw(t,JSON.stringify(e),"application/json")}async _postFetchRaw(t,e,s){const n={Authorization:this.token,Accept:"application/json"};s&&(n["Content-Type"]=s);const i=await fetch(this.endpoint+t,{method:"POST",headers:n,body:e}),o=await i.json();return{response:i,body:o}}async get(t,e){const s=c(),n=await this._getFetchRaw(t,e);return this._handleMeta(n.body,s),n.body}async _getFetchRaw(t,e={}){t=t||"";let s="";e&&Object.keys(e).length>0&&(s="?"+r(e));const n=await fetch(this.endpoint+t+s,{headers:{Authorization:this.token,Accept:"application/json"}}),i=await n.json();return{response:n,body:i}}async addPointsToHFEvent(t,e,s){const n=await this.post("events/"+t+"/series",{format:"flatJSON",fields:e,points:s});if("ok"!==n.status)throw new Error("Failed loading serie: "+JSON.stringify(n.status));return n}async getEventsStreamed(t,e){const s=i(e,t.includeDeletions),n=await o(this,t,s),a=c();return this._handleMeta(n.body,a),n.body}async createEventWithFile(t,e){const n=s(2168),i=s(8);if(!n||!i)throw new Error("createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.");const o=i.basename(e),a=h(i.extname(e)),r=await n.openAsBlob(e,{type:a}),u=new FormData;u.append("event",JSON.stringify(t)),u.append("file",r,o);const l=c(),{body:d}=await this._postFetchRaw("events",u);return this._handleMeta(d,l),d}async createEventWithFileFromBuffer(t,e,s){const n=h(function(t){const e=t.lastIndexOf(".");return e>=0?t.slice(e):""}(s)),i=e instanceof Blob?e:new Blob([e],{type:n}),o=new FormData;return o.append("file",i,s),await this.createEventWithFormData(t,o)}async createEventWithFormData(t,e){e.append("event",JSON.stringify(t));const{body:s}=await this._postFetchRaw("events",e);return s}get deltaTime(){return this._deltaTime.value}get apiEndpoint(){return n.buildAPIEndpoint(this)}_handleMeta(t,e){if(!t.meta)throw new Error("Cannot find .meta in response.");if(!t.meta.serverTime)throw new Error("Cannot find .meta.serverTime in response.");this._deltaTime.value=(this._deltaTime.value*this._deltaTime.weight+t.meta.serverTime-e)/++this._deltaTime.weight}};const u={".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".webp":"image/webp",".svg":"image/svg+xml",".bmp":"image/bmp",".ico":"image/x-icon",".pdf":"application/pdf",".json":"application/json",".xml":"application/xml",".zip":"application/zip",".gz":"application/gzip",".tar":"application/x-tar",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"application/javascript",".mjs":"application/javascript",".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".mp4":"video/mp4",".webm":"video/webm",".avi":"video/x-msvideo",".mov":"video/quicktime"};function h(t){return u[t.toLowerCase()]||"application/octet-stream"}const l=s(3808)},8670(t,e,s){const n=s(2597);t.exports=async function(t,e,s){const i={ondata:null,onend:null,encoding:"utf8"},o={setEncoding:function(t){i.encoding=t},on:function(t,e){i["on"+t]=e}};let a,r;s(o,function(t,e){a=t,r=e});const c=new URL(t.endpoint+"events");c.search=n(e);const u={method:"GET",headers:{Accept:"application/json"}};t.token&&(u.headers.Authorization=t.token);const h=await fetch(c,u),l=h.body.getReader();for(;;){const{done:t,value:e}=await l.read();if(i.ondata(new TextDecoder(i.encoding).decode(e)),t){i.onend();break}}if(a)throw new Error(a);const d={text:o.text,body:r,statusCode:h.status,headers:{}};for(const t of h.headers.entries())d.headers[t[0]]=t[1];return d}},9701(t,e,s){const n=s(1767),i=s(6564),o=s(2930),a=s(5155),r=s(6518);t.exports=class{constructor(t,e){this.authSettings=t,this.service=e,this.serviceInfo=e.infoSync()}async init(){var t;return(t=this).loginButtonSpan=document.getElementById(t.authSettings.spanButtonID),t.loginButtonSpan?(t.loginButtonText=t.loginButtonSpan,t.loginButtonSpan.addEventListener("click",t.onClick.bind(t))):console.log("WARNING: pryv.Browser initialized with no spanButtonID"),this.languageCode=this.authSettings.authRequest.languageCode||"en",this.messages=a(this.languageCode),this.loginButtonText&&await async function(t){const e=await t.service.assets();t.loginButtonSpan.innerHTML=await e.loginButtonGetHTML(),t.loginButtonText=document.getElementById("pryv-access-btn-text")}(this),this._cookieKey="pryv-libjs-"+this.authSettings.authRequest.requestingAppId,this.auth=new o(this.authSettings,this.service,this),await this.auth.init(),this.service}onClick(){this.auth.handleClick()}async onStateChange(t){switch(t.status){case i.LOADING:this.text=this.messages.LOADING;break;case i.INITIALIZED:this.text=(e=this,s=this.serviceInfo.name,e.messages.LOGIN+": "+s);break;case i.NEED_SIGNIN:{const e=t.authUrl||t.url;if(this.authSettings.authRequest.returnURL)return void(location.href=e);!async function(t,e){const s=void 0!==window.screenX?window.screenX:window.screenLeft,n=void 0!==window.screenY?window.screenY:window.screenTop,i=void 0!==window.outerWidth?window.outerWidth:document.body.clientWidth,o=void 0!==window.outerHeight?window.outerHeight:document.body.clientHeight-22,a="width=400,height=620,left="+Math.floor(s+(i-400)/2)+",top="+Math.floor(n+(o-620)/2.5)+",scrollbars=yes";t.popup=window.open(e,"prYv Sign-in",a),t.popup?window.focus&&t.popup.focus():console.log("Pop-up blocked. A second click should allow it.")}(this,e);break}case i.AUTHORIZED:this.text=t.username,this.saveAuthorizationData({apiEndpoint:t.apiEndpoint,username:t.username});break;case i.SIGNOUT:{const t=this.messages.SIGNOUT_CONFIRM?this.messages.SIGNOUT_CONFIRM:"Logout ?";confirm(t)&&(this.deleteAuthorizationData(),this.auth.init());break}case i.ERROR:this.text=function(t,e){return t.messages.ERROR+": "+e}(this,t.message);break;default:console.log("WARNING Unhandled state for Login: "+t.status)}var e,s;this.loginButtonText&&(this.loginButtonText.innerHTML=this.text)}getAuthorizationData(){return n.get(this._cookieKey)}saveAuthorizationData(t){n.set(this._cookieKey,t)}async deleteAuthorizationData(){n.del(this._cookieKey)}async finishAuthProcessAfterRedirection(t){if(!r.isBrowser())return;const e=function(e){const s=r.getQueryParamsFromURL(e);let n=null;return s.prYvkey&&(n=t.serviceInfo.access+s.prYvkey),s.prYvpoll&&(n=s.prYvpoll),n}(window.location.href);if(null!==e)try{const{body:s}=await r.fetchGet(e);t.state=s}catch(e){t.state={status:i.ERROR,message:"Cannot fetch result",error:e}}}}},9710(t){class e extends Error{constructor(t,s){super(t),this.name="PryvError",this.innerObject=s,Error.captureStackTrace&&Error.captureStackTrace(this,e)}}t.exports=e},9755(t,e,s){t.exports={Service:s(3808),Connection:s(7271),Auth:s(6682),Browser:s(6136),utils:s(6518),PryvError:s(9710),version:s(6021).rE}}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,s),o.exports}s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var n=s(1870);pryv=n})();
//# sourceMappingURL=pryv-es6.js.map