{"version":3,"file":"pryv-es6.js","mappings":"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","sources":["webpack://lib-js/./components/pryv/src/Browser/CookieUtils.js","webpack://lib-js/./components/pryv/src/browser-index.js","webpack://lib-js/./components/pryv/src/lib/buildSearchParams.js","webpack://lib-js/./components/pryv/src/Auth/AuthController.js","webpack://lib-js/./components/pryv/src/ServiceAssets.js","webpack://lib-js/./components/pryv/src/Service.js","webpack://lib-js/./components/pryv/src/Auth/LoginMessages.js","webpack://lib-js/./components/pryv/src/lib/json-parser.js","webpack://lib-js/./components/pryv/src/Browser/index.js","webpack://lib-js/./components/pryv/src/utils.js","webpack://lib-js/./components/pryv/src/Auth/AuthStates.js","webpack://lib-js/./components/pryv/src/Auth/index.js","webpack://lib-js/./components/pryv/src/Connection.js","webpack://lib-js/./components/pryv/src/lib/getEventStreamed.js","webpack://lib-js/./components/pryv/src/Browser/LoginButton.js","webpack://lib-js/./components/pryv/src/lib/PryvError.js","webpack://lib-js/./components/pryv/src/index.js","webpack://lib-js/webpack/bootstrap","webpack://lib-js/webpack/runtime/global","webpack://lib-js/webpack/startup"],"sourcesContent":["/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst utils = require('../utils');\n\n/**\n * @memberof pryv.Browser\n * @namespace pryv.Browser.CookieUtils\n */\nmodule.exports = {\n  get,\n  set,\n  del\n};\n\n/**\n  * Set a local cookie\n  * @memberof pryv.Browser.CookieUtils\n  * @template T\n  * @param {string} cookieKey - The key for the cookie\n  * @param {T} value - The value (will be JSON stringified)\n  * @param {number} [expireInDays=365] - Expiration date in days from now\n  */\nfunction set (cookieKey, value, expireInDays) {\n  if (!utils.isBrowser()) return;\n  expireInDays = expireInDays || 365;\n  const myDate = new Date();\n  const hostName = window.location.hostname;\n  const path = window.location.pathname;\n  myDate.setDate(myDate.getDate() + expireInDays);\n  let cookieStr = encodeURIComponent(cookieKey) + '=' +\n    encodeURIComponent(JSON.stringify(value)) +\n    ';expires=' + myDate.toUTCString() +\n    ';domain=.' + hostName + ';path=' + path;\n  // do not add SameSite when removing a cookie\n  if (expireInDays >= 0) cookieStr += ';SameSite=Strict';\n  document.cookie = cookieStr;\n}\n\n/**\n * Return the value of a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @template T\n * @param {string} cookieKey - The key\n * @returns {T|undefined} The parsed cookie value or undefined if not found\n */\nfunction get (cookieKey) {\n  const name = encodeURIComponent(cookieKey);\n  if (!utils.isBrowser()) return;\n  const value = '; ' + document.cookie;\n  const parts = value.split('; ' + name + '=');\n  if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));\n}\n\n/**\n * Delete a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @param {string} cookieKey - The key\n */\nfunction del (cookieKey) {\n  set(cookieKey, { deleted: true }, -1);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// make lib available as `Pryv` (with capital P, deprecated) for backward-compatibility with apps importing via <script>\n// TODO: remove deprecated alias with next major version\nmodule.exports = global.Pryv = require('./index');\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Build URL search params string from an object, properly handling arrays.\n * Arrays are expanded as repeated keys: { a: ['x', 'y'] } => 'a=x&a=y'\n * @param {Object} params - Query parameters object\n * @returns {string} - URL encoded query string\n */\nfunction buildSearchParams (params) {\n  const searchParams = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (Array.isArray(value)) {\n      for (const item of value) {\n        searchParams.append(key, item);\n      }\n    } else if (value !== undefined && value !== null) {\n      searchParams.append(key, value);\n    }\n  }\n  return searchParams.toString();\n}\n\nmodule.exports = buildSearchParams;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('../utils');\nconst AuthStates = require('./AuthStates');\nconst Messages = require('./LoginMessages');\n\n/**\n * Controller for authentication flow\n * @memberof pryv.Auth\n */\nclass AuthController {\n  /**\n   * Create an AuthController\n   * @param {AuthSettings} settings - Authentication settings\n   * @param {Service} service - Pryv service instance\n   * @param {CustomLoginButton} loginButton - Login button implementation\n   */\n  constructor (settings, service, loginButton) {\n    this.settings = settings;\n    validateSettings.call(this, settings);\n\n    this.stateChangeListeners = [];\n    if (this.settings.onStateChange) {\n      this.stateChangeListeners.push(this.settings.onStateChange);\n    }\n    this.service = service;\n\n    // probably remove\n    this.languageCode = this.settings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n\n    this.loginButton = loginButton;\n\n    function validateSettings (settings) {\n      if (!settings) { throw new Error('settings cannot be null'); }\n      // -- settings\n      if (!settings.authRequest) { throw new Error('Missing settings.authRequest'); }\n\n      // -- Extract returnURL\n      settings.authRequest.returnURL =\n        this.getReturnURL(settings.authRequest.returnURL);\n\n      if (!settings.authRequest.requestingAppId) {\n        throw new Error('Missing settings.authRequest.requestingAppId');\n      }\n      if (!settings.authRequest.requestedPermissions) {\n        throw new Error('Missing settings.authRequest.requestedPermissions');\n      }\n    }\n  }\n\n  /**\n   * Initialize the auth controller. Call this right after instantiation.\n   * @returns {Promise<Service>} Promise resolving to the Service instance\n   */\n  async init () {\n    this.serviceInfo = this.service.infoSync();\n    this.state = { status: AuthStates.LOADING };\n    this.assets = await loadAssets(this);\n\n    const loginButton = this.loginButton;\n    // initialize human interaction interface\n    if (loginButton != null) {\n      this.stateChangeListeners.push(loginButton.onStateChange.bind(loginButton));\n      // autologin needs cookies/storage implemented in human interaction interface\n      await checkAutoLogin(this);\n    }\n\n    // if auto login is not prompted\n    if (this.state.status !== AuthStates.AUTHORIZED) {\n      this.state = { status: AuthStates.INITIALIZED, serviceInfo: this.serviceInfo };\n    }\n\n    if (loginButton != null && loginButton.finishAuthProcessAfterRedirection != null) {\n      // @ts-ignore - this is a valid AuthController\n      await loginButton.finishAuthProcessAfterRedirection(this);\n    }\n\n    return this.service;\n  }\n\n  /**\n   * Stops poll for auth request\n   */\n  stopAuthRequest (msg) {\n    this.state = { status: AuthStates.ERROR, message: msg };\n  }\n\n  /**\n   * Handle button click - triggers appropriate action based on current state\n   * @returns {Promise<void>}\n   */\n  async handleClick () {\n    if (isAuthorized.call(this)) {\n      this.state = { status: AuthStates.SIGNOUT };\n    } else if (isInitialized.call(this)) {\n      this.startAuthRequest();\n    } else if (isNeedSignIn.call(this)) {\n      // reopen popup (HACK for now: set to private property to avoid self-assignment)\n      this.state = this._state;\n    } else {\n      console.log('Unhandled action in \"handleClick()\" for status:', this.state.status);\n    }\n\n    function isAuthorized () {\n      return this.state.status === AuthStates.AUTHORIZED;\n    }\n    function isInitialized () {\n      return this.state.status === AuthStates.INITIALIZED;\n    }\n    function isNeedSignIn () {\n      return this.state.status === AuthStates.NEED_SIGNIN;\n    }\n  }\n\n  /**\n   * Compute the return URL for authentication redirect.\n   * Used only in browser environments.\n   * @param {string} [returnURL] - The return URL setting ('auto#', 'self#', or custom URL)\n   * @param {string} [windowLocationForTest] - Mock window.location.href for testing\n   * @param {string|Navigator} [navigatorForTests] - Mock navigator for testing\n   * @returns {string|boolean} The computed return URL, or false if using popup mode\n   */\n  getReturnURL (\n    returnURL,\n    windowLocationForTest,\n    navigatorForTests\n  ) {\n    const RETURN_URL_AUTO = 'auto';\n\n    returnURL = returnURL || RETURN_URL_AUTO + '#';\n\n    // check the trailer\n    const trailer = returnURL.slice(-1);\n    if ('#&?'.indexOf(trailer) < 0) {\n      throw new Error('Pryv access: Last character of --returnURL setting-- is not ' +\n        '\"?\", \"&\" or \"#\": ' + returnURL);\n    }\n    // auto mode for desktop\n    if (returnUrlIsAuto(returnURL) &&\n        !utils.browserIsMobileOrTablet(navigatorForTests)) {\n      return false;\n    // auto mode for mobile or self\n    } else if ((returnUrlIsAuto(returnURL) &&\n                utils.browserIsMobileOrTablet(navigatorForTests)) ||\n               returnURL.indexOf('self') === 0) {\n      // set self as return url?\n      // eventually clean-up current url from previous pryv returnURL\n      const locationHref = windowLocationForTest || window.location.href;\n      returnURL = locationHref + returnURL.substring(4);\n    }\n    return utils.cleanURLFromPrYvParams(returnURL);\n\n    function returnUrlIsAuto (returnURL) {\n      return returnURL.indexOf(RETURN_URL_AUTO) === 0;\n    }\n  }\n\n  /**\n   * Start the authentication request and polling process\n   * @returns {Promise<void>}\n   * @see https://pryv.github.io/reference/#auth-request\n   */\n  async startAuthRequest () {\n    // @ts-ignore - postAccess uses .call(this) for context\n    this.state = await postAccess.call(this);\n\n    await doPolling.call(this);\n\n    /** @this {AuthController} */\n    async function postAccess () {\n      try {\n        const { response, body } = await utils.fetchPost(\n          // @ts-ignore - this is bound via .call()\n          this.serviceInfo.access,\n          // @ts-ignore - this is bound via .call()\n          this.settings.authRequest\n        );\n        if (!response.ok) {\n          throw new Error('Access request failed: ' + JSON.stringify(body));\n        }\n        return body;\n      } catch (e) {\n        this.state = {\n          status: AuthStates.ERROR,\n          message: 'Requesting access',\n          error: e\n        };\n        throw e; // forward error\n      }\n    }\n\n    /** @this {AuthController} */\n    async function doPolling () {\n      // @ts-ignore - this is bound via .call()\n      if (this.state?.status !== AuthStates.NEED_SIGNIN) {\n        return;\n      }\n      // @ts-ignore - this is bound via .call()\n      const pollResponse = await pollAccess(this.state?.poll);\n\n      if (pollResponse.status === AuthStates.NEED_SIGNIN) {\n        // @ts-ignore - this is bound via .call()\n        setTimeout(await doPolling.bind(this), this.state?.poll_rate_ms);\n      } else {\n        this.state = pollResponse;\n      }\n\n      async function pollAccess (pollUrl) {\n        try {\n          const { response, body } = await utils.fetchGet(pollUrl);\n          if (response.status === 403 && body?.status === 'REFUSED') {\n            return { status: AuthStates.INITIALIZED };\n          }\n          return body;\n        } catch (e) {\n          return { status: AuthStates.ERROR, message: 'Error while polling for auth request', error: e };\n        }\n      }\n    }\n  }\n\n  // -------------- state listeners ---------------------\n  set state (newState) {\n    // retro-compatibility for lib-js < 2.0.9\n    newState.id = newState.status;\n\n    this._state = newState;\n\n    this.stateChangeListeners.forEach((listener) => {\n      try {\n        listener(this.state);\n      } catch (e) {\n        console.log('Error during set state ()', e);\n      }\n    });\n  }\n\n  get state () {\n    return this._state;\n  }\n}\n\n// ----------- private methods -------------\n\nasync function checkAutoLogin (authController) {\n  const loginButton = authController.loginButton;\n  if (loginButton == null) {\n    return;\n  }\n\n  const storedCredentials = await loginButton.getAuthorizationData();\n  if (storedCredentials != null) {\n    authController.state = Object.assign({}, { status: AuthStates.AUTHORIZED }, storedCredentials);\n  }\n}\n\n// ------------------ ACTIONS  ----------- //\n\nasync function loadAssets (authController) {\n  let loadedAssets = {};\n  try {\n    loadedAssets = await authController.service.assets();\n    if (typeof location !== 'undefined') {\n      await loadedAssets.loginButtonLoadCSS();\n      const thisMessages = await loadedAssets.loginButtonGetMessages();\n      if (thisMessages.LOADING) {\n        authController.messages = Messages(authController.languageCode, thisMessages);\n      } else {\n        console.log('WARNING Messages cannot be loaded using defaults: ', thisMessages);\n      }\n    }\n  } catch (e) {\n    authController.state = {\n      status: AuthStates.ERROR,\n      message: 'Cannot fetch button visuals',\n      error: e\n    };\n    throw e; // forward error\n  }\n  return loadedAssets;\n}\n\nmodule.exports = AuthController;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n\n/* global location */\n\n/**\n * Holds Pryv Service informations.\n *\n * It's returned by `service.assets()`\n *\n * @memberof pryv\n **/\nclass ServiceAssets {\n  /**\n   * Private => use ServiceAssets.setup()\n   * @param {Object} assets The content of service/info.assets properties.\n   * @param {string} assetsURL Url point to assets of the service of a Pryv platform\n   */\n  constructor (assets, assetsURL) {\n    this._assets = assets;\n    this._assetsURL = assetsURL;\n  }\n\n  /**\n   * Load Assets definition from URL\n   * @param {string} pryvServiceAssetsSourceUrl - URL to the assets definition JSON\n   * @returns {Promise<ServiceAssets>} Promise resolving to ServiceAssets instance\n   */\n  static async setup (pryvServiceAssetsSourceUrl) {\n    const { body } = await utils.fetchGet(pryvServiceAssetsSourceUrl);\n    return new ServiceAssets(body, pryvServiceAssetsSourceUrl);\n  }\n\n  /**\n   * get a value from path separated by `:`\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  get (keyPath) {\n    let result = Object.assign({}, this._assets);\n    if (keyPath) {\n      keyPath.split(':').forEach((key) => {\n        result = result[key];\n        if (typeof result === 'undefined') return result;\n      });\n    }\n    return result;\n  }\n\n  /**\n   * get an Url from path separated by `:`\n   * identical to doing assets.relativeURL(assets.get(keyPath))\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  getUrl (keyPath) {\n    const url = this.get(keyPath);\n    if (typeof url !== 'string') {\n      throw new Error(`Unexpected value for ${keyPath}: ${url}`);\n    }\n    return this.relativeURL(url);\n  }\n\n  /**\n   * get relativeUrl\n   */\n  relativeURL (url) {\n    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);\n  }\n\n  // ---------------- Default service resources\n\n  /**\n   * Set all defaults Favicon, CSS\n   */\n  async setAllDefaults () {\n    this.setFavicon();\n    await this.loadCSS();\n  }\n\n  /**\n   * Set service Favicon to Web Page\n   */\n  setFavicon () {\n    /** @type {HTMLLinkElement} */\n    // @ts-ignore - querySelector returns Element but we know it's HTMLLinkElement\n    const link = document.querySelector(\"link[rel*='icon']\") || document.createElement('link');\n    link.type = 'image/x-icon';\n    link.rel = 'shortcut icon';\n    link.href = this.relativeURL(this._assets.favicon.default.url);\n    document.getElementsByTagName('head')[0].appendChild(link);\n  }\n\n  /**\n   * Set default service CSS\n   */\n  async loadCSS () {\n    loadCSS(this.relativeURL(this._assets.css.default.url));\n  }\n\n  // ---- Login\n\n  /**\n   * Load CSS for Login button\n   */\n  async loginButtonLoadCSS () {\n    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));\n  }\n\n  /**\n   * Get HTML for Login Button\n   * @returns {Promise<string>} Promise resolving to HTML string\n   */\n  async loginButtonGetHTML () {\n    const { text } = await utils.fetchGetText(this.relativeURL(this._assets['lib-js'].buttonSignIn.html));\n    return text;\n  }\n\n  /**\n   * Get Messages strings for Login Button\n   * @returns {Promise<Object.<string, string>>} Promise resolving to messages object\n   */\n  async loginButtonGetMessages () {\n    const { body } = await utils.fetchGet(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages));\n    return body;\n  }\n}\n\nmodule.exports = ServiceAssets;\n\nfunction loadCSS (url) {\n  const head = document.getElementsByTagName('head')[0];\n  const link = document.createElement('link');\n  link.id = url;\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n  link.media = 'all';\n  head.appendChild(link);\n}\n\n/* HACK: disabling linting until code is cleaned up */\n/* eslint-disable */\n\n  /*\\\n  |*| Modified version of\n  |*| :: translate relative paths to absolute paths ::\n  |*|\n  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n  |*|\n  |*| The following code is released under the GNU Public License, version 3 or later.\n  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html\n  |*|\n  \\*/\n\nfunction relPathToAbs (baseUrlString, sRelPath) {\n  /** @type {Location|HTMLAnchorElement} */\n  var baseLocation = location;\n  if (baseUrlString) {\n    // @ts-ignore - HTMLAnchorElement has compatible URL properties\n    baseLocation = document.createElement('a');\n    baseLocation.href = baseUrlString;\n  }\n\n  var nUpLn, sDir = \"\", sPath = baseLocation.pathname.replace(/[^\\/]*$/, sRelPath.replace(/(\\/|^)(?:\\.?\\/+)+/g, \"$1\"));\n  for (var nEnd, nStart = 0; nEnd = sPath.indexOf(\"/../\", nStart), nEnd > -1; nStart = nEnd + nUpLn) {\n    nUpLn = /^\\/(?:\\.\\.\\/)*/.exec(sPath.slice(nEnd))[0].length;\n    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp(\"(?:\\\\\\/+[^\\\\\\/]*){0,\" + ((nUpLn - 1) / 3) + \"}$\"),\n      \"/\");\n  }\n  const portStr = baseLocation.port ? ':' + baseLocation.port : '';\n  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n// Connection is required at the end of this file to allow circular requires.\nconst Assets = require('./ServiceAssets.js');\n\n/**\n * @class pryv.Service\n * A Pryv.io deployment is a unique \"Service\", as an example **Pryv Lab** is a service, deployed with the domain name **pryv.me**.\n *\n * `pryv.Service` exposes tools to interact with Pryv.io at a \"Platform\" level.\n *\n *  ##### Initizalization with a service info URL\n```js\nconst service = new pryv.Service('https://reg.pryv.me/service/info');\n```\n\n- With the content of a serviceInfo configuration\n\nService information properties can be overriden with specific values. This might be usefull to test new designs on production platforms.\n\n```js\nconst serviceInfoUrl = 'https://reg.pryv.me/service/info';\nconst serviceCustomizations = {\n  name: 'Pryv Lab 2',\n  assets: {\n    definitions: 'https://pryv.github.io/assets-pryv.me/index.json'\n  }\n}\nconst service = new pryv.Service(serviceInfoUrl, serviceCustomizations);\n```\n\n * @memberof pryv\n *\n * @constructor\n * @param {string} serviceInfoUrl Url point to /service/info of a Pryv platform see: {@link https://api.pryv.com/reference/#service-info}\n */\nclass Service {\n  constructor (serviceInfoUrl, serviceCustomizations) {\n    this._serviceInfo = null;\n    this._assets = null;\n    this._polling = false;\n    this._serviceInfoUrl = serviceInfoUrl;\n    this._pryvServiceCustomizations = serviceCustomizations;\n  }\n\n  /**\n   * Return service info parameters info known of fetch it if needed.\n   * Example\n   *  - name of a platform\n   *    `const serviceName = await service.info().name`\n   * @see ServiceInfo For details on available properties.\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceInfo>} Promise to Service info Object\n   */\n  async info (forceFetch) {\n    if (forceFetch || !this._serviceInfo) {\n      let baseServiceInfo = {};\n      if (this._serviceInfoUrl) {\n        const { body } = await utils.fetchGet(this._serviceInfoUrl);\n        baseServiceInfo = body;\n      }\n      Object.assign(baseServiceInfo, this._pryvServiceCustomizations);\n      // @ts-ignore - baseServiceInfo is populated from body or customizations\n      this.setServiceInfo(baseServiceInfo);\n    }\n    return this._serviceInfo;\n  }\n\n  /**\n   * Check if a service supports High Frequency Data Sets\n   * @returns {Promise<boolean>} Promise resolving to true if HF is supported\n   */\n  async supportsHF () {\n    const infos = await this.info();\n    return (infos.features == null || infos.features.noHF !== true);\n  }\n\n  /**\n   * Check if a service has username in the hostname or in the path of the API.\n   * @returns {Promise<boolean>} Promise resolving to true if the service does not rely on DNS to find a host related to a username\n   */\n  async isDnsLess () {\n    const infos = await this.info();\n    const hostname = infos.api.split('/')[2];\n    return !hostname.includes('{username}');\n  }\n\n  /**\n   * @private\n   * @param {ServiceInfo} serviceInfo\n   */\n  setServiceInfo (serviceInfo) {\n    if (!serviceInfo.name) {\n      throw new Error('Invalid data from service/info');\n    }\n    // cleanup serviceInfo for eventual url not finishing by \"/\"\n    // code will be obsolete with next version of register\n    ['access', 'api', 'register'].forEach((key) => {\n      if (serviceInfo[key].slice(-1) !== '/') {\n        serviceInfo[key] += '/';\n      }\n    });\n    this._serviceInfo = serviceInfo;\n  }\n\n  /**\n   * Return assets property content\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceAssets|null>} Promise to ServiceAssets\n   */\n  async assets (forceFetch) {\n    if (!forceFetch && this._assets) {\n      return this._assets;\n    } else {\n      const serviceInfo = await this.info();\n      if (!serviceInfo.assets || !serviceInfo.assets.definitions) {\n        console.log('Warning: no assets for this service');\n        return null;\n      }\n      this._assets = await Assets.setup(serviceInfo.assets.definitions);\n      return this._assets;\n    }\n  }\n\n  /**\n   * Return service info parameters info known or null if not yet loaded\n   * @returns {ServiceInfo} Service Info definition\n   */\n  infoSync () {\n    return this._serviceInfo;\n  }\n\n  /**\n   * Return an API endpoint from a username and token\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {Promise<APIEndpoint>} Promise resolving to the API endpoint URL\n   */\n  async apiEndpointFor (username, token) {\n    const serviceInfo = await this.info();\n    return Service.buildAPIEndpoint(serviceInfo, username, token);\n  }\n\n  /**\n   * Return an API endpoint from a username, token and ServiceInfo.\n   * This method is rarely used. See **apiEndpointFor** as an alternative.\n   * @param {ServiceInfo} serviceInfo - The service info object containing API URL template\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {APIEndpoint} The constructed API endpoint URL\n   */\n  static buildAPIEndpoint (serviceInfo, username, token) {\n    const endpoint = serviceInfo.api.replace('{username}', username);\n    return utils.buildAPIEndpoint({ endpoint, token });\n  }\n\n  /**\n   * Issue a \"login call on the Service\" return a Connection on success\n   * **! Warning**: the token of the connection will be a \"Personal\" token that expires\n   * @see https://api.pryv.com/reference-full/#login-user\n   * @param {string} username\n   * @param {string} password\n   * @param {string} appId\n   * @param {string} [originHeader=service-info.register] Only for Node.js. If not set will use the register value of service info. In browsers this will overridden by current page location.\n   * @throws {Error} on invalid login\n   */\n  async login (username, password, appId, originHeader) {\n    const apiEndpoint = await this.apiEndpointFor(username);\n\n    const headers = {};\n    originHeader = originHeader || (await this.info()).register;\n    if (!utils.isBrowser()) {\n      headers.Origin = originHeader;\n    }\n    const { response, body } = await utils.fetchPost(\n      apiEndpoint + 'auth/login',\n      { username, password, appId },\n      headers\n    );\n\n    if (!response.ok) {\n      if (body?.error?.message) {\n        throw new Error(body.error.message);\n      }\n      throw new Error('Login failed: ' + JSON.stringify(body));\n    }\n\n    if (!body.token) {\n      throw new Error('Invalid login response: ' + JSON.stringify(body));\n    }\n    return new Connection(\n      Service.buildAPIEndpoint(await this.info(), username, body.token),\n      this // Pre load Connection with service\n    );\n  }\n}\n\nmodule.exports = Service;\n\n// Require is done after exports to allow circular references\nconst Connection = require('./Connection');\n\n/**\n * Object to handle Pryv Service Informations https://api.pryv.com/reference/#service-info\n * @typedef {Object} ServiceInfo\n * @property {string} register The URL of the register service.\n * @property {string} access The URL of the access page.\n * @property {string} api The API endpoint format.\n * @property {string} name The platform name.\n * @property {string} home The URL of the platform's home page.\n * @property {string} support The email or URL of the support page.\n * @property {string} terms The terms and conditions, in plain text or the URL displaying them.\n * @property {string} eventTypes The URL of the list of validated event types.\n * @property {Object} [assets] Holder for service specific Assets (icons, css, ...)\n * @property {string} [assets.definitions] URL to json object with assets definitions\n * @property {Object} [features] Platform feature flags\n * @property {boolean} [features.noHF] True if HF data is not supported\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nmodule.exports = get;\n\nconst Messages = {\n  LOADING: {\n    en: '...'\n  },\n  ERROR: {\n    en: 'Error',\n    fr: 'Erreur'\n  },\n  LOGIN: {\n    en: 'Signin',\n    fr: 'Login'\n  },\n  SIGNOUT_CONFIRM: {\n    en: 'Logout?',\n    fr: 'Se dÃ©connecter ?'\n  }\n};\n\nfunction get (languageCode, definitions) {\n  const myMessages = definitions || Messages;\n  const res = {};\n  Object.keys(myMessages).forEach((key) => {\n    res[key] = myMessages[key][languageCode] || myMessages[key].en;\n  });\n  return res;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// there two steps 1 find events, then eventDeletions\nconst EVENTMARKERS = ['\"events\":[', '\"eventDeletions\":['];\n\n/**\n * Stremed JSON parser for events\n */\nmodule.exports = function (foreachEvent, includeDeletions) {\n  let eventOrEventDeletions = 0; // start with event\n  let buffer = ''; // temp data\n  let body = null; // to be returned\n\n  // IN EVENTS VARS\n  let depth = 0; // level of depth in brackets\n  let inString = false; // cursor is in a String\n  let skipNextOne = false; // when a backslash is found\n  let cursorPos = 0; // position of Character Cursor\n\n  // counters\n  let eventsCount = 0;\n  let eventDeletionsCount = 0;\n\n  const states = {\n    A_BEFORE_EVENTS: 0,\n    B_IN_EVENTS: 1,\n    D_AFTER_EVENTS: 2\n  };\n\n  let state = states.A_BEFORE_EVENTS;\n\n  function processBuffer () {\n    switch (state) {\n      case states.A_BEFORE_EVENTS:\n        searchStartEvents();\n        break;\n      case states.B_IN_EVENTS:\n        processEvents();\n        break;\n      default:\n        afterEvents();\n        break;\n    }\n  }\n\n  function searchStartEvents () {\n    // search for \"events\": and happend any info before to the body\n    const n = buffer.indexOf(EVENTMARKERS[eventOrEventDeletions]);\n    if (n > 0) {\n      if (eventOrEventDeletions === 0) { // do only once\n        body = buffer.substring(0, n);\n      }\n      buffer = buffer.substr(n + EVENTMARKERS[eventOrEventDeletions].length);\n      state = states.B_IN_EVENTS;\n      processEvents();\n    }\n  }\n\n  function processEvents () {\n    /// ---- in Event\n    while (cursorPos < buffer.length && (state === states.B_IN_EVENTS)) {\n      if (skipNextOne) { // ignore next character\n        skipNextOne = false;\n        cursorPos++;\n        continue;\n      }\n      switch (buffer.charCodeAt(cursorPos)) {\n        case 93: // ]\n          if (depth === 0) { // end of events\n            if (cursorPos !== 0) {\n              throw new Error('Found trailling ] in mid-course');\n            }\n            if (eventOrEventDeletions === 0 && includeDeletions) {\n              state = states.A_BEFORE_EVENTS;\n              eventOrEventDeletions = 1; // now look for eventDeletions\n              return;\n            } else { // done\n              state = states.D_AFTER_EVENTS;\n              let eventsOrDeletionMsg = '';\n              if (eventOrEventDeletions === 1) {\n                eventsOrDeletionMsg = '\"eventDeletionsCount\":' + eventDeletionsCount + ',';\n              }\n              buffer = eventsOrDeletionMsg + '\"eventsCount\":' + eventsCount + '' + buffer.substr(1);\n            }\n          }\n          break;\n        case 92: // \\\n          skipNextOne = true;\n          break;\n        case 123: // {\n          if (!inString) depth++;\n          break;\n        case 34: // \"\n          inString = !inString;\n          break;\n        case 125: // }\n          if (!inString) depth--;\n          if (depth === 0) {\n            // ignore possible coma ',' if first char\n            const ignoreComa = (buffer.charCodeAt(0) === 44) ? 1 : 0;\n            const eventStr = buffer.substring(ignoreComa, cursorPos + 1);\n\n            if (eventOrEventDeletions === 0) {\n              eventsCount++;\n            } else {\n              eventDeletionsCount++;\n            }\n            buffer = buffer.substr(cursorPos + 1);\n            addEvent(eventStr);\n            cursorPos = -1;\n          }\n          break;\n      }\n      cursorPos++;\n    }\n  }\n\n  function afterEvents () {\n    // just happend the end of message;\n    body += buffer;\n    buffer = '';\n  }\n\n  return function (res, fn) {\n    res.setEncoding('utf8'); // Already UTF8 in browsers\n    res.on('data', chunk => {\n      buffer += chunk;\n      processBuffer();\n    });\n    res.on('end', () => {\n      let err;\n      let bodyObject;\n      try {\n        res.text = body + buffer;\n        bodyObject = res.text && JSON.parse(res.text);\n      } catch (err_) {\n        err = err_;\n        // issue #675: return the raw response if the response parsing fails\n        err.rawResponse = res.text || null;\n        // issue #876: return the http status code if the response parsing fails\n        err.statusCode = res.statusCode;\n      } finally {\n        fn(err, bodyObject);\n      }\n    });\n  };\n\n  /// --- Direct Push\n  function addEvent (strEvent) {\n    foreachEvent(JSON.parse(strEvent));\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst LoginButton = require('./LoginButton');\nconst CookieUtils = require('./CookieUtils');\nconst utils = require('../utils');\n\n/**\n * @memberof pryv\n * @namespace pryv.Browser\n */\nmodule.exports = {\n  LoginButton,\n  CookieUtils,\n  // retro-compatibility for lib-js < 2.0.9\n  AuthStates: require('../Auth/AuthStates'),\n  setupAuth: require('../Auth').setupAuth,\n  serviceInfoFromUrl: getServiceInfoFromURL\n};\n\n/**\n * Util to grab parameters from url query string\n * @param {*} url\n */\nfunction getServiceInfoFromURL (url) {\n  const queryParams = utils.getQueryParamsFromURL(url || window.location.href);\n  return queryParams.pryvServiceInfoUrl;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst regexAPIandToken = /(.+):\\/\\/(.+)@(.+)/gm;\nconst regexSchemaAndPath = /(.+):\\/\\/(.+)/gm;\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * Utilities to access Pryv API.\n * @memberof pryv\n * @namespace pryv.utils\n */\nconst utils = module.exports = {\n  /**\n   * Perform a GET request and parse JSON response\n   * @param {string} url - URL to fetch\n   * @param {Object} [queryParams={}] - Query parameters to append\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchGet (url, queryParams = {}, headers = {}) {\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const myHeaders = Object.assign({ Accept: 'application/json' }, headers);\n    const response = await fetch(url + queryStr, { headers: myHeaders });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Perform a GET request and return text response\n   * @param {string} url - URL to fetch\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, text: string}>} Promise resolving to response and text body\n   */\n  async fetchGetText (url, headers = {}) {\n    const myHeaders = Object.assign({ Accept: 'text/html' }, headers);\n    const response = await fetch(url, { headers: myHeaders });\n    const text = await response.text();\n    return { response, text };\n  },\n\n  /**\n   * Perform a POST request with JSON data\n   * @param {string} url - URL to post to\n   * @param {Object} [data] - Data to send as JSON\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchPost (url, data, headers = {}) {\n    const myHeaders = Object.assign({\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    }, headers);\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: myHeaders,\n      body: JSON.stringify(data)\n    });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Returns true is run in a browser\n   * @memberof pryv.utils\n   * @returns {boolean}\n   */\n  isBrowser: function () {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n  },\n\n  /**\n   * From a APIEndpoint URL, return an object (TokenAndAPI) with two properties\n   * @memberof pryv.utils\n   * @param {APIEndpoint} apiEndpoint\n   * @returns {TokenAndEndpoint}\n   */\n  extractTokenAndAPIEndpoint: function (apiEndpoint) {\n    regexAPIandToken.lastIndex = 0;\n    const res = regexAPIandToken.exec(apiEndpoint);\n\n    if (res !== null) { // has token\n      // add a trailing '/' to end point if missing\n      if (!res[3].endsWith('/')) {\n        res[3] += '/';\n      }\n      return { endpoint: res[1] + '://' + res[3], token: res[2] };\n    }\n    // else check if valid url\n    regexSchemaAndPath.lastIndex = 0;\n    const res2 = regexSchemaAndPath.exec(apiEndpoint);\n    if (res2 === null) {\n      throw new Error('Cannot find endpoint, invalid URL format');\n    }\n    // add a trailing '/' to end point if missing\n    if (!res2[2].endsWith('/')) {\n      res2[2] += '/';\n    }\n\n    return { endpoint: res2[1] + '://' + res2[2], token: null };\n  },\n\n  /**\n   * Get a APIEndpoint URL from a TokenAndAPI object\n   * @memberof pryv.utils\n   * @param {TokenAndEndpoint} tokenAndAPI\n   * @returns {APIEndpoint}\n   */\n  buildAPIEndpoint: function (tokenAndAPI) {\n    if (!tokenAndAPI.token) {\n      let res = tokenAndAPI.endpoint + '';\n      if (!tokenAndAPI.endpoint.endsWith('/')) {\n        res += '/';\n      }\n      return res;\n    }\n    regexSchemaAndPath.lastIndex = 0;\n    const res = regexSchemaAndPath.exec(tokenAndAPI.endpoint);\n    // add a trailing '/' to end point if missing\n    if (!res[2].endsWith('/')) {\n      res[2] += '/';\n    }\n    return res[1] + '://' + tokenAndAPI.token + '@' + res[2];\n  },\n\n  /**\n   * Check if the browser is running on a mobile device or tablet\n   * @memberof pryv.utils\n   * @param {string|Navigator} [navigator] - Navigator object or user agent string (for testing)\n   * @returns {boolean} True if mobile or tablet\n   */\n  browserIsMobileOrTablet: function (navigator) {\n    if (navigator == null) {\n      return false;\n    }\n    let check = false;\n    // @ts-ignore - navigator is Navigator when not null\n    // eslint-disable-next-line no-useless-escape\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || navigator.opera);\n    return check;\n  },\n\n  /**\n   * Remove Pryv-specific query parameters from URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to clean\n   * @returns {string} URL without prYv* parameters\n   */\n  cleanURLFromPrYvParams: function (url) {\n    const PRYV_REGEXP = /[?#&]+prYv([^=&]+)=([^&]*)/g;\n    return url.replace(PRYV_REGEXP, '');\n  },\n\n  /**\n   * Extract query parameters from a URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to parse\n   * @returns {Object.<string, string>} Object with key-value pairs of query parameters\n   */\n  getQueryParamsFromURL: function (url) {\n    /** @type {Object.<string, string>} */\n    const vars = {};\n    const QUERY_REGEXP = /[?#&]+([^=&]+)=([^&]*)/g;\n    url.replace(QUERY_REGEXP,\n      // @ts-ignore - replace callback is used for side effects\n      function (m, key, value) {\n        vars[key] = decodeURIComponent(value);\n      });\n    return vars;\n  }\n};\n\n// TODO: remove following deprecated aliases with next major version\n\n/**\n * @deprecated Renamed to `extractTokenAndAPIEndpoint()`\n */\nutils.extractTokenAndApiEndpoint = utils.extractTokenAndAPIEndpoint;\n\n/**\n * @deprecated Renamed to `buildAPIEndpoint()`\n */\n// TODO: remove deprecated alias with next major version\nutils.buildPryvApiEndpoint = utils.buildAPIEndpoint;\n\n// --------------- typedfs ------------------------------- //\n\n/**\n * An object with two properties: token & apiEndpoint\n * @typedef {Object} TokenAndEndpoint\n * @property {string} [token] Authorization token\n * @property {string} endpoint url of API endpoint\n */\n\n/**\n * A String url of the form http(s)://{token}@{apiEndpoint}\n * @typedef {string} APIEndpoint\n */\n\n/**\n * Common Meta are returned by each standard call on the API https://api.pryv.com/reference/#in-method-results\n * @typedef {Object} CommonMeta\n * @property {string} apiVersion The version of the API in the form {major}.{minor}.{revision}. Mirrored in HTTP header API-Version.\n * @property {number} serverTime The current server time as a timestamp in second. Keeping track of server time is necessary to properly handle time in API calls.\n * @property {string} serial The serial will change every time the core or register is updated. If you compare it with the serial of a previous response and notice a difference, you should reload the service information.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * The possible auth states:\n * ERROR, LOADING, INITIALIZED, NEED_SIGNIN, AUTHORIZED, SIGNOUT, REFUSED\n * @readonly\n * @enum {string}\n * @memberof pryv.Browser\n */\nmodule.exports = {\n  ERROR: 'ERROR',\n  LOADING: 'LOADING',\n  INITIALIZED: 'INITIALIZED',\n  NEED_SIGNIN: 'NEED_SIGNIN',\n  AUTHORIZED: 'ACCEPTED',\n  SIGNOUT: 'SIGNOUT',\n  REFUSED: 'REFUSED'\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst AuthController = require('./AuthController');\nconst AuthStates = require('./AuthStates');\nconst LoginButton = require('../Browser/LoginButton');\nconst Service = require('../Service');\n\n/**\n * @memberof pryv\n * @namespace pryv.Auth\n */\nmodule.exports = {\n  setupAuth,\n  AuthStates,\n  AuthController\n};\n\n/**\n * Start an authentication process\n *\n * @memberof pryv.Auth\n * @param {Object} settings\n * @param {Object} settings.authRequest See https://api.pryv.com/reference/#data-structure-access\n * @param {string} [settings.authRequest.languageCode] Language code, as per LoginButton Messages: 'en', 'fr\n * @param {string} settings.authRequest.requestingAppId Application id, ex: 'my-app'\n * @param {Object} settings.authRequest.requestedPermissions\n * @param {string | boolean} settings.authRequest.returnURL : false, // set this if you don't want a popup\n * @param {string} [settings.authRequest.referer] To track registration source\n * @param {string} settings.spanButtonID set and <span> id in DOM to insert default login button or null for custom\n * @param {Function} settings.onStateChange\n * @param {string} [settings.returnURL] Set to \"self#\" to disable popup and force using the same page\n * @param {string} serviceInfoUrl\n * @param {Object} [serviceCustomizations] override properties of serviceInfoUrl\n * @returns {Promise<Service>}\n */\nasync function setupAuth (settings, serviceInfoUrl, serviceCustomizations, HumanInteraction = LoginButton) {\n  const service = new Service(serviceInfoUrl, serviceCustomizations);\n  await service.info();\n\n  const humanInteraction = new HumanInteraction(settings, service);\n  await humanInteraction.init();\n\n  return service;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\nconst jsonParser = require('./lib/json-parser');\nconst libGetEventStreamed = require('./lib/getEventStreamed');\nconst PryvError = require('./lib/PryvError');\nconst buildSearchParams = require('./lib/buildSearchParams');\n\n/**\n * @class Connection\n * A connection is an authenticated link to a Pryv.io account.\n *\n * @type {TokenAndEndpoint}\n *\n * @example\n * create a connection for the user 'tom' on 'pryv.me' backend with the token 'TTZycvBTiq'\n * const conn = new pryv.Connection('https://TTZycvBTiq@tom.pryv.me');\n *\n * @property {string} [token]\n * @property {string} endpoint\n * @memberof pryv\n *\n * @constructor\n * @this {Connection}\n * @param {APIEndpoint} apiEndpoint\n * @param {pryv.Service} [service] - eventually initialize Connection with a Service\n */\nclass Connection {\n  constructor (apiEndpoint, service) {\n    const { token, endpoint } = utils.extractTokenAndAPIEndpoint(apiEndpoint);\n    this.token = token;\n    this.endpoint = endpoint;\n    this.options = {};\n    this.options.chunkSize = 1000;\n    this._deltaTime = { value: 0, weight: 0 };\n    if (service && !(service instanceof Service)) {\n      throw new Error('Invalid service param');\n    }\n    this._service = service;\n  }\n\n  /**\n   * get pryv.Service object relative to this connection\n   * @readonly\n   * @property {pryv.Service} service\n   */\n  get service () {\n    if (this._service) return this._service;\n    this._service = new Service(this.endpoint + 'service/info');\n    return this._service;\n  }\n\n  /**\n   * Get username for this connection.\n   * It's async as it's constructed from access info.\n   * @returns {Promise<string>} Promise resolving to the username\n   */\n  async username () {\n    const accessInfo = await this.accessInfo();\n    if (accessInfo.error) {\n      throw new PryvError(\n        'Failed fetching accessinfo: ' + accessInfo.error.message,\n        accessInfo.error\n      );\n    }\n    // @ts-ignore - username is always a string\n    return accessInfo.user.username;\n  }\n\n  /**\n   * Get access info for this connection.\n   * It's async as it is fetched from the API.\n   * @returns {Promise<AccessInfo>} Promise resolving to the access info\n   */\n  async accessInfo () {\n    return this.get('access-info', null);\n  }\n\n  /**\n   * Issue a Batch call https://api.pryv.com/reference/#call-batch .\n   * arrayOfAPICalls will be splited in multiple calls if the size is > `conn.options.chunkSize` .\n   * Default chunksize is 1000.\n   * @param {Array.<MethodCall>} arrayOfAPICalls Array of Method Calls\n   * @param {Function} [progress] Return percentage of progress (0 - 100);\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    function httpHandler (batchCall) {\n      return this.post('', batchCall);\n    }\n    return await this._chunkedBatchCall(\n      arrayOfAPICalls,\n      progress,\n      httpHandler.bind(this)\n    );\n  }\n\n  /**\n   * Make one API call\n   * @param {string} method - Method ID (e.g., 'events.get', 'streams.create')\n   * @param {Object|Array} [params={}] - The params associated with this method\n   * @param {string} [expectedKey] - If given, returns the value of this key or throws an error if not present\n   * @returns {Promise<Object>} Promise resolving to the API result or the value of expectedKey\n   * @throws {Error} If .error is present in the response or expectedKey is missing\n   */\n  async apiOne (method, params = {}, expectedKey) {\n    const result = await this.api([{ method, params }]);\n    if (\n      result[0] == null ||\n      result[0].error ||\n      (expectedKey != null && result[0][expectedKey] == null)\n    ) {\n      const innerObject = result[0]?.error || result;\n      throw new PryvError(\n        `Error for api method: \"${method}\" with params: ${JSON.stringify(\n          params\n        )} >> Result: ${JSON.stringify(innerObject)}\"`,\n        innerObject\n      );\n    }\n    if (expectedKey != null) return result[0][expectedKey];\n    return result[0];\n  }\n\n  /**\n   * Revoke : Delete the accessId\n   * - Do not throw error if access is already revoked, just return null;\n   * @param {boolean} [throwOnFail=true] - if set to false do not throw Error on failure\n   * @param {Connection} [usingConnection] - specify which connection issues the revoke, might be necessary when selfRevoke\n   * @returns {Promise<Object|null>} Promise resolving to deletion result or null if already revoked/failed\n   */\n  async revoke (throwOnFail = true, usingConnection) {\n    usingConnection = usingConnection || this;\n    let accessInfo = null;\n    // get accessId\n    try {\n      accessInfo = await this.accessInfo();\n    } catch (e) {\n      if (e.response?.body?.error?.id === 'invalid-access-token') {\n        return null; // Already revoked OK..\n      }\n      if (throwOnFail) throw e;\n      return null;\n    }\n    // delete access\n    try {\n      const result = usingConnection.apiOne('accesses.delete', {\n        id: accessInfo.id\n      });\n      return result;\n    } catch (e) {\n      if (throwOnFail) throw e;\n      return null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  async _chunkedBatchCall (arrayOfAPICalls, progress, callHandler) {\n    if (!Array.isArray(arrayOfAPICalls)) {\n      throw new Error('Connection.api() takes an array as input');\n    }\n\n    const res = [];\n    let percent = 0;\n    for (\n      let cursor = 0;\n      arrayOfAPICalls.length >= cursor;\n      cursor += this.options.chunkSize\n    ) {\n      const thisBatch = [];\n      const cursorMax = Math.min(\n        cursor + this.options.chunkSize,\n        arrayOfAPICalls.length\n      );\n      // copy only method and params into a back call to be exuted\n      for (let i = cursor; i < cursorMax; i++) {\n        thisBatch.push({\n          method: arrayOfAPICalls[i].method,\n          params: arrayOfAPICalls[i].params\n        });\n      }\n      const resRequest = await callHandler(thisBatch);\n      // result checks\n      if (!resRequest || !Array.isArray(resRequest.results)) {\n        throw new Error(\n          'API call result is not an Array: ' + JSON.stringify(resRequest)\n        );\n      }\n      if (resRequest.results.length !== thisBatch.length) {\n        throw new Error(\n          'API call result Array does not match request: ' +\n            JSON.stringify(resRequest)\n        );\n      }\n\n      // eventually call handleResult\n      for (let i = 0; i < resRequest.results.length; i++) {\n        if (arrayOfAPICalls[i + cursor].handleResult) {\n          await arrayOfAPICalls[i + cursor].handleResult.call(\n            null,\n            resRequest.results[i],\n            thisBatch[i] // request\n          );\n        }\n      }\n      Array.prototype.push.apply(res, resRequest.results);\n      percent = Math.round((100 * res.length) / arrayOfAPICalls.length);\n      if (progress) {\n        progress(percent, res);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Post to API and return results\n   * @param {string} path - API path\n   * @param {(Array | Object)} data - Data to post\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async post (path, data) {\n    const now = getTimestamp();\n    const res = await this._postFetch(path, data);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Post object as JSON to API\n   * @param {string} path - API path\n   * @param {Array | Object} data - Data to post as JSON\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetch (path, data) {\n    return this._postFetchRaw(path, JSON.stringify(data), 'application/json');\n  }\n\n  /**\n   * @private\n   * Raw Post to API\n   * @param {string} path - API path\n   * @param {any} data - Raw data to post\n   * @param {string} [contentType] - Content-Type header (optional, allows fetch to set it for FormData)\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetchRaw (path, data, contentType) {\n    const headers = {\n      Authorization: this.token,\n      Accept: 'application/json'\n    };\n    // optional for form-data llowing fetch to\n    // automatically set multipart/form-data with the correct boundary\n    if (contentType) {\n      headers['Content-Type'] = contentType;\n    }\n    const response = await fetch(this.endpoint + path, {\n      method: 'POST',\n      headers,\n      body: data\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * GET from API and return results\n   * @param {string} path - API path\n   * @param {Object} [queryParams] - Query parameters\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async get (path, queryParams) {\n    const now = getTimestamp();\n    const res = await this._getFetchRaw(path, queryParams);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Raw GET from API\n   * @param {string} path - API path\n   * @param {Object} [queryParams={}] - Query parameters\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _getFetchRaw (path, queryParams = {}) {\n    path = path || '';\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + buildSearchParams(queryParams);\n    }\n    const response = await fetch(this.endpoint + path + queryStr, {\n      headers: {\n        Authorization: this.token,\n        Accept: 'application/json'\n      }\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * Add data points to an HF (High Frequency) series event (flatJSON format)\n   * @param {string} eventId - The HF event ID\n   * @param {string[]} fields - Array of field names for the series\n   * @param {Array<Array<number|string>>} points - Array of data points, each point is an array of values\n   * @returns {Promise<HFSeriesAddResult>} Promise resolving to status response\n   * @see https://api.pryv.com/reference/#add-hf-series-data-points\n   */\n  async addPointsToHFEvent (eventId, fields, points) {\n    const res = await this.post('events/' + eventId + '/series', {\n      format: 'flatJSON',\n      fields,\n      points\n    });\n    if (res.status !== 'ok') {\n      throw new Error('Failed loading serie: ' + JSON.stringify(res.status));\n    }\n    return res;\n  }\n\n  /**\n   * Streamed get Event.\n   * @see https://api.pryv.com/reference/#get-events\n   * @param {Object} queryParams See `events.get` parameters\n   * @param {Function} forEachEvent Function taking one event as parameter. Will be called for each event\n   * @returns {Promise<Object>} Promise to result.body transformed with `eventsCount: {count}` replacing `events: [...]`\n   */\n  async getEventsStreamed (queryParams, forEachEvent) {\n    const myParser = jsonParser(forEachEvent, queryParams.includeDeletions);\n    const res = await libGetEventStreamed(this, queryParams, myParser);\n    const now = getTimestamp();\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * Create an event with attached file\n   * NODE.jS ONLY\n   * @param {Event} event\n   * @param {string} filePath\n   */\n  async createEventWithFile (event, filePath) {\n    const fs = require('fs');\n    const path = require('path');\n\n    if (!fs || !path) {\n      throw new Error('createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.');\n    }\n\n    const fileName = path.basename(filePath);\n    const mimeType = getMimeType(path.extname(filePath));\n    const fileBlob = await fs.openAsBlob(filePath, { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('event', JSON.stringify(event));\n    formData.append('file', fileBlob, fileName);\n\n    const now = getTimestamp();\n    const { body } = await this._postFetchRaw('events', formData);\n    this._handleMeta(body, now);\n    return body;\n  }\n\n  /**\n   * Create an event from a Buffer\n   * @param {Object} event\n   * @param {Buffer|Blob} bufferData - Buffer for node, Blob for browser\n   * @param {string} filename\n   */\n  async createEventWithFileFromBuffer (event, bufferData, filename) {\n    const mimeType = getMimeType(getExtname(filename));\n    const fileBlob = bufferData instanceof Blob\n      ? bufferData\n      // @ts-ignore - Buffer is valid for Blob in Node.js\n      : new Blob([bufferData], { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('file', fileBlob, filename);\n    const body = await this.createEventWithFormData(event, formData);\n    return body;\n  }\n\n  /**\n   * Create an event with attached formData\n   * !! BROWSER ONLY\n   * @param {Event} event\n   * @param {FormData} formData https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\n   */\n  async createEventWithFormData (event, formData) {\n    formData.append('event', JSON.stringify(event));\n    const { body } = await this._postFetchRaw('events', formData);\n    return body;\n  }\n\n  /**\n   * Difference in seconds between the Pryv.io API and local time\n   * deltaTime is refined at each (non-raw) API call\n   * @readonly\n   * @property {number} deltaTime\n   */\n  get deltaTime () {\n    return this._deltaTime.value;\n  }\n\n  /**\n   * API endpoint of this connection (includes token if present)\n   * @readonly\n   * @property {APIEndpoint} apiEndpoint\n   */\n  get apiEndpoint () {\n    return utils.buildAPIEndpoint(this);\n  }\n\n  // private method that handle meta data parsing\n  _handleMeta (res, requestLocalTimestamp) {\n    if (!res.meta) throw new Error('Cannot find .meta in response.');\n    if (!res.meta.serverTime) { throw new Error('Cannot find .meta.serverTime in response.'); }\n\n    // update deltaTime and weight it\n    this._deltaTime.value =\n      (this._deltaTime.value * this._deltaTime.weight +\n        res.meta.serverTime -\n        requestLocalTimestamp) /\n      ++this._deltaTime.weight;\n  }\n}\n\nmodule.exports = Connection;\n\nfunction getTimestamp () {\n  return Date.now() / 1000;\n}\n\nconst MIME_TYPES = {\n  '.png': 'image/png',\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.gif': 'image/gif',\n  '.webp': 'image/webp',\n  '.svg': 'image/svg+xml',\n  '.bmp': 'image/bmp',\n  '.ico': 'image/x-icon',\n  '.pdf': 'application/pdf',\n  '.json': 'application/json',\n  '.xml': 'application/xml',\n  '.zip': 'application/zip',\n  '.gz': 'application/gzip',\n  '.tar': 'application/x-tar',\n  '.txt': 'text/plain',\n  '.html': 'text/html',\n  '.htm': 'text/html',\n  '.css': 'text/css',\n  '.js': 'application/javascript',\n  '.mjs': 'application/javascript',\n  '.mp3': 'audio/mpeg',\n  '.wav': 'audio/wav',\n  '.ogg': 'audio/ogg',\n  '.mp4': 'video/mp4',\n  '.webm': 'video/webm',\n  '.avi': 'video/x-msvideo',\n  '.mov': 'video/quicktime'\n};\n\nfunction getMimeType (ext) {\n  return MIME_TYPES[ext.toLowerCase()] || 'application/octet-stream';\n}\n\nfunction getExtname (filename) {\n  const lastDot = filename.lastIndexOf('.');\n  return lastDot >= 0 ? filename.slice(lastDot) : '';\n}\n\n// service is require \"after\" to allow circular require\nconst Service = require('./Service');\n\n/**\n * API Method call, for batch call https://api.pryv.com/reference/#call-batch\n * @typedef {Object} MethodCall\n * @property {string} method - The method id\n * @property {(Object|Array)}  params - The call parameters as required by the method.\n * @property {(Function|Promise)} [handleResult] - Will be called with the result corresponding to this specific call.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/* global fetch */\n\nconst buildSearchParams = require('./buildSearchParams');\n\nmodule.exports = getEventStreamed;\n\nasync function getEventStreamed (conn, queryParam, parser) {\n  /**\n   * Holds Parser's settings\n   */\n  const parserSettings = {\n    ondata: null,\n    onend: null,\n    encoding: 'utf8'\n  };\n\n  /**\n   * Mock Response\n   */\n  const fakeRes = {\n    setEncoding: function (encoding) {\n      parserSettings.encoding = encoding;\n    }, // will receive 'data' and 'end' callbacks\n    on: function (key, f) {\n      parserSettings['on' + key] = f;\n    }\n  };\n\n  /**\n   * Holds results from the parser\n   */\n  let errResult;\n  let bodyObjectResult;\n  /**\n   *\n   */\n  parser(fakeRes, function (err, bodyObject) {\n    errResult = err;\n    bodyObjectResult = bodyObject;\n  });\n\n  // ------------   fetch ------------------- //\n  const url = new URL(conn.endpoint + 'events');\n  url.search = buildSearchParams(queryParam);\n  const fetchParams = { method: 'GET', headers: { Accept: 'application/json' } };\n  if (conn.token) fetchParams.headers.Authorization = conn.token;\n\n  const response = await fetch(url, fetchParams);\n  const reader = response.body.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    parserSettings.ondata(new TextDecoder(parserSettings.encoding).decode(value));\n    if (done) { parserSettings.onend(); break; }\n  }\n\n  if (errResult) {\n    throw new Error(errResult);\n  }\n\n  // We're done!\n  const result = {\n    text: fakeRes.text, // from the parser\n    body: bodyObjectResult, // from the parser\n    statusCode: response.status,\n    headers: {}\n  };\n  // add headers to result\n  // @ts-ignore - Headers.entries() exists in modern environments\n  for (const pair of response.headers.entries()) {\n    result.headers[pair[0]] = pair[1];\n  }\n\n  return result;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Cookies = require('./CookieUtils');\nconst AuthStates = require('../Auth/AuthStates');\nconst AuthController = require('../Auth/AuthController');\nconst Messages = require('../Auth/LoginMessages');\nconst utils = require('../utils');\n\n/* global location, confirm */\n\n/**\n * @memberof pryv.Browser\n */\nclass LoginButton {\n  constructor (authSettings, service) {\n    this.authSettings = authSettings;\n    this.service = service;\n    this.serviceInfo = service.infoSync();\n  }\n\n  /**\n   * setup button and load assets\n   */\n  async init () {\n    // initialize button visuals\n    setupButton(this);\n    this.languageCode = this.authSettings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      await loadAssets(this);\n    }\n    // set cookie key for authorization data\n    this._cookieKey = 'pryv-libjs-' + this.authSettings.authRequest.requestingAppId;\n\n    // initialize controller\n    this.auth = new AuthController(this.authSettings, this.service, this);\n    await this.auth.init();\n\n    return this.service;\n  }\n\n  onClick () {\n    this.auth.handleClick();\n  }\n\n  async onStateChange (state) {\n    switch (state.status) {\n      case AuthStates.LOADING:\n        this.text = getLoadingMessage(this);\n        break;\n      case AuthStates.INITIALIZED:\n        this.text = getInitializedMessage(this, this.serviceInfo.name);\n        break;\n      case AuthStates.NEED_SIGNIN: {\n        const loginUrl = state.authUrl || state.url; // url is deprecated\n        if (this.authSettings.authRequest.returnURL) { // open on same page (no Popup)\n          location.href = loginUrl;\n          return;\n        } else {\n          startLoginScreen(this, loginUrl);\n        }\n        break;\n      }\n      case AuthStates.AUTHORIZED:\n        this.text = state.username;\n        this.saveAuthorizationData({\n          apiEndpoint: state.apiEndpoint,\n          username: state.username\n        });\n        break;\n      case AuthStates.SIGNOUT: {\n        const message = this.messages.SIGNOUT_CONFIRM ? this.messages.SIGNOUT_CONFIRM : 'Logout ?';\n        if (confirm(message)) {\n          this.deleteAuthorizationData();\n          this.auth.init();\n        }\n        break;\n      }\n      case AuthStates.ERROR:\n        this.text = getErrorMessage(this, state.message);\n        break;\n      default:\n        console.log('WARNING Unhandled state for Login: ' + state.status);\n    }\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      // @ts-ignore\n      this.loginButtonText.innerHTML = this.text;\n    }\n  }\n\n  getAuthorizationData () {\n    return Cookies.get(this._cookieKey);\n  }\n\n  saveAuthorizationData (authData) {\n    Cookies.set(this._cookieKey, authData);\n  }\n\n  async deleteAuthorizationData () {\n    Cookies.del(this._cookieKey);\n  }\n\n  /**\n   * not mandatory to implement as non-browsers don't have this behaviour\n   * @param {*} authController\n   */\n  async finishAuthProcessAfterRedirection (authController) {\n    // this step should be applied only for the browser\n    if (!utils.isBrowser()) return;\n\n    // 3. Check if there is a prYvkey as result of \"out of page login\"\n    const url = window.location.href;\n    const pollUrl = retrievePollUrl(url);\n    if (pollUrl !== null) {\n      try {\n        const { body } = await utils.fetchGet(pollUrl);\n        authController.state = body;\n      } catch (e) {\n        authController.state = {\n          status: AuthStates.ERROR,\n          message: 'Cannot fetch result',\n          error: e\n        };\n      }\n    }\n\n    function retrievePollUrl (url) {\n      const params = utils.getQueryParamsFromURL(url);\n      let pollUrl = null;\n      if (params.prYvkey) { // deprecated method - To be removed\n        pollUrl = authController.serviceInfo.access + params.prYvkey;\n      }\n      if (params.prYvpoll) {\n        pollUrl = params.prYvpoll;\n      }\n      return pollUrl;\n    }\n  }\n}\n\nmodule.exports = LoginButton;\n\nasync function startLoginScreen (loginButton, authUrl) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n  const width = 400;\n  const height = 620;\n  const left = Math.floor(screenX + ((outerWidth - width) / 2));\n  const top = Math.floor(screenY + ((outerHeight - height) / 2.5));\n  const features = (\n    'width=' + width +\n    ',height=' + height +\n    ',left=' + left +\n    ',top=' + top +\n    ',scrollbars=yes'\n  );\n  loginButton.popup = window.open(authUrl, 'prYv Sign-in', features);\n\n  if (!loginButton.popup) {\n    // loginButton.auth.stopAuthRequest('FAILED_TO_OPEN_WINDOW');\n    console.log('Pop-up blocked. A second click should allow it.');\n  } else if (window.focus) {\n    loginButton.popup.focus();\n  }\n}\n\nfunction setupButton (loginBtn) {\n  loginBtn.loginButtonSpan = document.getElementById(loginBtn.authSettings.spanButtonID);\n\n  if (!loginBtn.loginButtonSpan) {\n    console.log('WARNING: pryv.Browser initialized with no spanButtonID');\n  } else {\n    // up to the time the button is loaded use the Span to display eventual\n    // error messages\n    loginBtn.loginButtonText = loginBtn.loginButtonSpan;\n\n    // bind actions dynamically to the button click\n    loginBtn.loginButtonSpan.addEventListener('click', loginBtn.onClick.bind(loginBtn));\n  }\n}\n\n/**\n * Loads the style from the service info\n */\nasync function loadAssets (loginBtn) {\n  const assets = await loginBtn.service.assets();\n  loginBtn.loginButtonSpan.innerHTML = await assets.loginButtonGetHTML();\n  loginBtn.loginButtonText = document.getElementById('pryv-access-btn-text');\n}\n\nfunction getErrorMessage (loginButton, message) {\n  return loginButton.messages.ERROR + ': ' + message;\n}\n\nfunction getLoadingMessage (loginButton) {\n  return loginButton.messages.LOADING;\n}\n\nfunction getInitializedMessage (loginButton, serviceName) {\n  return loginButton.messages.LOGIN + ': ' + serviceName;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Custom error class for Pryv library errors.\n * Includes an innerObject property for wrapping underlying errors.\n * @extends Error\n */\nclass PryvError extends Error {\n  /**\n   * Create a PryvError\n   * @param {string} message - Error message\n   * @param {Error|Object} [innerObject] - The underlying error or object that caused this error\n   */\n  constructor (message, innerObject) {\n    super(message);\n    this.name = 'PryvError';\n    /** @type {Error|Object|undefined} */\n    this.innerObject = innerObject;\n\n    // Maintains proper stack trace for where error was thrown (only in V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, PryvError);\n    }\n  }\n}\n\nmodule.exports = PryvError;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * `pryv` library\n * @exports pryv\n * @property {pryv.Service} Service - To interact with Pryv.io at a \"Platform level\"\n * @property {pryv.Connection} Connection - To interact with an individual's (user) data set\n * @property {pryv.Browser} Browser - Browser Tools - Access request helpers and visuals (button)\n * @property {pryv.utils} utils - Exposes some utils for HTTP calls and tools to manipulate Pryv's API endpoints\n * @property {pryv.PryvError} PryvError - Custom error class with innerObject support\n */\nmodule.exports = {\n  Service: require('./Service'),\n  Connection: require('./Connection'),\n  Auth: require('./Auth'),\n  Browser: require('./Browser'),\n  utils: require('./utils'),\n  PryvError: require('./lib/PryvError'),\n  version: require('../package.json').version\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(1870);\n"],"names":["utils","set","cookieKey","value","expireInDays","isBrowser","myDate","Date","hostName","window","location","hostname","path","pathname","setDate","getDate","cookieStr","encodeURIComponent","JSON","stringify","toUTCString","document","cookie","module","exports","get","name","parts","split","length","parse","decodeURIComponent","pop","shift","del","deleted","g","Pryv","params","searchParams","URLSearchParams","key","Object","entries","Array","isArray","item","append","toString","AuthStates","Messages","constructor","settings","service","loginButton","this","Error","authRequest","returnURL","getReturnURL","requestingAppId","requestedPermissions","call","stateChangeListeners","onStateChange","push","languageCode","messages","init","serviceInfo","infoSync","state","status","LOADING","assets","async","authController","loadedAssets","loginButtonLoadCSS","thisMessages","loginButtonGetMessages","console","log","e","ERROR","message","error","loadAssets","bind","storedCredentials","getAuthorizationData","assign","AUTHORIZED","checkAutoLogin","INITIALIZED","finishAuthProcessAfterRedirection","stopAuthRequest","msg","handleClick","startAuthRequest","NEED_SIGNIN","_state","SIGNOUT","windowLocationForTest","navigatorForTests","RETURN_URL_AUTO","trailer","slice","indexOf","returnUrlIsAuto","browserIsMobileOrTablet","href","substring","cleanURLFromPrYvParams","response","body","fetchPost","access","ok","doPolling","pollResponse","pollUrl","fetchGet","pollAccess","poll","setTimeout","poll_rate_ms","newState","id","forEach","listener","ServiceAssets","assetsURL","_assets","_assetsURL","setup","pryvServiceAssetsSourceUrl","keyPath","result","getUrl","url","relativeURL","baseUrlString","sRelPath","baseLocation","createElement","nUpLn","nEnd","sDir","sPath","replace","nStart","exec","RegExp","portStr","port","protocol","substr","relPathToAbs","baseUrl","setAllDefaults","setFavicon","loadCSS","link","querySelector","type","rel","favicon","default","getElementsByTagName","appendChild","css","buttonSignIn","loginButtonGetHTML","text","fetchGetText","html","head","media","Assets","Service","serviceInfoUrl","serviceCustomizations","_serviceInfo","_polling","_serviceInfoUrl","_pryvServiceCustomizations","info","forceFetch","baseServiceInfo","setServiceInfo","supportsHF","infos","features","noHF","isDnsLess","api","includes","definitions","apiEndpointFor","username","token","buildAPIEndpoint","endpoint","login","password","appId","originHeader","apiEndpoint","headers","register","Origin","Connection","myMessages","res","keys","en","fr","LOGIN","SIGNOUT_CONFIRM","EVENTMARKERS","foreachEvent","includeDeletions","eventOrEventDeletions","buffer","depth","inString","skipNextOne","cursorPos","eventsCount","eventDeletionsCount","processEvents","charCodeAt","eventsOrDeletionMsg","ignoreComa","eventStr","addEvent","fn","setEncoding","on","chunk","n","searchStartEvents","processBuffer","err","bodyObject","err_","rawResponse","statusCode","strEvent","LoginButton","CookieUtils","setupAuth","serviceInfoFromUrl","getQueryParamsFromURL","pryvServiceInfoUrl","regexAPIandToken","regexSchemaAndPath","buildSearchParams","queryParams","queryStr","myHeaders","Accept","fetch","json","data","method","extractTokenAndAPIEndpoint","lastIndex","endsWith","res2","tokenAndAPI","navigator","check","a","userAgent","vendor","opera","test","vars","m","extractTokenAndApiEndpoint","buildPryvApiEndpoint","REFUSED","AuthController","HumanInteraction","humanInteraction","jsonParser","libGetEventStreamed","PryvError","getTimestamp","now","options","chunkSize","_deltaTime","weight","_service","accessInfo","user","arrayOfAPICalls","progress","_chunkedBatchCall","batchCall","post","apiOne","expectedKey","innerObject","revoke","throwOnFail","usingConnection","callHandler","percent","cursor","thisBatch","cursorMax","Math","min","i","resRequest","results","handleResult","prototype","apply","round","_postFetch","_handleMeta","_postFetchRaw","contentType","Authorization","_getFetchRaw","addPointsToHFEvent","eventId","fields","points","format","getEventsStreamed","forEachEvent","myParser","createEventWithFile","event","filePath","fs","fileName","basename","mimeType","getMimeType","extname","fileBlob","openAsBlob","formData","FormData","createEventWithFileFromBuffer","bufferData","filename","lastDot","lastIndexOf","getExtname","Blob","createEventWithFormData","deltaTime","requestLocalTimestamp","meta","serverTime","MIME_TYPES","ext","toLowerCase","conn","queryParam","parser","parserSettings","ondata","onend","encoding","fakeRes","f","errResult","bodyObjectResult","URL","search","fetchParams","reader","getReader","done","read","TextDecoder","decode","pair","Cookies","authSettings","loginBtn","loginButtonSpan","getElementById","spanButtonID","loginButtonText","addEventListener","onClick","innerHTML","_cookieKey","auth","serviceName","loginUrl","authUrl","screenX","screenLeft","screenY","screenTop","outerWidth","clientWidth","outerHeight","clientHeight","floor","popup","open","focus","startLoginScreen","saveAuthorizationData","confirm","deleteAuthorizationData","getErrorMessage","authData","prYvkey","prYvpoll","retrievePollUrl","super","captureStackTrace","Auth","Browser","version","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","globalThis","Function","__webpack_exports__"],"ignoreList":[],"sourceRoot":""}