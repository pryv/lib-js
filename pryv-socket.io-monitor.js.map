{"version":3,"file":"pryv-socket.io-monitor.js","mappings":"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","sources":["webpack://lib-js/./components/pryv/src/index.js","webpack://lib-js/./components/pryv/src/Browser/LoginButton.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/polling.js","webpack://lib-js/./components/pryv-socket.io/src/SocketIO.js","webpack://lib-js/./components/pryv-monitor/src/lib/updateEvents.js","webpack://lib-js/./node_modules/debug/src/common.js","webpack://lib-js/./components/pryv/src/utils.js","webpack://lib-js/./components/pryv/src/Auth/AuthStates.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/contrib/parseuri.js","webpack://lib-js/./components/pryv-monitor/src/Monitor.js","webpack://lib-js/./components/pryv/src/Auth/LoginMessages.js","webpack://lib-js/./components/pryv-monitor/src/index.js","webpack://lib-js/./node_modules/engine.io-parser/build/cjs/commons.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/polling-xhr.js","webpack://lib-js/./components/pryv-monitor/src/UpdateMethod/Socket.js","webpack://lib-js/./node_modules/engine.io-parser/build/cjs/decodePacket.browser.js","webpack://lib-js/./node_modules/engine.io-parser/build/cjs/encodePacket.browser.js","webpack://lib-js/./node_modules/engine.io-parser/build/cjs/contrib/base64-arraybuffer.js","webpack://lib-js/./components/pryv/src/lib/PryvError.js","webpack://lib-js/./components/pryv/src/Connection.js","webpack://lib-js/./components/pryv/src/lib/json-parser.js","webpack://lib-js/./components/pryv/src/ServiceAssets.js","webpack://lib-js/./components/pryv/src/Auth/AuthController.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/manager.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/contrib/has-cors.js","webpack://lib-js/./components/pryv/src/Browser/index.js","webpack://lib-js/./components/pryv-monitor/src/lib/Changes.js","webpack://lib-js/./components/pryv-monitor/src/UpdateMethod/EventsTimer.js","webpack://lib-js/./node_modules/@socket.io/component-emitter/lib/esm/index.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/webtransport.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/globals.js","webpack://lib-js/./node_modules/socket.io-parser/build/cjs/index.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transport.js","webpack://lib-js/./node_modules/socket.io-parser/build/cjs/binary.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/index.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/util.js","webpack://lib-js/./components/pryv/src/Browser/CookieUtils.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/on.js","webpack://lib-js/./components/pryv-monitor/src/UpdateMethod/index.js","webpack://lib-js/./components/pryv-monitor/src/lib/updateStreams.js","webpack://lib-js/./components/pryv-socket.io/src/index.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/socket.js","webpack://lib-js/./node_modules/engine.io-parser/build/cjs/index.js","webpack://lib-js/./node_modules/ms/index.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/url.js","webpack://lib-js/./node_modules/events/events.js","webpack://lib-js/./components/pryv/src/lib/getEventStreamed.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/contrib/backo2.js","webpack://lib-js/./node_modules/debug/src/browser.js","webpack://lib-js/./components/pryv/src/browser-index.js","webpack://lib-js/./node_modules/socket.io-client/build/cjs/index.js","webpack://lib-js/./components/pryv/src/Auth/index.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/polling-fetch.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/socket.js","webpack://lib-js/./components/pryv-monitor/src/UpdateMethod/UpdateMethod.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/contrib/parseqs.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/websocket.js","webpack://lib-js/./components/pryv/src/Service.js","webpack://lib-js/./components/pryv/src/browser-index-bundle.js","webpack://lib-js/./node_modules/socket.io-parser/build/cjs/is-binary.js","webpack://lib-js/./node_modules/engine.io-client/build/cjs/transports/index.js","webpack://lib-js/webpack/bootstrap","webpack://lib-js/webpack/runtime/define property getters","webpack://lib-js/webpack/runtime/global","webpack://lib-js/webpack/runtime/hasOwnProperty shorthand","webpack://lib-js/webpack/runtime/make namespace object","webpack://lib-js/webpack/startup"],"sourcesContent":["/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * `pryv` library\n * @exports pryv\n * @property {pryv.Service} Service - To interact with Pryv.io at a \"Platform level\"\n * @property {pryv.Connection} Connection - To interact with an individual's (user) data set\n * @property {pryv.Browser} Browser - Browser Tools - Access request helpers and visuals (button)\n * @property {pryv.utils} utils - Exposes some utils for HTTP calls and tools to manipulate Pryv's API endpoints\n * @property {pryv.PryvError} PryvError - Custom error class with innerObject support\n */\nmodule.exports = {\n  Service: require('./Service'),\n  Connection: require('./Connection'),\n  Auth: require('./Auth'),\n  Browser: require('./Browser'),\n  utils: require('./utils'),\n  PryvError: require('./lib/PryvError'),\n  version: require('../package.json').version\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Cookies = require('./CookieUtils');\nconst AuthStates = require('../Auth/AuthStates');\nconst AuthController = require('../Auth/AuthController');\nconst Messages = require('../Auth/LoginMessages');\nconst utils = require('../utils');\n\n/* global location, confirm */\n\n/**\n * @memberof pryv.Browser\n */\nclass LoginButton {\n  constructor (authSettings, service) {\n    this.authSettings = authSettings;\n    this.service = service;\n    this.serviceInfo = service.infoSync();\n  }\n\n  /**\n   * setup button and load assets\n   */\n  async init () {\n    // initialize button visuals\n    setupButton(this);\n    this.languageCode = this.authSettings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      await loadAssets(this);\n    }\n    // set cookie key for authorization data\n    this._cookieKey = 'pryv-libjs-' + this.authSettings.authRequest.requestingAppId;\n\n    // initialize controller\n    this.auth = new AuthController(this.authSettings, this.service, this);\n    await this.auth.init();\n\n    return this.service;\n  }\n\n  onClick () {\n    this.auth.handleClick();\n  }\n\n  async onStateChange (state) {\n    switch (state.status) {\n      case AuthStates.LOADING:\n        this.text = getLoadingMessage(this);\n        break;\n      case AuthStates.INITIALIZED:\n        this.text = getInitializedMessage(this, this.serviceInfo.name);\n        break;\n      case AuthStates.NEED_SIGNIN: {\n        const loginUrl = state.authUrl || state.url; // url is deprecated\n        if (this.authSettings.authRequest.returnURL) { // open on same page (no Popup)\n          location.href = loginUrl;\n          return;\n        } else {\n          startLoginScreen(this, loginUrl);\n        }\n        break;\n      }\n      case AuthStates.AUTHORIZED:\n        this.text = state.username;\n        this.saveAuthorizationData({\n          apiEndpoint: state.apiEndpoint,\n          username: state.username\n        });\n        break;\n      case AuthStates.SIGNOUT: {\n        const message = this.messages.SIGNOUT_CONFIRM ? this.messages.SIGNOUT_CONFIRM : 'Logout ?';\n        if (confirm(message)) {\n          this.deleteAuthorizationData();\n          this.auth.init();\n        }\n        break;\n      }\n      case AuthStates.ERROR:\n        this.text = getErrorMessage(this, state.message);\n        break;\n      default:\n        console.log('WARNING Unhandled state for Login: ' + state.status);\n    }\n    // @ts-ignore - loginButtonText is set by setupButton\n    if (this.loginButtonText) {\n      // @ts-ignore\n      this.loginButtonText.innerHTML = this.text;\n    }\n  }\n\n  getAuthorizationData () {\n    return Cookies.get(this._cookieKey);\n  }\n\n  saveAuthorizationData (authData) {\n    Cookies.set(this._cookieKey, authData);\n  }\n\n  async deleteAuthorizationData () {\n    Cookies.del(this._cookieKey);\n  }\n\n  /**\n   * not mandatory to implement as non-browsers don't have this behaviour\n   * @param {*} authController\n   */\n  async finishAuthProcessAfterRedirection (authController) {\n    // this step should be applied only for the browser\n    if (!utils.isBrowser()) return;\n\n    // 3. Check if there is a prYvkey as result of \"out of page login\"\n    const url = window.location.href;\n    const pollUrl = retrievePollUrl(url);\n    if (pollUrl !== null) {\n      try {\n        const { body } = await utils.fetchGet(pollUrl);\n        authController.state = body;\n      } catch (e) {\n        authController.state = {\n          status: AuthStates.ERROR,\n          message: 'Cannot fetch result',\n          error: e\n        };\n      }\n    }\n\n    function retrievePollUrl (url) {\n      const params = utils.getQueryParamsFromURL(url);\n      let pollUrl = null;\n      if (params.prYvkey) { // deprecated method - To be removed\n        pollUrl = authController.serviceInfo.access + params.prYvkey;\n      }\n      if (params.prYvpoll) {\n        pollUrl = params.prYvpoll;\n      }\n      return pollUrl;\n    }\n  }\n}\n\nmodule.exports = LoginButton;\n\nasync function startLoginScreen (loginButton, authUrl) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n  const width = 400;\n  const height = 620;\n  const left = Math.floor(screenX + ((outerWidth - width) / 2));\n  const top = Math.floor(screenY + ((outerHeight - height) / 2.5));\n  const features = (\n    'width=' + width +\n    ',height=' + height +\n    ',left=' + left +\n    ',top=' + top +\n    ',scrollbars=yes'\n  );\n  loginButton.popup = window.open(authUrl, 'prYv Sign-in', features);\n\n  if (!loginButton.popup) {\n    // loginButton.auth.stopAuthRequest('FAILED_TO_OPEN_WINDOW');\n    console.log('Pop-up blocked. A second click should allow it.');\n  } else if (window.focus) {\n    loginButton.popup.focus();\n  }\n}\n\nfunction setupButton (loginBtn) {\n  loginBtn.loginButtonSpan = document.getElementById(loginBtn.authSettings.spanButtonID);\n\n  if (!loginBtn.loginButtonSpan) {\n    console.log('WARNING: pryv.Browser initialized with no spanButtonID');\n  } else {\n    // up to the time the button is loaded use the Span to display eventual\n    // error messages\n    loginBtn.loginButtonText = loginBtn.loginButtonSpan;\n\n    // bind actions dynamically to the button click\n    loginBtn.loginButtonSpan.addEventListener('click', loginBtn.onClick.bind(loginBtn));\n  }\n}\n\n/**\n * Loads the style from the service info\n */\nasync function loadAssets (loginBtn) {\n  const assets = await loginBtn.service.assets();\n  loginBtn.loginButtonSpan.innerHTML = await assets.loginButtonGetHTML();\n  loginBtn.loginButtonText = document.getElementById('pryv-access-btn-text');\n}\n\nfunction getErrorMessage (loginButton, message) {\n  return loginButton.messages.ERROR + ': ' + message;\n}\n\nfunction getLoadingMessage (loginButton) {\n  return loginButton.messages.LOADING;\n}\n\nfunction getInitializedMessage (loginButton, serviceName) {\n  return loginButton.messages.LOGIN + ': ' + serviceName;\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Polling = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst util_js_1 = require(\"../util.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\nclass Polling extends transport_js_1.Transport {\n    constructor() {\n        super(...arguments);\n        this._polling = false;\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this._poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            debug(\"paused\");\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this._polling || !this.writable) {\n            let total = 0;\n            if (this._polling) {\n                debug(\"we are currently polling - waiting to pause\");\n                total++;\n                this.once(\"pollComplete\", function () {\n                    debug(\"pre-pause polling complete\");\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                debug(\"we are currently writing - waiting to pause\");\n                total++;\n                this.once(\"drain\", function () {\n                    debug(\"pre-pause writing complete\");\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    _poll() {\n        debug(\"polling\");\n        this._polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        debug(\"polling got data %s\", data);\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        (0, engine_io_parser_1.decodePayload)(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this._polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this._poll();\n            }\n            else {\n                debug('ignoring poll - transport state \"%s\"', this.readyState);\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            debug(\"writing close packet\");\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            debug(\"transport open - closing\");\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            debug(\"transport not open - deferring close\");\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        (0, engine_io_parser_1.encodePayload)(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = (0, util_js_1.randomString)();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nexports.Polling = Polling;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst io = require('socket.io-client');\nconst { EventEmitter } = require('events');\n\nconst EVENTS = ['eventsChanged', 'streamsChanged', 'accessesChanged', 'disconnect', 'error'];\n\n/**\n * Socket.IO transport for a Connection.\n * Use connection.socket to access the instance associated with a Connection.\n * @memberof pryv\n * @extends EventEmitter\n */\nclass SocketIO extends EventEmitter {\n  /**\n   * @param {Connection} connection - The connection to bind to\n   */\n  constructor (connection) {\n    super();\n    /** @type {Connection} */\n    this.connection = connection;\n    /** @type {boolean} */\n    this.connecting = false;\n    this._io = null;\n  }\n\n  /**\n   * Open the Socket.IO stream\n   * @throws {Error} On connection failures\n   * @returns {Promise<SocketIO>} Promise resolving to this SocketIO instance\n   */\n  async open () {\n    return new Promise((resolve, reject) => {\n      if (this._io) return resolve(this);\n      if (this.connecting) return reject(new Error('open() process in course'));\n      this.connecting = true;\n\n      this.connection.username()\n        .then(username => {\n          const socketEndpoint = this.connection.endpoint + username + '?auth=' + this.connection.token;\n          // @ts-ignore - io is callable in socket.io-client\n          this._io = io(socketEndpoint, { forceNew: true });\n\n          // handle failure\n          for (const errcode of ['connect_error', 'connection_failed', 'error', 'connection_timeout']) {\n            const myCode = errcode;\n            this._io.on(errcode, (e) => {\n              if (!this.connecting) return; // do not care about errors if connected\n\n              this._io = null;\n              this.connecting = false;\n              if (e === null) { e = myCode; }\n              if (!(e instanceof Error)) { e = new Error(e); }\n\n              try { this._io.close(); } catch (ex) { }\n              return reject(e);\n            });\n          }\n\n          // handle success\n          this._io.on('connect', () => {\n            this.connecting = false;\n            registerListeners(this);\n            resolve(this);\n          });\n        })\n        .catch(e => {\n          this._io = null;\n          this.connecting = false;\n          return reject(e);\n        });\n    });\n  }\n\n  /**\n   * Close the socket\n   */\n  close () {\n    checkOpen(this);\n    this._io.close();\n  }\n\n  /**\n   * Add listener for Socket.IO events\n   * @param {('eventsChanged'|'streamsChanged'|'accessesChanged'|'disconnect'|'error')} eventName - The event to listen for\n   * @param {Function} listener - The callback function\n   * @returns {SocketIO} this\n   */\n  // @ts-ignore - overriding EventEmitter.on with restricted signature\n  on (eventName, listener) {\n    checkOpen(this);\n    if (EVENTS.indexOf(eventName) < 0) {\n      throw new Error('Unkown event [' + eventName + ']. Allowed events are: ' + EVENTS);\n    }\n    // @ts-ignore\n    return super.on(eventName, listener);\n  }\n\n  /**\n   * Identical to Connection.api() but using Socket.IO transport\n   * @param {Array<MethodCall>} arrayOfAPICalls - Array of Method Calls\n   * @param {Function} [progress] - Return percentage of progress (0 - 100)\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    checkOpen(this);\n    function httpHandler (batchCall) {\n      return new Promise((resolve, reject) => {\n        this._io.emit('callBatch', batchCall, function (err, res) {\n          if (err) return reject(err);\n          resolve(res);\n        });\n      });\n    }\n    return await this.connection._chunkedBatchCall(arrayOfAPICalls, progress, httpHandler.bind(this));\n  }\n}\n\n// private method to fence the usage of socket before being open\nfunction checkOpen (socket) {\n  if (!socket._io) throw new Error('Initialize socket.io with connection.socket.open() before');\n}\n\n// private method to register to all events for an open socket\n// and relay it.\nfunction registerListeners (socket) {\n  for (const event of EVENTS) {\n    socket._io.on(event, (...args) => {\n      socket.emit(event, ...args);\n    });\n  }\n}\n\nmodule.exports = function (Connection) {\n  Object.defineProperty(Connection.prototype, 'socket', {\n    get: function () {\n      if (this._socket) return this._socket;\n      this._socket = new SocketIO(this);\n      return this._socket;\n    }\n  });\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('./Changes');\n\nmodule.exports = async function _updateEvents (monitor) {\n  function forEachEvent (event) {\n    // update eventsGetScope with \"latest modified\" information found\n    if (event.modified > monitor.eventsGetScope.modifiedSince) {\n      monitor.eventsGetScope.modifiedSince = event.modified;\n    }\n    if (event.deleted) {\n      // event.delete is actually the date it was deleted.\n      // use it as \"modified\" information\n      if (event.deleted > monitor.eventsGetScope.modifiedSince) {\n        monitor.eventsGetScope.modifiedSince = event.deleted;\n      }\n      monitor.emit(Changes.EVENT_DELETE, event);\n    } else {\n      monitor.emit(Changes.EVENT, event);\n    }\n  }\n  try {\n    await monitor.connection.getEventsStreamed(monitor.eventsGetScope, forEachEvent);\n  } catch (e) {\n    monitor.emit(Changes.ERROR, e);\n  }\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '')\n\t\t\t.trim()\n\t\t\t.replace(/\\s+/g, ',')\n\t\t\t.split(',')\n\t\t\t.filter(Boolean);\n\n\t\tfor (const ns of split) {\n\t\t\tif (ns[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(ns.slice(1));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(ns);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the given string matches a namespace template, honoring\n\t * asterisks as wildcards.\n\t *\n\t * @param {String} search\n\t * @param {String} template\n\t * @return {Boolean}\n\t */\n\tfunction matchesTemplate(search, template) {\n\t\tlet searchIndex = 0;\n\t\tlet templateIndex = 0;\n\t\tlet starIndex = -1;\n\t\tlet matchIndex = 0;\n\n\t\twhile (searchIndex < search.length) {\n\t\t\tif (templateIndex < template.length && (template[templateIndex] === search[searchIndex] || template[templateIndex] === '*')) {\n\t\t\t\t// Match character or proceed with wildcard\n\t\t\t\tif (template[templateIndex] === '*') {\n\t\t\t\t\tstarIndex = templateIndex;\n\t\t\t\t\tmatchIndex = searchIndex;\n\t\t\t\t\ttemplateIndex++; // Skip the '*'\n\t\t\t\t} else {\n\t\t\t\t\tsearchIndex++;\n\t\t\t\t\ttemplateIndex++;\n\t\t\t\t}\n\t\t\t} else if (starIndex !== -1) { // eslint-disable-line no-negated-condition\n\t\t\t\t// Backtrack to the last '*' and try to match more characters\n\t\t\t\ttemplateIndex = starIndex + 1;\n\t\t\t\tmatchIndex++;\n\t\t\t\tsearchIndex = matchIndex;\n\t\t\t} else {\n\t\t\t\treturn false; // No match\n\t\t\t}\n\t\t}\n\n\t\t// Handle trailing '*' in template\n\t\twhile (templateIndex < template.length && template[templateIndex] === '*') {\n\t\t\ttemplateIndex++;\n\t\t}\n\n\t\treturn templateIndex === template.length;\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names,\n\t\t\t...createDebug.skips.map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tfor (const skip of createDebug.skips) {\n\t\t\tif (matchesTemplate(name, skip)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const ns of createDebug.names) {\n\t\t\tif (matchesTemplate(name, ns)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst regexAPIandToken = /(.+):\\/\\/(.+)@(.+)/gm;\nconst regexSchemaAndPath = /(.+):\\/\\/(.+)/gm;\n\n/**\n * Utilities to access Pryv API.\n * @memberof pryv\n * @namespace pryv.utils\n */\nconst utils = module.exports = {\n  /**\n   * Perform a GET request and parse JSON response\n   * @param {string} url - URL to fetch\n   * @param {Object} [queryParams={}] - Query parameters to append\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchGet (url, queryParams = {}, headers = {}) {\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + new URLSearchParams(queryParams).toString();\n    }\n    const myHeaders = Object.assign({ Accept: 'application/json' }, headers);\n    const response = await fetch(url + queryStr, { headers: myHeaders });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Perform a GET request and return text response\n   * @param {string} url - URL to fetch\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, text: string}>} Promise resolving to response and text body\n   */\n  async fetchGetText (url, headers = {}) {\n    const myHeaders = Object.assign({ Accept: 'text/html' }, headers);\n    const response = await fetch(url, { headers: myHeaders });\n    const text = await response.text();\n    return { response, text };\n  },\n\n  /**\n   * Perform a POST request with JSON data\n   * @param {string} url - URL to post to\n   * @param {Object} [data] - Data to send as JSON\n   * @param {Object} [headers={}] - Additional headers\n   * @returns {Promise<{response: Response, body: Object}>} Promise resolving to response and parsed body\n   */\n  async fetchPost (url, data, headers = {}) {\n    const myHeaders = Object.assign({\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    }, headers);\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: myHeaders,\n      body: JSON.stringify(data)\n    });\n    const body = await response.json();\n    return { response, body };\n  },\n\n  /**\n   * Returns true is run in a browser\n   * @memberof pryv.utils\n   * @returns {boolean}\n   */\n  isBrowser: function () {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n  },\n\n  /**\n   * From a APIEndpoint URL, return an object (TokenAndAPI) with two properties\n   * @memberof pryv.utils\n   * @param {APIEndpoint} apiEndpoint\n   * @returns {TokenAndEndpoint}\n   */\n  extractTokenAndAPIEndpoint: function (apiEndpoint) {\n    regexAPIandToken.lastIndex = 0;\n    const res = regexAPIandToken.exec(apiEndpoint);\n\n    if (res !== null) { // has token\n      // add a trailing '/' to end point if missing\n      if (!res[3].endsWith('/')) {\n        res[3] += '/';\n      }\n      return { endpoint: res[1] + '://' + res[3], token: res[2] };\n    }\n    // else check if valid url\n    regexSchemaAndPath.lastIndex = 0;\n    const res2 = regexSchemaAndPath.exec(apiEndpoint);\n    if (res2 === null) {\n      throw new Error('Cannot find endpoint, invalid URL format');\n    }\n    // add a trailing '/' to end point if missing\n    if (!res2[2].endsWith('/')) {\n      res2[2] += '/';\n    }\n\n    return { endpoint: res2[1] + '://' + res2[2], token: null };\n  },\n\n  /**\n   * Get a APIEndpoint URL from a TokenAndAPI object\n   * @memberof pryv.utils\n   * @param {TokenAndEndpoint} tokenAndAPI\n   * @returns {APIEndpoint}\n   */\n  buildAPIEndpoint: function (tokenAndAPI) {\n    if (!tokenAndAPI.token) {\n      let res = tokenAndAPI.endpoint + '';\n      if (!tokenAndAPI.endpoint.endsWith('/')) {\n        res += '/';\n      }\n      return res;\n    }\n    regexSchemaAndPath.lastIndex = 0;\n    const res = regexSchemaAndPath.exec(tokenAndAPI.endpoint);\n    // add a trailing '/' to end point if missing\n    if (!res[2].endsWith('/')) {\n      res[2] += '/';\n    }\n    return res[1] + '://' + tokenAndAPI.token + '@' + res[2];\n  },\n\n  /**\n   * Check if the browser is running on a mobile device or tablet\n   * @memberof pryv.utils\n   * @param {string|Navigator} [navigator] - Navigator object or user agent string (for testing)\n   * @returns {boolean} True if mobile or tablet\n   */\n  browserIsMobileOrTablet: function (navigator) {\n    if (navigator == null) {\n      return false;\n    }\n    let check = false;\n    // @ts-ignore - navigator is Navigator when not null\n    // eslint-disable-next-line no-useless-escape\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || navigator.opera);\n    return check;\n  },\n\n  /**\n   * Remove Pryv-specific query parameters from URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to clean\n   * @returns {string} URL without prYv* parameters\n   */\n  cleanURLFromPrYvParams: function (url) {\n    const PRYV_REGEXP = /[?#&]+prYv([^=&]+)=([^&]*)/g;\n    return url.replace(PRYV_REGEXP, '');\n  },\n\n  /**\n   * Extract query parameters from a URL\n   * @memberof pryv.utils\n   * @param {string} url - URL to parse\n   * @returns {Object.<string, string>} Object with key-value pairs of query parameters\n   */\n  getQueryParamsFromURL: function (url) {\n    /** @type {Object.<string, string>} */\n    const vars = {};\n    const QUERY_REGEXP = /[?#&]+([^=&]+)=([^&]*)/g;\n    url.replace(QUERY_REGEXP,\n      // @ts-ignore - replace callback is used for side effects\n      function (m, key, value) {\n        vars[key] = decodeURIComponent(value);\n      });\n    return vars;\n  }\n};\n\n// TODO: remove following deprecated aliases with next major version\n\n/**\n * @deprecated Renamed to `extractTokenAndAPIEndpoint()`\n */\nutils.extractTokenAndApiEndpoint = utils.extractTokenAndAPIEndpoint;\n\n/**\n * @deprecated Renamed to `buildAPIEndpoint()`\n */\n// TODO: remove deprecated alias with next major version\nutils.buildPryvApiEndpoint = utils.buildAPIEndpoint;\n\n// --------------- typedfs ------------------------------- //\n\n/**\n * An object with two properties: token & apiEndpoint\n * @typedef {Object} TokenAndEndpoint\n * @property {string} [token] Authorization token\n * @property {string} endpoint url of API endpoint\n */\n\n/**\n * A String url of the form http(s)://{token}@{apiEndpoint}\n * @typedef {string} APIEndpoint\n */\n\n/**\n * Common Meta are returned by each standard call on the API https://api.pryv.com/reference/#in-method-results\n * @typedef {Object} CommonMeta\n * @property {string} apiVersion The version of the API in the form {major}.{minor}.{revision}. Mirrored in HTTP header API-Version.\n * @property {number} serverTime The current server time as a timestamp in second. Keeping track of server time is necessary to properly handle time in API calls.\n * @property {string} serial The serial will change every time the core or register is updated. If you compare it with the serial of a previous response and notice a difference, you should reload the service information.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * The possible auth states:\n * ERROR, LOADING, INITIALIZED, NEED_SIGNIN, AUTHORIZED, SIGNOUT, REFUSED\n * @readonly\n * @enum {string}\n * @memberof pryv.Browser\n */\nmodule.exports = {\n  ERROR: 'ERROR',\n  LOADING: 'LOADING',\n  INITIALIZED: 'INITIALIZED',\n  NEED_SIGNIN: 'NEED_SIGNIN',\n  AUTHORIZED: 'ACCEPTED',\n  SIGNOUT: 'SIGNOUT',\n  REFUSED: 'REFUSED'\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parse = parse;\n// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nfunction parse(str) {\n    if (str.length > 8000) {\n        throw \"URI too long\";\n    }\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst EventEmitter = require('events');\nconst UpdateMethod = require('./UpdateMethod/');\nconst _updateEvents = require('./lib/updateEvents');\nconst _updateStreams = require('./lib/updateStreams');\nconst Changes = require('./lib/Changes');\n\n/**\n * Monitor changes on a Pryv.io account.\n * Emits events when data changes are detected.\n * @memberof pryv\n * @extends EventEmitter\n */\nclass Monitor extends EventEmitter {\n  /**\n   * Create a new Monitor\n   * @param {(string|Connection)} apiEndpointOrConnection - API endpoint URL or Connection instance\n   * @param {MonitorScope} [eventsGetScope={}] - The scope to monitor (events.get parameters)\n   */\n  constructor (apiEndpointOrConnection, eventsGetScope = {}) {\n    super();\n    // @ts-ignore - pryv is set at runtime by extendPryvMonitor\n    if (!Monitor.pryv) {\n      throw new Error('package \\'@pryv/monitor\\' must loaded after package \\'pryv\\'');\n    }\n\n    this.eventsGetScope = { // default eventsGetScope values\n      fromTime: -Number.MAX_VALUE,\n      toTime: Number.MAX_VALUE,\n      modifiedSince: -Number.MAX_VALUE\n    };\n    Object.assign(this.eventsGetScope, eventsGetScope);\n\n    // @ts-ignore - pryv is set at runtime\n    if (apiEndpointOrConnection instanceof Monitor.pryv.Connection) {\n      this.connection = apiEndpointOrConnection;\n    } else {\n      // @ts-ignore - pryv is set at runtime\n      this.connection = new Monitor.pryv.Connection(apiEndpointOrConnection);\n    }\n    this.states = {\n      started: false,\n      starting: false, // in phase of initializing\n      updatingEvents: false, // semaphore to prevent updating events in parallel\n      updatingStreams: false // semaphore to prevent updating streams in parallel\n    };\n  }\n\n  /**\n   * Start the monitor and perform initial sync\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async start () {\n    if (this.states.started || this.states.starting) return this;\n    this.states.starting = true;\n    await _updateStreams(this);\n    await _updateEvents(this);\n    // once initialized we for the eventsGetScope to request also deletions\n    this.eventsGetScope.includeDeletions = true;\n    this.eventsGetScope.state = 'all';\n\n    this.states.starting = false;\n    this.states.started = true;\n    this.ready();\n    return this;\n  }\n\n  /**\n   * Request an events update according to the current scope\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async updateEvents () {\n    if (!this.states.started) {\n      throw new Error('Start Monitor before calling update Events');\n    }\n    if (this.states.updatingEvents) { // semaphore\n      this.states.updateEventRequired = true;\n      return this;\n    }\n\n    this.states.updatingEvents = true;\n    try {\n      this.states.updateEventRequired = false;\n      await _updateEvents(this);\n    } catch (e) {\n      this.emit(Changes.ERROR, e);\n    }\n    this.states.updatingEvents = false;\n\n    if (this.states.updateEventRequired) { // if another event update is required\n      setTimeout(function () {\n        this.updateEvents();\n      }.bind(this), 1);\n    } else {\n      this.ready();\n    }\n    return this;\n  }\n\n  /**\n   * Request a streams update\n   * @returns {Promise<Monitor>} Promise resolving to this Monitor instance\n   */\n  async updateStreams () {\n    if (!this.states.started) {\n      throw new Error('Start Monitor before calling update Streams');\n    }\n    if (this.states.updatingStreams) { // semaphore\n      this.states.updateStreamsRequired = true;\n      return this;\n    }\n\n    this.states.updatingStreams = true;\n    try {\n      this.states.updateStreamsRequired = false;\n      await _updateStreams(this);\n    } catch (e) {\n      this.emit(Changes.ERROR, e);\n    }\n    this.states.updatingStreams = false;\n\n    if (this.states.updateStreamsRequired) { // if another streams update is required\n      setTimeout(function () {\n        this.updateStreams();\n      }.bind(this), 1);\n    } else {\n      this.ready();\n    }\n    return this;\n  }\n\n  /**\n   * @private\n   * Called after init phase and each updateEvents\n   * Advertise the update method or any listener that the Monitor is ready\n   * for a next event update\n   */\n  ready () {\n    if (!this.states.started) return; // it might be stoped\n    this.emit(Changes.READY);\n  }\n\n  /**\n   * Stop monitoring (no event will be fired anymore)\n   * @returns {Monitor} this\n   */\n  stop () {\n    if (!this.states.started) return this;\n    if (this.states.starting) throw new Error('Process is starting, wait for the end of initialization to stop it');\n    this.emit(Changes.STOP);\n    this.states.started = false;\n    return this;\n  }\n\n  /**\n   * Used by updateMethods to be sure they can call updateXXX methods\n   * @property {Boolean} started - true is monitor is started\n   */\n  get started () {\n    return this.states.started;\n  }\n\n  /**\n   * @private\n   * Called by UpdateMethod to share cross references\n   * Set a custom update method\n   * @param {Object} updateMethod - the auto-update method\n   * @returns {Monitor} this\n   */\n  addUpdateMethod (updateMethod) {\n    updateMethod.setMonitor(this);\n    return this;\n  }\n}\n\nMonitor.UpdateMethod = UpdateMethod;\nmodule.exports = Monitor;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nmodule.exports = get;\n\nconst Messages = {\n  LOADING: {\n    en: '...'\n  },\n  ERROR: {\n    en: 'Error',\n    fr: 'Erreur'\n  },\n  LOGIN: {\n    en: 'Signin',\n    fr: 'Login'\n  },\n  SIGNOUT_CONFIRM: {\n    en: 'Logout?',\n    fr: 'Se dconnecter ?'\n  }\n};\n\nfunction get (languageCode, definitions) {\n  const myMessages = definitions || Messages;\n  const res = {};\n  Object.keys(myMessages).forEach((key) => {\n    res[key] = myMessages[key][languageCode] || myMessages[key].en;\n  });\n  return res;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Monitor = require('./Monitor');\nconst Changes = require('./lib/Changes');\n\nMonitor.Changes = Changes;\n\n/**\n * Load Monitor capabilities onto `pryv`\n * @param {pryv} pryv `pryv` library @see https://github.com/pryv/lib-js\n */\nmodule.exports = function (pryv) {\n  console.log('Pryv version', pryv.version);\n  // check version here\n  if (pryv.Monitor) {\n    throw new Error('Monitor already loaded');\n  }\n  // sharing cross references\n  pryv.Monitor = Monitor;\n  // TODO: remove deprecated `Pryv` alias with next major version\n  Monitor.pryv = Monitor.Pryv = pryv;\n  return Monitor;\n};\n\n/**\n * @typedef pryv.Monitor.Changes\n * @property {string} EVENT \"event\" fired on new or changed event\n * @property {string} EVENT_DELETE \"eventDelete\"\n * @property {string} STREAMS \"streams\"\n * @property {string} ERROR \"error\"\n * @property {string} READY \"ready\"\n * @property {string} STOP \"stop\"\n */\n\n/**\n * A scope corresponding to EventGetParameters @see https://l.backloop.dev:4443/reference#get-events\n * Property `limit` cannot be specified;\n * @typedef {Object} pryv.Monitor.Scope\n * @property {timestamp} [fromTime=TIMERANGE_MIN] (in seconds)\n * @property {timestamp} [toTime=TIMERANGE_MAX] (in seconds)\n * @property {string[]} [streams] - array of streamIds\n * @property {string[]} [tags] - array of tags\n * @property {string[]} [types] - array of EventTypes\n * @property {boolean} [running]\n * @property {boolean} [sortAscending] - If true, events will be sorted from oldest to newest. ! with monitors, this will only determine the way monitor will receive events on each update. The order they will be notified to listener cannot be guranted.\n * @property {('default'|'trashed'|'all')} [state]\n * @property {boolean} [includeDeletions]\n * @property {timestamp} modifiedSince - (in seconds) only events modified after this date\n */\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ERROR_PACKET = exports.PACKET_TYPES_REVERSE = exports.PACKET_TYPES = void 0;\nconst PACKET_TYPES = Object.create(null); // no Map = no polyfill\nexports.PACKET_TYPES = PACKET_TYPES;\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nexports.PACKET_TYPES_REVERSE = PACKET_TYPES_REVERSE;\nObject.keys(PACKET_TYPES).forEach((key) => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexports.ERROR_PACKET = ERROR_PACKET;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.XHR = exports.Request = exports.BaseXHR = void 0;\nconst polling_js_1 = require(\"./polling.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst util_js_1 = require(\"../util.js\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst has_cors_js_1 = require(\"../contrib/has-cors.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\nfunction empty() { }\nclass BaseXHR extends polling_js_1.Polling {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        debug(\"xhr poll\");\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexports.BaseXHR = BaseXHR;\nclass Request extends component_emitter_1.Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(createRequest, uri, opts) {\n        super();\n        this.createRequest = createRequest;\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this._opts = opts;\n        this._method = opts.method || \"GET\";\n        this._uri = uri;\n        this._data = undefined !== opts.data ? opts.data : null;\n        this._create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    _create() {\n        var _a;\n        const opts = (0, util_js_1.pick)(this._opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this._opts.xd;\n        const xhr = (this._xhr = this.createRequest(opts));\n        try {\n            debug(\"xhr open %s: %s\", this._method, this._uri);\n            xhr.open(this._method, this._uri, true);\n            try {\n                if (this._opts.extraHeaders) {\n                    // @ts-ignore\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this._opts.extraHeaders) {\n                        if (this._opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this._method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this._opts.withCredentials;\n            }\n            if (this._opts.requestTimeout) {\n                xhr.timeout = this._opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(\n                    // @ts-ignore\n                    xhr.getResponseHeader(\"set-cookie\"));\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this._onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this._onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            debug(\"xhr data %s\", this._data);\n            xhr.send(this._data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this._onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this._index = Request.requestsCount++;\n            Request.requests[this._index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    _onError(err) {\n        this.emitReserved(\"error\", err, this._xhr);\n        this._cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    _cleanup(fromError) {\n        if (\"undefined\" === typeof this._xhr || null === this._xhr) {\n            return;\n        }\n        this._xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this._xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this._index];\n        }\n        this._xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    _onLoad() {\n        const data = this._xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this._cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this._cleanup();\n    }\n}\nexports.Request = Request;\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globals_node_js_1.globalThisShim ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\nconst hasXHR2 = (function () {\n    const xhr = newRequest({\n        xdomain: false,\n    });\n    return xhr && xhr.responseType !== null;\n})();\n/**\n * HTTP long-polling based on the built-in `XMLHttpRequest` object.\n *\n * Usage: browser\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n */\nclass XHR extends BaseXHR {\n    constructor(opts) {\n        super(opts);\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n    }\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd }, this.opts);\n        return new Request(newRequest, this.uri(), opts);\n    }\n}\nexports.XHR = XHR;\nfunction newRequest(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || has_cors_js_1.hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globals_node_js_1.globalThisShim[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst UpdateMethod = require('./UpdateMethod');\nconst Changes = require('../lib/Changes');\n\n/**\n * Update method that uses @pryv/socket.io events for real-time updates.\n * Requires @pryv/socket.io to be loaded.\n * @memberof pryv.Monitor\n * @extends UpdateMethod\n */\nclass Socket extends UpdateMethod {\n  async ready () {\n    if (this.socket) return;\n    // @ts-ignore - socket is added by @pryv/socket.io extension\n    if (!this.monitor.connection.socket) {\n      throw new Error('You should load package @pryv/socket.io to use monitor with websockets');\n    }\n    // @ts-ignore - socket is added by @pryv/socket.io extension\n    this.socket = await this.monitor.connection.socket.open();\n    this.socket.on('eventsChanged', () => { this.monitor.updateEvents(); });\n    this.socket.on('streamsChanged', () => { this.monitor.updateStreams(); });\n    this.socket.on('error', (error) => { this.monitor.emit(Changes.ERROR, error); });\n  }\n\n  async stop () {\n    if (!this.socket) return;\n    try { this.socket.close(); } catch (e) { }\n    this.socket = null;\n  }\n}\nmodule.exports = Socket;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodePacket = void 0;\nconst commons_js_1 = require(\"./commons.js\");\nconst base64_arraybuffer_js_1 = require(\"./contrib/base64-arraybuffer.js\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType),\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),\n        };\n    }\n    const packetType = commons_js_1.PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return commons_js_1.ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: commons_js_1.PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1),\n        }\n        : {\n            type: commons_js_1.PACKET_TYPES_REVERSE[type],\n        };\n};\nexports.decodePacket = decodePacket;\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = (0, base64_arraybuffer_js_1.decode)(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encodePacket = void 0;\nexports.encodePacketToBinary = encodePacketToBinary;\nconst commons_js_1 = require(\"./commons.js\");\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(commons_js_1.PACKET_TYPES[type] + (data || \"\"));\n};\nexports.encodePacket = encodePacket;\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nfunction encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data.arrayBuffer().then(toArray).then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, (encoded) => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decode = exports.encode = void 0;\n// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nconst encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexports.encode = encode;\nconst decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\nexports.decode = decode;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\n/**\n * Custom error class for Pryv library errors.\n * Includes an innerObject property for wrapping underlying errors.\n * @extends Error\n */\nclass PryvError extends Error {\n  /**\n   * Create a PryvError\n   * @param {string} message - Error message\n   * @param {Error|Object} [innerObject] - The underlying error or object that caused this error\n   */\n  constructor (message, innerObject) {\n    super(message);\n    this.name = 'PryvError';\n    /** @type {Error|Object|undefined} */\n    this.innerObject = innerObject;\n\n    // Maintains proper stack trace for where error was thrown (only in V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, PryvError);\n    }\n  }\n}\n\nmodule.exports = PryvError;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\nconst jsonParser = require('./lib/json-parser');\nconst libGetEventStreamed = require('./lib/getEventStreamed');\nconst PryvError = require('./lib/PryvError');\n\n/**\n * @class Connection\n * A connection is an authenticated link to a Pryv.io account.\n *\n * @type {TokenAndEndpoint}\n *\n * @example\n * create a connection for the user 'tom' on 'pryv.me' backend with the token 'TTZycvBTiq'\n * const conn = new pryv.Connection('https://TTZycvBTiq@tom.pryv.me');\n *\n * @property {string} [token]\n * @property {string} endpoint\n * @memberof pryv\n *\n * @constructor\n * @this {Connection}\n * @param {APIEndpoint} apiEndpoint\n * @param {pryv.Service} [service] - eventually initialize Connection with a Service\n */\nclass Connection {\n  constructor (apiEndpoint, service) {\n    const { token, endpoint } = utils.extractTokenAndAPIEndpoint(apiEndpoint);\n    this.token = token;\n    this.endpoint = endpoint;\n    this.options = {};\n    this.options.chunkSize = 1000;\n    this._deltaTime = { value: 0, weight: 0 };\n    if (service && !(service instanceof Service)) {\n      throw new Error('Invalid service param');\n    }\n    this._service = service;\n  }\n\n  /**\n   * get pryv.Service object relative to this connection\n   * @readonly\n   * @property {pryv.Service} service\n   */\n  get service () {\n    if (this._service) return this._service;\n    this._service = new Service(this.endpoint + 'service/info');\n    return this._service;\n  }\n\n  /**\n   * Get username for this connection.\n   * It's async as it's constructed from access info.\n   * @returns {Promise<string>} Promise resolving to the username\n   */\n  async username () {\n    const accessInfo = await this.accessInfo();\n    if (accessInfo.error) {\n      throw new PryvError(\n        'Failed fetching accessinfo: ' + accessInfo.error.message,\n        accessInfo.error\n      );\n    }\n    // @ts-ignore - username is always a string\n    return accessInfo.user.username;\n  }\n\n  /**\n   * Get access info for this connection.\n   * It's async as it is fetched from the API.\n   * @returns {Promise<AccessInfo>} Promise resolving to the access info\n   */\n  async accessInfo () {\n    return this.get('access-info', null);\n  }\n\n  /**\n   * Issue a Batch call https://api.pryv.com/reference/#call-batch .\n   * arrayOfAPICalls will be splited in multiple calls if the size is > `conn.options.chunkSize` .\n   * Default chunksize is 1000.\n   * @param {Array.<MethodCall>} arrayOfAPICalls Array of Method Calls\n   * @param {Function} [progress] Return percentage of progress (0 - 100);\n   * @returns {Promise<Array>} Promise to Array of results matching each method call in order\n   */\n  async api (arrayOfAPICalls, progress) {\n    function httpHandler (batchCall) {\n      return this.post('', batchCall);\n    }\n    return await this._chunkedBatchCall(\n      arrayOfAPICalls,\n      progress,\n      httpHandler.bind(this)\n    );\n  }\n\n  /**\n   * Make one API call\n   * @param {string} method - Method ID (e.g., 'events.get', 'streams.create')\n   * @param {Object|Array} [params={}] - The params associated with this method\n   * @param {string} [expectedKey] - If given, returns the value of this key or throws an error if not present\n   * @returns {Promise<Object>} Promise resolving to the API result or the value of expectedKey\n   * @throws {Error} If .error is present in the response or expectedKey is missing\n   */\n  async apiOne (method, params = {}, expectedKey) {\n    const result = await this.api([{ method, params }]);\n    if (\n      result[0] == null ||\n      result[0].error ||\n      (expectedKey != null && result[0][expectedKey] == null)\n    ) {\n      const innerObject = result[0]?.error || result;\n      throw new PryvError(\n        `Error for api method: \"${method}\" with params: ${JSON.stringify(\n          params\n        )} >> Result: ${JSON.stringify(innerObject)}\"`,\n        innerObject\n      );\n    }\n    if (expectedKey != null) return result[0][expectedKey];\n    return result[0];\n  }\n\n  /**\n   * Revoke : Delete the accessId\n   * - Do not throw error if access is already revoked, just return null;\n   * @param {boolean} [throwOnFail=true] - if set to false do not throw Error on failure\n   * @param {Connection} [usingConnection] - specify which connection issues the revoke, might be necessary when selfRevoke\n   * @returns {Promise<Object|null>} Promise resolving to deletion result or null if already revoked/failed\n   */\n  async revoke (throwOnFail = true, usingConnection) {\n    usingConnection = usingConnection || this;\n    let accessInfo = null;\n    // get accessId\n    try {\n      accessInfo = await this.accessInfo();\n    } catch (e) {\n      if (e.response?.body?.error?.id === 'invalid-access-token') {\n        return null; // Already revoked OK..\n      }\n      if (throwOnFail) throw e;\n      return null;\n    }\n    // delete access\n    try {\n      const result = usingConnection.apiOne('accesses.delete', {\n        id: accessInfo.id\n      });\n      return result;\n    } catch (e) {\n      if (throwOnFail) throw e;\n      return null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  async _chunkedBatchCall (arrayOfAPICalls, progress, callHandler) {\n    if (!Array.isArray(arrayOfAPICalls)) {\n      throw new Error('Connection.api() takes an array as input');\n    }\n\n    const res = [];\n    let percent = 0;\n    for (\n      let cursor = 0;\n      arrayOfAPICalls.length >= cursor;\n      cursor += this.options.chunkSize\n    ) {\n      const thisBatch = [];\n      const cursorMax = Math.min(\n        cursor + this.options.chunkSize,\n        arrayOfAPICalls.length\n      );\n      // copy only method and params into a back call to be exuted\n      for (let i = cursor; i < cursorMax; i++) {\n        thisBatch.push({\n          method: arrayOfAPICalls[i].method,\n          params: arrayOfAPICalls[i].params\n        });\n      }\n      const resRequest = await callHandler(thisBatch);\n      // result checks\n      if (!resRequest || !Array.isArray(resRequest.results)) {\n        throw new Error(\n          'API call result is not an Array: ' + JSON.stringify(resRequest)\n        );\n      }\n      if (resRequest.results.length !== thisBatch.length) {\n        throw new Error(\n          'API call result Array does not match request: ' +\n            JSON.stringify(resRequest)\n        );\n      }\n\n      // eventually call handleResult\n      for (let i = 0; i < resRequest.results.length; i++) {\n        if (arrayOfAPICalls[i + cursor].handleResult) {\n          await arrayOfAPICalls[i + cursor].handleResult.call(\n            null,\n            resRequest.results[i],\n            thisBatch[i] // request\n          );\n        }\n      }\n      Array.prototype.push.apply(res, resRequest.results);\n      percent = Math.round((100 * res.length) / arrayOfAPICalls.length);\n      if (progress) {\n        progress(percent, res);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Post to API and return results\n   * @param {string} path - API path\n   * @param {(Array | Object)} data - Data to post\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async post (path, data) {\n    const now = getTimestamp();\n    const res = await this._postFetch(path, data);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Post object as JSON to API\n   * @param {string} path - API path\n   * @param {Array | Object} data - Data to post as JSON\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetch (path, data) {\n    return this._postFetchRaw(path, JSON.stringify(data), 'application/json');\n  }\n\n  /**\n   * @private\n   * Raw Post to API\n   * @param {string} path - API path\n   * @param {any} data - Raw data to post\n   * @param {string} [contentType] - Content-Type header (optional, allows fetch to set it for FormData)\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _postFetchRaw (path, data, contentType) {\n    const headers = {\n      Authorization: this.token,\n      Accept: 'application/json'\n    };\n    // optional for form-data llowing fetch to\n    // automatically set multipart/form-data with the correct boundary\n    if (contentType) {\n      headers['Content-Type'] = contentType;\n    }\n    const response = await fetch(this.endpoint + path, {\n      method: 'POST',\n      headers,\n      body: data\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * GET from API and return results\n   * @param {string} path - API path\n   * @param {Object} [queryParams] - Query parameters\n   * @returns {Promise<Object|Object[]>} Promise to result.body\n   */\n  async get (path, queryParams) {\n    const now = getTimestamp();\n    const res = await this._getFetchRaw(path, queryParams);\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * @private\n   * Raw GET from API\n   * @param {string} path - API path\n   * @param {Object} [queryParams={}] - Query parameters\n   * @returns {Promise<{response: Response, body: Object|Object[]}>} Promise to response and body\n   */\n  async _getFetchRaw (path, queryParams = {}) {\n    path = path || '';\n    let queryStr = '';\n    if (queryParams && Object.keys(queryParams).length > 0) {\n      queryStr = '?' + new URLSearchParams(queryParams).toString();\n    }\n    const response = await fetch(this.endpoint + path + queryStr, {\n      headers: {\n        Authorization: this.token,\n        Accept: 'application/json'\n      }\n    });\n    const body = await response.json();\n    return { response, body };\n  }\n\n  /**\n   * Add data points to an HF (High Frequency) series event (flatJSON format)\n   * @param {string} eventId - The HF event ID\n   * @param {string[]} fields - Array of field names for the series\n   * @param {Array<Array<number|string>>} points - Array of data points, each point is an array of values\n   * @returns {Promise<HFSeriesAddResult>} Promise resolving to status response\n   * @see https://api.pryv.com/reference/#add-hf-series-data-points\n   */\n  async addPointsToHFEvent (eventId, fields, points) {\n    const res = await this.post('events/' + eventId + '/series', {\n      format: 'flatJSON',\n      fields,\n      points\n    });\n    if (res.status !== 'ok') {\n      throw new Error('Failed loading serie: ' + JSON.stringify(res.status));\n    }\n    return res;\n  }\n\n  /**\n   * Streamed get Event.\n   * @see https://api.pryv.com/reference/#get-events\n   * @param {Object} queryParams See `events.get` parameters\n   * @param {Function} forEachEvent Function taking one event as parameter. Will be called for each event\n   * @returns {Promise<Object>} Promise to result.body transformed with `eventsCount: {count}` replacing `events: [...]`\n   */\n  async getEventsStreamed (queryParams, forEachEvent) {\n    const myParser = jsonParser(forEachEvent, queryParams.includeDeletions);\n    const res = await libGetEventStreamed(this, queryParams, myParser);\n    const now = getTimestamp();\n    this._handleMeta(res.body, now);\n    return res.body;\n  }\n\n  /**\n   * Create an event with attached file\n   * NODE.jS ONLY\n   * @param {Event} event\n   * @param {string} filePath\n   */\n  async createEventWithFile (event, filePath) {\n    const fs = require('fs');\n    const path = require('path');\n\n    if (!fs || !path) {\n      throw new Error('createEventWithFile is only available in Node.js. Use createEventWithFormData in browser.');\n    }\n\n    const fileName = path.basename(filePath);\n    const mimeType = getMimeType(path.extname(filePath));\n    const fileBlob = await fs.openAsBlob(filePath, { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('event', JSON.stringify(event));\n    formData.append('file', fileBlob, fileName);\n\n    const now = getTimestamp();\n    const { body } = await this._postFetchRaw('events', formData);\n    this._handleMeta(body, now);\n    return body;\n  }\n\n  /**\n   * Create an event from a Buffer\n   * @param {Object} event\n   * @param {Buffer|Blob} bufferData - Buffer for node, Blob for browser\n   * @param {string} filename\n   */\n  async createEventWithFileFromBuffer (event, bufferData, filename) {\n    const mimeType = getMimeType(getExtname(filename));\n    const fileBlob = bufferData instanceof Blob\n      ? bufferData\n      // @ts-ignore - Buffer is valid for Blob in Node.js\n      : new Blob([bufferData], { type: mimeType });\n\n    const formData = new FormData();\n    formData.append('file', fileBlob, filename);\n    const body = await this.createEventWithFormData(event, formData);\n    return body;\n  }\n\n  /**\n   * Create an event with attached formData\n   * !! BROWSER ONLY\n   * @param {Event} event\n   * @param {FormData} formData https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\n   */\n  async createEventWithFormData (event, formData) {\n    formData.append('event', JSON.stringify(event));\n    const { body } = await this._postFetchRaw('events', formData);\n    return body;\n  }\n\n  /**\n   * Difference in seconds between the Pryv.io API and local time\n   * deltaTime is refined at each (non-raw) API call\n   * @readonly\n   * @property {number} deltaTime\n   */\n  get deltaTime () {\n    return this._deltaTime.value;\n  }\n\n  /**\n   * API endpoint of this connection (includes token if present)\n   * @readonly\n   * @property {APIEndpoint} apiEndpoint\n   */\n  get apiEndpoint () {\n    return utils.buildAPIEndpoint(this);\n  }\n\n  // private method that handle meta data parsing\n  _handleMeta (res, requestLocalTimestamp) {\n    if (!res.meta) throw new Error('Cannot find .meta in response.');\n    if (!res.meta.serverTime) { throw new Error('Cannot find .meta.serverTime in response.'); }\n\n    // update deltaTime and weight it\n    this._deltaTime.value =\n      (this._deltaTime.value * this._deltaTime.weight +\n        res.meta.serverTime -\n        requestLocalTimestamp) /\n      ++this._deltaTime.weight;\n  }\n}\n\nmodule.exports = Connection;\n\nfunction getTimestamp () {\n  return Date.now() / 1000;\n}\n\nconst MIME_TYPES = {\n  '.png': 'image/png',\n  '.jpg': 'image/jpeg',\n  '.jpeg': 'image/jpeg',\n  '.gif': 'image/gif',\n  '.webp': 'image/webp',\n  '.svg': 'image/svg+xml',\n  '.bmp': 'image/bmp',\n  '.ico': 'image/x-icon',\n  '.pdf': 'application/pdf',\n  '.json': 'application/json',\n  '.xml': 'application/xml',\n  '.zip': 'application/zip',\n  '.gz': 'application/gzip',\n  '.tar': 'application/x-tar',\n  '.txt': 'text/plain',\n  '.html': 'text/html',\n  '.htm': 'text/html',\n  '.css': 'text/css',\n  '.js': 'application/javascript',\n  '.mjs': 'application/javascript',\n  '.mp3': 'audio/mpeg',\n  '.wav': 'audio/wav',\n  '.ogg': 'audio/ogg',\n  '.mp4': 'video/mp4',\n  '.webm': 'video/webm',\n  '.avi': 'video/x-msvideo',\n  '.mov': 'video/quicktime'\n};\n\nfunction getMimeType (ext) {\n  return MIME_TYPES[ext.toLowerCase()] || 'application/octet-stream';\n}\n\nfunction getExtname (filename) {\n  const lastDot = filename.lastIndexOf('.');\n  return lastDot >= 0 ? filename.slice(lastDot) : '';\n}\n\n// service is require \"after\" to allow circular require\nconst Service = require('./Service');\n\n/**\n * API Method call, for batch call https://api.pryv.com/reference/#call-batch\n * @typedef {Object} MethodCall\n * @property {string} method - The method id\n * @property {(Object|Array)}  params - The call parameters as required by the method.\n * @property {(Function|Promise)} [handleResult] - Will be called with the result corresponding to this specific call.\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// there two steps 1 find events, then eventDeletions\nconst EVENTMARKERS = ['\"events\":[', '\"eventDeletions\":['];\n\n/**\n * Stremed JSON parser for events\n */\nmodule.exports = function (foreachEvent, includeDeletions) {\n  let eventOrEventDeletions = 0; // start with event\n  let buffer = ''; // temp data\n  let body = null; // to be returned\n\n  // IN EVENTS VARS\n  let depth = 0; // level of depth in brackets\n  let inString = false; // cursor is in a String\n  let skipNextOne = false; // when a backslash is found\n  let cursorPos = 0; // position of Character Cursor\n\n  // counters\n  let eventsCount = 0;\n  let eventDeletionsCount = 0;\n\n  const states = {\n    A_BEFORE_EVENTS: 0,\n    B_IN_EVENTS: 1,\n    D_AFTER_EVENTS: 2\n  };\n\n  let state = states.A_BEFORE_EVENTS;\n\n  function processBuffer () {\n    switch (state) {\n      case states.A_BEFORE_EVENTS:\n        searchStartEvents();\n        break;\n      case states.B_IN_EVENTS:\n        processEvents();\n        break;\n      default:\n        afterEvents();\n        break;\n    }\n  }\n\n  function searchStartEvents () {\n    // search for \"events\": and happend any info before to the body\n    const n = buffer.indexOf(EVENTMARKERS[eventOrEventDeletions]);\n    if (n > 0) {\n      if (eventOrEventDeletions === 0) { // do only once\n        body = buffer.substring(0, n);\n      }\n      buffer = buffer.substr(n + EVENTMARKERS[eventOrEventDeletions].length);\n      state = states.B_IN_EVENTS;\n      processEvents();\n    }\n  }\n\n  function processEvents () {\n    /// ---- in Event\n    while (cursorPos < buffer.length && (state === states.B_IN_EVENTS)) {\n      if (skipNextOne) { // ignore next character\n        skipNextOne = false;\n        cursorPos++;\n        continue;\n      }\n      switch (buffer.charCodeAt(cursorPos)) {\n        case 93: // ]\n          if (depth === 0) { // end of events\n            if (cursorPos !== 0) {\n              throw new Error('Found trailling ] in mid-course');\n            }\n            if (eventOrEventDeletions === 0 && includeDeletions) {\n              state = states.A_BEFORE_EVENTS;\n              eventOrEventDeletions = 1; // now look for eventDeletions\n              return;\n            } else { // done\n              state = states.D_AFTER_EVENTS;\n              let eventsOrDeletionMsg = '';\n              if (eventOrEventDeletions === 1) {\n                eventsOrDeletionMsg = '\"eventDeletionsCount\":' + eventDeletionsCount + ',';\n              }\n              buffer = eventsOrDeletionMsg + '\"eventsCount\":' + eventsCount + '' + buffer.substr(1);\n            }\n          }\n          break;\n        case 92: // \\\n          skipNextOne = true;\n          break;\n        case 123: // {\n          if (!inString) depth++;\n          break;\n        case 34: // \"\n          inString = !inString;\n          break;\n        case 125: // }\n          if (!inString) depth--;\n          if (depth === 0) {\n            // ignore possible coma ',' if first char\n            const ignoreComa = (buffer.charCodeAt(0) === 44) ? 1 : 0;\n            const eventStr = buffer.substring(ignoreComa, cursorPos + 1);\n\n            if (eventOrEventDeletions === 0) {\n              eventsCount++;\n            } else {\n              eventDeletionsCount++;\n            }\n            buffer = buffer.substr(cursorPos + 1);\n            addEvent(eventStr);\n            cursorPos = -1;\n          }\n          break;\n      }\n      cursorPos++;\n    }\n  }\n\n  function afterEvents () {\n    // just happend the end of message;\n    body += buffer;\n    buffer = '';\n  }\n\n  return function (res, fn) {\n    res.setEncoding('utf8'); // Already UTF8 in browsers\n    res.on('data', chunk => {\n      buffer += chunk;\n      processBuffer();\n    });\n    res.on('end', () => {\n      let err;\n      let bodyObject;\n      try {\n        res.text = body + buffer;\n        bodyObject = res.text && JSON.parse(res.text);\n      } catch (err_) {\n        err = err_;\n        // issue #675: return the raw response if the response parsing fails\n        err.rawResponse = res.text || null;\n        // issue #876: return the http status code if the response parsing fails\n        err.statusCode = res.statusCode;\n      } finally {\n        fn(err, bodyObject);\n      }\n    });\n  };\n\n  /// --- Direct Push\n  function addEvent (strEvent) {\n    foreachEvent(JSON.parse(strEvent));\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n\n/* global location */\n\n/**\n * Holds Pryv Service informations.\n *\n * It's returned by `service.assets()`\n *\n * @memberof pryv\n **/\nclass ServiceAssets {\n  /**\n   * Private => use ServiceAssets.setup()\n   * @param {Object} assets The content of service/info.assets properties.\n   * @param {string} assetsURL Url point to assets of the service of a Pryv platform\n   */\n  constructor (assets, assetsURL) {\n    this._assets = assets;\n    this._assetsURL = assetsURL;\n  }\n\n  /**\n   * Load Assets definition from URL\n   * @param {string} pryvServiceAssetsSourceUrl - URL to the assets definition JSON\n   * @returns {Promise<ServiceAssets>} Promise resolving to ServiceAssets instance\n   */\n  static async setup (pryvServiceAssetsSourceUrl) {\n    const { body } = await utils.fetchGet(pryvServiceAssetsSourceUrl);\n    return new ServiceAssets(body, pryvServiceAssetsSourceUrl);\n  }\n\n  /**\n   * get a value from path separated by `:`\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  get (keyPath) {\n    let result = Object.assign({}, this._assets);\n    if (keyPath) {\n      keyPath.split(':').forEach((key) => {\n        result = result[key];\n        if (typeof result === 'undefined') return result;\n      });\n    }\n    return result;\n  }\n\n  /**\n   * get an Url from path separated by `:`\n   * identical to doing assets.relativeURL(assets.get(keyPath))\n   * example of key `lib-js:buttonSignIn`\n   * @param {string} [keyPath] if null, will return the all assets\n   */\n  getUrl (keyPath) {\n    const url = this.get(keyPath);\n    if (typeof url !== 'string') {\n      throw new Error(`Unexpected value for ${keyPath}: ${url}`);\n    }\n    return this.relativeURL(url);\n  }\n\n  /**\n   * get relativeUrl\n   */\n  relativeURL (url) {\n    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);\n  }\n\n  // ---------------- Default service resources\n\n  /**\n   * Set all defaults Favicon, CSS\n   */\n  async setAllDefaults () {\n    this.setFavicon();\n    await this.loadCSS();\n  }\n\n  /**\n   * Set service Favicon to Web Page\n   */\n  setFavicon () {\n    /** @type {HTMLLinkElement} */\n    // @ts-ignore - querySelector returns Element but we know it's HTMLLinkElement\n    const link = document.querySelector(\"link[rel*='icon']\") || document.createElement('link');\n    link.type = 'image/x-icon';\n    link.rel = 'shortcut icon';\n    link.href = this.relativeURL(this._assets.favicon.default.url);\n    document.getElementsByTagName('head')[0].appendChild(link);\n  }\n\n  /**\n   * Set default service CSS\n   */\n  async loadCSS () {\n    loadCSS(this.relativeURL(this._assets.css.default.url));\n  }\n\n  // ---- Login\n\n  /**\n   * Load CSS for Login button\n   */\n  async loginButtonLoadCSS () {\n    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));\n  }\n\n  /**\n   * Get HTML for Login Button\n   * @returns {Promise<string>} Promise resolving to HTML string\n   */\n  async loginButtonGetHTML () {\n    const { text } = await utils.fetchGetText(this.relativeURL(this._assets['lib-js'].buttonSignIn.html));\n    return text;\n  }\n\n  /**\n   * Get Messages strings for Login Button\n   * @returns {Promise<Object.<string, string>>} Promise resolving to messages object\n   */\n  async loginButtonGetMessages () {\n    const { body } = await utils.fetchGet(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages));\n    return body;\n  }\n}\n\nmodule.exports = ServiceAssets;\n\nfunction loadCSS (url) {\n  const head = document.getElementsByTagName('head')[0];\n  const link = document.createElement('link');\n  link.id = url;\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n  link.media = 'all';\n  head.appendChild(link);\n}\n\n/* HACK: disabling linting until code is cleaned up */\n/* eslint-disable */\n\n  /*\\\n  |*| Modified version of\n  |*| :: translate relative paths to absolute paths ::\n  |*|\n  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\n  |*|\n  |*| The following code is released under the GNU Public License, version 3 or later.\n  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html\n  |*|\n  \\*/\n\nfunction relPathToAbs (baseUrlString, sRelPath) {\n  /** @type {Location|HTMLAnchorElement} */\n  var baseLocation = location;\n  if (baseUrlString) {\n    // @ts-ignore - HTMLAnchorElement has compatible URL properties\n    baseLocation = document.createElement('a');\n    baseLocation.href = baseUrlString;\n  }\n\n  var nUpLn, sDir = \"\", sPath = baseLocation.pathname.replace(/[^\\/]*$/, sRelPath.replace(/(\\/|^)(?:\\.?\\/+)+/g, \"$1\"));\n  for (var nEnd, nStart = 0; nEnd = sPath.indexOf(\"/../\", nStart), nEnd > -1; nStart = nEnd + nUpLn) {\n    nUpLn = /^\\/(?:\\.\\.\\/)*/.exec(sPath.slice(nEnd))[0].length;\n    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp(\"(?:\\\\\\/+[^\\\\\\/]*){0,\" + ((nUpLn - 1) / 3) + \"}$\"),\n      \"/\");\n  }\n  const portStr = baseLocation.port ? ':' + baseLocation.port : '';\n  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('../utils');\nconst AuthStates = require('./AuthStates');\nconst Messages = require('./LoginMessages');\n\n/**\n * Controller for authentication flow\n * @memberof pryv.Auth\n */\nclass AuthController {\n  /**\n   * Create an AuthController\n   * @param {AuthSettings} settings - Authentication settings\n   * @param {Service} service - Pryv service instance\n   * @param {CustomLoginButton} loginButton - Login button implementation\n   */\n  constructor (settings, service, loginButton) {\n    this.settings = settings;\n    validateSettings.call(this, settings);\n\n    this.stateChangeListeners = [];\n    if (this.settings.onStateChange) {\n      this.stateChangeListeners.push(this.settings.onStateChange);\n    }\n    this.service = service;\n\n    // probably remove\n    this.languageCode = this.settings.authRequest.languageCode || 'en';\n    this.messages = Messages(this.languageCode);\n\n    this.loginButton = loginButton;\n\n    function validateSettings (settings) {\n      if (!settings) { throw new Error('settings cannot be null'); }\n      // -- settings\n      if (!settings.authRequest) { throw new Error('Missing settings.authRequest'); }\n\n      // -- Extract returnURL\n      settings.authRequest.returnURL =\n        this.getReturnURL(settings.authRequest.returnURL);\n\n      if (!settings.authRequest.requestingAppId) {\n        throw new Error('Missing settings.authRequest.requestingAppId');\n      }\n      if (!settings.authRequest.requestedPermissions) {\n        throw new Error('Missing settings.authRequest.requestedPermissions');\n      }\n    }\n  }\n\n  /**\n   * Initialize the auth controller. Call this right after instantiation.\n   * @returns {Promise<Service>} Promise resolving to the Service instance\n   */\n  async init () {\n    this.serviceInfo = this.service.infoSync();\n    this.state = { status: AuthStates.LOADING };\n    this.assets = await loadAssets(this);\n\n    const loginButton = this.loginButton;\n    // initialize human interaction interface\n    if (loginButton != null) {\n      this.stateChangeListeners.push(loginButton.onStateChange.bind(loginButton));\n      // autologin needs cookies/storage implemented in human interaction interface\n      await checkAutoLogin(this);\n    }\n\n    // if auto login is not prompted\n    if (this.state.status !== AuthStates.AUTHORIZED) {\n      this.state = { status: AuthStates.INITIALIZED, serviceInfo: this.serviceInfo };\n    }\n\n    if (loginButton != null && loginButton.finishAuthProcessAfterRedirection != null) {\n      // @ts-ignore - this is a valid AuthController\n      await loginButton.finishAuthProcessAfterRedirection(this);\n    }\n\n    return this.service;\n  }\n\n  /**\n   * Stops poll for auth request\n   */\n  stopAuthRequest (msg) {\n    this.state = { status: AuthStates.ERROR, message: msg };\n  }\n\n  /**\n   * Handle button click - triggers appropriate action based on current state\n   * @returns {Promise<void>}\n   */\n  async handleClick () {\n    if (isAuthorized.call(this)) {\n      this.state = { status: AuthStates.SIGNOUT };\n    } else if (isInitialized.call(this)) {\n      this.startAuthRequest();\n    } else if (isNeedSignIn.call(this)) {\n      // reopen popup (HACK for now: set to private property to avoid self-assignment)\n      this.state = this._state;\n    } else {\n      console.log('Unhandled action in \"handleClick()\" for status:', this.state.status);\n    }\n\n    function isAuthorized () {\n      return this.state.status === AuthStates.AUTHORIZED;\n    }\n    function isInitialized () {\n      return this.state.status === AuthStates.INITIALIZED;\n    }\n    function isNeedSignIn () {\n      return this.state.status === AuthStates.NEED_SIGNIN;\n    }\n  }\n\n  /**\n   * Compute the return URL for authentication redirect.\n   * Used only in browser environments.\n   * @param {string} [returnURL] - The return URL setting ('auto#', 'self#', or custom URL)\n   * @param {string} [windowLocationForTest] - Mock window.location.href for testing\n   * @param {string|Navigator} [navigatorForTests] - Mock navigator for testing\n   * @returns {string|boolean} The computed return URL, or false if using popup mode\n   */\n  getReturnURL (\n    returnURL,\n    windowLocationForTest,\n    navigatorForTests\n  ) {\n    const RETURN_URL_AUTO = 'auto';\n\n    returnURL = returnURL || RETURN_URL_AUTO + '#';\n\n    // check the trailer\n    const trailer = returnURL.slice(-1);\n    if ('#&?'.indexOf(trailer) < 0) {\n      throw new Error('Pryv access: Last character of --returnURL setting-- is not ' +\n        '\"?\", \"&\" or \"#\": ' + returnURL);\n    }\n    // auto mode for desktop\n    if (returnUrlIsAuto(returnURL) &&\n        !utils.browserIsMobileOrTablet(navigatorForTests)) {\n      return false;\n    // auto mode for mobile or self\n    } else if ((returnUrlIsAuto(returnURL) &&\n                utils.browserIsMobileOrTablet(navigatorForTests)) ||\n               returnURL.indexOf('self') === 0) {\n      // set self as return url?\n      // eventually clean-up current url from previous pryv returnURL\n      const locationHref = windowLocationForTest || window.location.href;\n      returnURL = locationHref + returnURL.substring(4);\n    }\n    return utils.cleanURLFromPrYvParams(returnURL);\n\n    function returnUrlIsAuto (returnURL) {\n      return returnURL.indexOf(RETURN_URL_AUTO) === 0;\n    }\n  }\n\n  /**\n   * Start the authentication request and polling process\n   * @returns {Promise<void>}\n   * @see https://pryv.github.io/reference/#auth-request\n   */\n  async startAuthRequest () {\n    // @ts-ignore - postAccess uses .call(this) for context\n    this.state = await postAccess.call(this);\n\n    await doPolling.call(this);\n\n    /** @this {AuthController} */\n    async function postAccess () {\n      try {\n        const { response, body } = await utils.fetchPost(\n          // @ts-ignore - this is bound via .call()\n          this.serviceInfo.access,\n          // @ts-ignore - this is bound via .call()\n          this.settings.authRequest\n        );\n        if (!response.ok) {\n          throw new Error('Access request failed: ' + JSON.stringify(body));\n        }\n        return body;\n      } catch (e) {\n        this.state = {\n          status: AuthStates.ERROR,\n          message: 'Requesting access',\n          error: e\n        };\n        throw e; // forward error\n      }\n    }\n\n    /** @this {AuthController} */\n    async function doPolling () {\n      // @ts-ignore - this is bound via .call()\n      if (this.state?.status !== AuthStates.NEED_SIGNIN) {\n        return;\n      }\n      // @ts-ignore - this is bound via .call()\n      const pollResponse = await pollAccess(this.state?.poll);\n\n      if (pollResponse.status === AuthStates.NEED_SIGNIN) {\n        // @ts-ignore - this is bound via .call()\n        setTimeout(await doPolling.bind(this), this.state?.poll_rate_ms);\n      } else {\n        this.state = pollResponse;\n      }\n\n      async function pollAccess (pollUrl) {\n        try {\n          const { response, body } = await utils.fetchGet(pollUrl);\n          if (response.status === 403 && body?.status === 'REFUSED') {\n            return { status: AuthStates.INITIALIZED };\n          }\n          return body;\n        } catch (e) {\n          return { status: AuthStates.ERROR, message: 'Error while polling for auth request', error: e };\n        }\n      }\n    }\n  }\n\n  // -------------- state listeners ---------------------\n  set state (newState) {\n    // retro-compatibility for lib-js < 2.0.9\n    newState.id = newState.status;\n\n    this._state = newState;\n\n    this.stateChangeListeners.forEach((listener) => {\n      try {\n        listener(this.state);\n      } catch (e) {\n        console.log('Error during set state ()', e);\n      }\n    });\n  }\n\n  get state () {\n    return this._state;\n  }\n}\n\n// ----------- private methods -------------\n\nasync function checkAutoLogin (authController) {\n  const loginButton = authController.loginButton;\n  if (loginButton == null) {\n    return;\n  }\n\n  const storedCredentials = await loginButton.getAuthorizationData();\n  if (storedCredentials != null) {\n    authController.state = Object.assign({}, { status: AuthStates.AUTHORIZED }, storedCredentials);\n  }\n}\n\n// ------------------ ACTIONS  ----------- //\n\nasync function loadAssets (authController) {\n  let loadedAssets = {};\n  try {\n    loadedAssets = await authController.service.assets();\n    if (typeof location !== 'undefined') {\n      await loadedAssets.loginButtonLoadCSS();\n      const thisMessages = await loadedAssets.loginButtonGetMessages();\n      if (thisMessages.LOADING) {\n        authController.messages = Messages(authController.languageCode, thisMessages);\n      } else {\n        console.log('WARNING Messages cannot be loaded using defaults: ', thisMessages);\n      }\n    }\n  } catch (e) {\n    authController.state = {\n      status: AuthStates.ERROR,\n      message: 'Cannot fetch button visuals',\n      error: e\n    };\n    throw e; // forward error\n  }\n  return loadedAssets;\n}\n\nmodule.exports = AuthController;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Manager = void 0;\nconst engine_io_client_1 = require(\"engine.io-client\");\nconst socket_js_1 = require(\"./socket.js\");\nconst parser = __importStar(require(\"socket.io-parser\"));\nconst on_js_1 = require(\"./on.js\");\nconst backo2_js_1 = require(\"./contrib/backo2.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:manager\"); // debug()\nclass Manager extends component_emitter_1.Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        (0, engine_io_client_1.installTimerFunctions)(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new backo2_js_1.Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        if (!v) {\n            this.skipReconnect = true;\n        }\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        debug(\"readyState %s\", this._readyState);\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        debug(\"opening %s\", this.uri);\n        this.engine = new engine_io_client_1.Socket(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = (0, on_js_1.on)(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            debug(\"error\");\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = (0, on_js_1.on)(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            debug(\"connect attempt will timeout after %d\", timeout);\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                debug(\"connect attempt timed out after %d\", timeout);\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        debug(\"open\");\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push((0, on_js_1.on)(socket, \"ping\", this.onping.bind(this)), (0, on_js_1.on)(socket, \"data\", this.ondata.bind(this)), (0, on_js_1.on)(socket, \"error\", this.onerror.bind(this)), (0, on_js_1.on)(socket, \"close\", this.onclose.bind(this)), \n        // @ts-ignore\n        (0, on_js_1.on)(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        (0, engine_io_client_1.nextTick)(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        debug(\"error\", err);\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new socket_js_1.Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                debug(\"socket %s is still active, skipping close\", nsp);\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        debug(\"writing packet %j\", packet);\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        debug(\"cleanup\");\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        debug(\"disconnect\");\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called when:\n     *\n     * - the low-level engine is closed\n     * - the parser encountered a badly formatted packet\n     * - all sockets are disconnected\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        var _a;\n        debug(\"closed due to %s\", reason);\n        this.cleanup();\n        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            debug(\"reconnect failed\");\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            debug(\"will wait %dms before reconnect attempt\", delay);\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                debug(\"attempting reconnect\");\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        debug(\"reconnect attempt error\");\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        debug(\"reconnect success\");\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\nexports.Manager = Manager;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hasCORS = void 0;\n// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexports.hasCORS = value;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst LoginButton = require('./LoginButton');\nconst CookieUtils = require('./CookieUtils');\nconst utils = require('../utils');\n\n/**\n * @memberof pryv\n * @namespace pryv.Browser\n */\nmodule.exports = {\n  LoginButton,\n  CookieUtils,\n  // retro-compatibility for lib-js < 2.0.9\n  AuthStates: require('../Auth/AuthStates'),\n  setupAuth: require('../Auth').setupAuth,\n  serviceInfoFromUrl: getServiceInfoFromURL\n};\n\n/**\n * Util to grab parameters from url query string\n * @param {*} url\n */\nfunction getServiceInfoFromURL (url) {\n  const queryParams = utils.getQueryParamsFromURL(url || window.location.href);\n  return queryParams.pryvServiceInfoUrl;\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/**\n * Enum trigger messages\n * @readonly\n * @enum {string}\n */\nconst Changes = {\n  EVENT: 'event',\n  EVENT_DELETE: 'eventDelete',\n  STREAMS: 'streams',\n  ERROR: 'error',\n  READY: 'ready',\n  STOP: 'stop'\n};\n\nmodule.exports = Changes;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst UpdateMethod = require('./UpdateMethod');\n\n/**\n * Update method that polls for event changes at a fixed interval.\n * @memberof pryv.Monitor\n * @extends UpdateMethod\n */\nclass EventsTimer extends UpdateMethod {\n  /**\n   * @param {number} updateRateMS - The refresh rate in milliseconds (must be > 1)\n   */\n  constructor (updateRateMS) {\n    super();\n    this.timer = null;\n    if (!updateRateMS || isNaN(updateRateMS) || updateRateMS < 1) {\n      throw new Error('Monitor timer refresh rate is not valid. It should be a number > 1');\n    }\n    this.updateRateMS = updateRateMS;\n  }\n\n  async ready () {\n    if (this.timer != null) clearTimeout(this.timer);\n    this.timer = setTimeout(() => {\n      if (this.monitor.started) this.monitor.updateEvents();\n    }, this.updateRateMS);\n  }\n}\n\nmodule.exports = EventsTimer;\n","/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WT = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:webtransport\"); // debug()\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nclass WT extends transport_js_1.Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            debug(\"transport closed gracefully\");\n            this.onClose();\n        })\n            .catch((err) => {\n            debug(\"transport closed due to %s\", err);\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = (0, engine_io_parser_1.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = (0, engine_io_parser_1.createPacketEncoderStream)();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            debug(\"session is closed\");\n                            return;\n                        }\n                        debug(\"received chunk: %o\", value);\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                        debug(\"an error occurred while reading: %s\", err);\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    (0, globals_node_js_1.nextTick)(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\nexports.WT = WT;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.defaultBinaryType = exports.globalThisShim = exports.nextTick = void 0;\nexports.createCookieJar = createCookieJar;\nexports.nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexports.globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\nexports.defaultBinaryType = \"arraybuffer\";\nfunction createCookieJar() { }\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Decoder = exports.Encoder = exports.PacketType = exports.protocol = void 0;\nexports.isPacketValid = isPacketValid;\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst binary_js_1 = require(\"./binary.js\");\nconst is_binary_js_1 = require(\"./is-binary.js\");\nconst debug_1 = require(\"debug\"); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-parser\"); // debug()\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\", // used on the client side\n    \"connect_error\", // used on the client side\n    \"disconnect\", // used on both sides\n    \"disconnecting\", // used on the server side\n    \"newListener\", // used by the Node.js EventEmitter\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexports.protocol = 5;\nvar PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (exports.PacketType = PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nclass Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        debug(\"encoding packet %j\", obj);\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if ((0, is_binary_js_1.hasBinary)(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        debug(\"encoded %j as %s\", obj, str);\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = (0, binary_js_1.deconstructPacket)(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\nexports.Encoder = Encoder;\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nclass Decoder extends component_emitter_1.Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if ((0, is_binary_js_1.isBinary)(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        debug(\"decoded %s as %j\", str, p);\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\nexports.Decoder = Decoder;\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = (0, binary_js_1.reconstructPacket)(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\nfunction isNamespaceValid(nsp) {\n    return typeof nsp === \"string\";\n}\n// see https://caniuse.com/mdn-javascript_builtins_number_isinteger\nconst isInteger = Number.isInteger ||\n    function (value) {\n        return (typeof value === \"number\" &&\n            isFinite(value) &&\n            Math.floor(value) === value);\n    };\nfunction isAckIdValid(id) {\n    return id === undefined || isInteger(id);\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\nfunction isDataValid(type, payload) {\n    switch (type) {\n        case PacketType.CONNECT:\n            return payload === undefined || isObject(payload);\n        case PacketType.DISCONNECT:\n            return payload === undefined;\n        case PacketType.EVENT:\n            return (Array.isArray(payload) &&\n                (typeof payload[0] === \"number\" ||\n                    (typeof payload[0] === \"string\" &&\n                        RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n        case PacketType.ACK:\n            return Array.isArray(payload);\n        case PacketType.CONNECT_ERROR:\n            return typeof payload === \"string\" || isObject(payload);\n        default:\n            return false;\n    }\n}\nfunction isPacketValid(packet) {\n    return (isNamespaceValid(packet.nsp) &&\n        isAckIdValid(packet.id) &&\n        isDataValid(packet.type, packet.data));\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transport = exports.TransportError = void 0;\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst util_js_1 = require(\"./util.js\");\nconst parseqs_js_1 = require(\"./contrib/parseqs.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:transport\"); // debug()\nclass TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexports.TransportError = TransportError;\nclass Transport extends component_emitter_1.Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n        this.supportsBinary = !opts.forceBase64;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n            debug(\"transport is not open, discarding packets\");\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = (0, engine_io_parser_1.decodePacket)(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port) !== 443) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = (0, parseqs_js_1.encode)(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\nexports.Transport = Transport;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.deconstructPacket = deconstructPacket;\nexports.reconstructPacket = reconstructPacket;\nconst is_binary_js_1 = require(\"./is-binary.js\");\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nfunction deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if ((0, is_binary_js_1.isBinary)(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nfunction reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebTransport = exports.WebSocket = exports.NodeWebSocket = exports.XHR = exports.NodeXHR = exports.Fetch = exports.nextTick = exports.parse = exports.installTimerFunctions = exports.transports = exports.TransportError = exports.Transport = exports.protocol = exports.SocketWithUpgrade = exports.SocketWithoutUpgrade = exports.Socket = void 0;\nconst socket_js_1 = require(\"./socket.js\");\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_js_1.Socket; } });\nvar socket_js_2 = require(\"./socket.js\");\nObject.defineProperty(exports, \"SocketWithoutUpgrade\", { enumerable: true, get: function () { return socket_js_2.SocketWithoutUpgrade; } });\nObject.defineProperty(exports, \"SocketWithUpgrade\", { enumerable: true, get: function () { return socket_js_2.SocketWithUpgrade; } });\nexports.protocol = socket_js_1.Socket.protocol;\nvar transport_js_1 = require(\"./transport.js\");\nObject.defineProperty(exports, \"Transport\", { enumerable: true, get: function () { return transport_js_1.Transport; } });\nObject.defineProperty(exports, \"TransportError\", { enumerable: true, get: function () { return transport_js_1.TransportError; } });\nvar index_js_1 = require(\"./transports/index.js\");\nObject.defineProperty(exports, \"transports\", { enumerable: true, get: function () { return index_js_1.transports; } });\nvar util_js_1 = require(\"./util.js\");\nObject.defineProperty(exports, \"installTimerFunctions\", { enumerable: true, get: function () { return util_js_1.installTimerFunctions; } });\nvar parseuri_js_1 = require(\"./contrib/parseuri.js\");\nObject.defineProperty(exports, \"parse\", { enumerable: true, get: function () { return parseuri_js_1.parse; } });\nvar globals_node_js_1 = require(\"./globals.node.js\");\nObject.defineProperty(exports, \"nextTick\", { enumerable: true, get: function () { return globals_node_js_1.nextTick; } });\nvar polling_fetch_js_1 = require(\"./transports/polling-fetch.js\");\nObject.defineProperty(exports, \"Fetch\", { enumerable: true, get: function () { return polling_fetch_js_1.Fetch; } });\nvar polling_xhr_node_js_1 = require(\"./transports/polling-xhr.node.js\");\nObject.defineProperty(exports, \"NodeXHR\", { enumerable: true, get: function () { return polling_xhr_node_js_1.XHR; } });\nvar polling_xhr_js_1 = require(\"./transports/polling-xhr.js\");\nObject.defineProperty(exports, \"XHR\", { enumerable: true, get: function () { return polling_xhr_js_1.XHR; } });\nvar websocket_node_js_1 = require(\"./transports/websocket.node.js\");\nObject.defineProperty(exports, \"NodeWebSocket\", { enumerable: true, get: function () { return websocket_node_js_1.WS; } });\nvar websocket_js_1 = require(\"./transports/websocket.js\");\nObject.defineProperty(exports, \"WebSocket\", { enumerable: true, get: function () { return websocket_js_1.WS; } });\nvar webtransport_js_1 = require(\"./transports/webtransport.js\");\nObject.defineProperty(exports, \"WebTransport\", { enumerable: true, get: function () { return webtransport_js_1.WT; } });\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.pick = pick;\nexports.installTimerFunctions = installTimerFunctions;\nexports.byteLength = byteLength;\nexports.randomString = randomString;\nconst globals_node_js_1 = require(\"./globals.node.js\");\nfunction pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globals_node_js_1.globalThisShim.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globals_node_js_1.globalThisShim.clearTimeout;\nfunction installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globals_node_js_1.globalThisShim);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globals_node_js_1.globalThisShim);\n    }\n    else {\n        obj.setTimeoutFn = globals_node_js_1.globalThisShim.setTimeout.bind(globals_node_js_1.globalThisShim);\n        obj.clearTimeoutFn = globals_node_js_1.globalThisShim.clearTimeout.bind(globals_node_js_1.globalThisShim);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nfunction byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n/**\n * Generates a random 8-characters string.\n */\nfunction randomString() {\n    return (Date.now().toString(36).substring(3) +\n        Math.random().toString(36).substring(2, 5));\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nconst utils = require('../utils');\n\n/**\n * @memberof pryv.Browser\n * @namespace pryv.Browser.CookieUtils\n */\nmodule.exports = {\n  get,\n  set,\n  del\n};\n\n/**\n  * Set a local cookie\n  * @memberof pryv.Browser.CookieUtils\n  * @template T\n  * @param {string} cookieKey - The key for the cookie\n  * @param {T} value - The value (will be JSON stringified)\n  * @param {number} [expireInDays=365] - Expiration date in days from now\n  */\nfunction set (cookieKey, value, expireInDays) {\n  if (!utils.isBrowser()) return;\n  expireInDays = expireInDays || 365;\n  const myDate = new Date();\n  const hostName = window.location.hostname;\n  const path = window.location.pathname;\n  myDate.setDate(myDate.getDate() + expireInDays);\n  let cookieStr = encodeURIComponent(cookieKey) + '=' +\n    encodeURIComponent(JSON.stringify(value)) +\n    ';expires=' + myDate.toUTCString() +\n    ';domain=.' + hostName + ';path=' + path;\n  // do not add SameSite when removing a cookie\n  if (expireInDays >= 0) cookieStr += ';SameSite=Strict';\n  document.cookie = cookieStr;\n}\n\n/**\n * Return the value of a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @template T\n * @param {string} cookieKey - The key\n * @returns {T|undefined} The parsed cookie value or undefined if not found\n */\nfunction get (cookieKey) {\n  const name = encodeURIComponent(cookieKey);\n  if (!utils.isBrowser()) return;\n  const value = '; ' + document.cookie;\n  const parts = value.split('; ' + name + '=');\n  if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));\n}\n\n/**\n * Delete a local cookie\n * @memberof pryv.Browser.CookieUtils\n * @param {string} cookieKey - The key\n */\nfunction del (cookieKey) {\n  set(cookieKey, { deleted: true }, -1);\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.on = on;\nfunction on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n\nmodule.exports = {\n  Null: require('./UpdateMethod'),\n  Socket: require('./Socket'),\n  EventsTimer: require('./EventsTimer')\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('./Changes');\n\nmodule.exports = async function _updateStreams (monitor) {\n  try {\n    const result = await monitor.connection.get('streams');\n    if (!result.streams) { throw new Error('Invalid response ' + JSON.stringify(result)); }\n    monitor.emit(Changes.STREAMS, result.streams);\n  } catch (e) {\n    monitor.emit(Changes.ERROR, e);\n  }\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst SocketIO = require('./SocketIO');\n\n/**\n * Load Socket.IO capabilities onto `pryv`\n * @param {pryv} pryv `pryv` library @see https://github.com/pryv/lib-js\n */\nmodule.exports = function (pryv) {\n  console.log('\"pryv\" lib version', pryv.version);\n  // check version here\n  if (pryv.Connection.SocketIO) {\n    throw new Error('Socket.IO add-on already loaded');\n  }\n  // sharing cross references\n  pryv.Connection.SocketIO = SocketIO;\n  SocketIO(pryv.Connection);\n};\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Socket = void 0;\nconst socket_io_parser_1 = require(\"socket.io-parser\");\nconst on_js_1 = require(\"./on.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:socket\"); // debug()\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nclass Socket extends component_emitter_1.Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        /**\n         * A map containing acknowledgement handlers.\n         *\n         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:\n         *\n         * - `socket.emit(\"test\", (err, value) => { ... })` with `ackTimeout` option\n         * - `socket.timeout(5000).emit(\"test\", (err, value) => { ... })`\n         * - `const value = await socket.emitWithAck(\"test\")`\n         *\n         * From those that don't:\n         *\n         * - `socket.emit(\"test\", (value) => { ... });`\n         *\n         * In the first case, the handlers will be called with an error when:\n         *\n         * - the timeout is reached\n         * - the socket gets disconnected\n         *\n         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive\n         * an acknowledgement from the server.\n         *\n         * @private\n         */\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            (0, on_js_1.on)(io, \"open\", this.onopen.bind(this)),\n            (0, on_js_1.on)(io, \"packet\", this.onpacket.bind(this)),\n            (0, on_js_1.on)(io, \"error\", this.onerror.bind(this)),\n            (0, on_js_1.on)(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        var _a, _b, _c;\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: socket_io_parser_1.PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            debug(\"emitting packet with ack id %d\", id);\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;\n        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());\n        const discardPacket = this.flags.volatile && !isTransportWritable;\n        if (discardPacket) {\n            debug(\"discard packet as the transport is not currently writable\");\n        }\n        else if (isConnected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    debug(\"removing packet with ack id %d from the buffer\", id);\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            debug(\"event with ack id %d has timed out after %d ms\", id, timeout);\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        const fn = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, args);\n        };\n        fn.withError = true;\n        this.acks[id] = fn;\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        return new Promise((resolve, reject) => {\n            const fn = (arg1, arg2) => {\n                return arg1 ? reject(arg1) : resolve(arg2);\n            };\n            fn.withError = true;\n            args.push(fn);\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                return debug(\"packet [%d] already acknowledged\", packet.id);\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    debug(\"packet [%d] is discarded after %d tries\", packet.id, packet.tryCount);\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                debug(\"packet [%d] was successfully sent\", packet.id);\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        debug(\"draining queue\");\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            debug(\"packet [%d] has already been sent and is waiting for an ack\", packet.id);\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        debug(\"sending packet [%d] (try n%d)\", packet.id, packet.tryCount);\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        debug(\"transport is open - connecting\");\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: socket_io_parser_1.PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        debug(\"close (%s)\", reason);\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n        this._clearAcks();\n    }\n    /**\n     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from\n     * the server.\n     *\n     * @private\n     */\n    _clearAcks() {\n        Object.keys(this.acks).forEach((id) => {\n            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);\n            if (!isBuffered) {\n                // note: handlers that do not accept an error as first argument are ignored here\n                const ack = this.acks[id];\n                delete this.acks[id];\n                if (ack.withError) {\n                    ack.call(this, new Error(\"socket has been disconnected\"));\n                }\n            }\n        });\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case socket_io_parser_1.PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case socket_io_parser_1.PacketType.EVENT:\n            case socket_io_parser_1.PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case socket_io_parser_1.PacketType.ACK:\n            case socket_io_parser_1.PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case socket_io_parser_1.PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case socket_io_parser_1.PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        debug(\"emitting event %j\", args);\n        if (null != packet.id) {\n            debug(\"attaching ack callback to event\");\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            debug(\"sending ack %j\", args);\n            self.packet({\n                type: socket_io_parser_1.PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowledgement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (typeof ack !== \"function\") {\n            debug(\"bad ack %s\", packet.id);\n            return;\n        }\n        delete this.acks[packet.id];\n        debug(\"calling ack %s with %j\", packet.id, packet.data);\n        // @ts-ignore FIXME ack is incorrectly inferred as 'never'\n        if (ack.withError) {\n            packet.data.unshift(null);\n        }\n        // @ts-ignore\n        ack.apply(this, packet.data);\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        debug(\"socket connected with id %s\", id);\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this._drainQueue(true);\n        this.emitReserved(\"connect\");\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        debug(\"server disconnect (%s)\", this.nsp);\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            debug(\"performing disconnect (%s)\", this.nsp);\n            this.packet({ type: socket_io_parser_1.PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\nexports.Socket = Socket;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodePayload = exports.decodePacket = exports.encodePayload = exports.encodePacket = exports.protocol = void 0;\nexports.createPacketEncoderStream = createPacketEncoderStream;\nexports.createPacketDecoderStream = createPacketDecoderStream;\nconst encodePacket_js_1 = require(\"./encodePacket.js\");\nObject.defineProperty(exports, \"encodePacket\", { enumerable: true, get: function () { return encodePacket_js_1.encodePacket; } });\nconst decodePacket_js_1 = require(\"./decodePacket.js\");\nObject.defineProperty(exports, \"decodePacket\", { enumerable: true, get: function () { return decodePacket_js_1.decodePacket; } });\nconst commons_js_1 = require(\"./commons.js\");\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        (0, encodePacket_js_1.encodePacket)(packet, false, (encodedPacket) => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nexports.encodePayload = encodePayload;\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = (0, decodePacket_js_1.decodePacket)(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexports.decodePayload = decodePayload;\nfunction createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            (0, encodePacket_js_1.encodePacketToBinary)(packet, (encodedPacket) => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        },\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nfunction createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* State.READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* State.READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* State.READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(commons_js_1.ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue((0, decodePacket_js_1.decodePacket)(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* State.READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(commons_js_1.ERROR_PACKET);\n                    break;\n                }\n            }\n        },\n    });\n}\nexports.protocol = 4;\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function (val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.url = url;\nconst engine_io_client_1 = require(\"engine.io-client\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client:url\"); // debug()\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nfunction url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            debug(\"protocol-less url %s\", uri);\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        debug(\"parse %s\", uri);\n        obj = (0, engine_io_client_1.parse)(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n/* global fetch */\n\nmodule.exports = getEventStreamed;\n\nasync function getEventStreamed (conn, queryParam, parser) {\n  /**\n   * Holds Parser's settings\n   */\n  const parserSettings = {\n    ondata: null,\n    onend: null,\n    encoding: 'utf8'\n  };\n\n  /**\n   * Mock Response\n   */\n  const fakeRes = {\n    setEncoding: function (encoding) {\n      parserSettings.encoding = encoding;\n    }, // will receive 'data' and 'end' callbacks\n    on: function (key, f) {\n      parserSettings['on' + key] = f;\n    }\n  };\n\n  /**\n   * Holds results from the parser\n   */\n  let errResult;\n  let bodyObjectResult;\n  /**\n   *\n   */\n  parser(fakeRes, function (err, bodyObject) {\n    errResult = err;\n    bodyObjectResult = bodyObject;\n  });\n\n  // ------------   fetch ------------------- //\n  const url = new URL(conn.endpoint + 'events');\n  url.search = new URLSearchParams(queryParam).toString();\n  const fetchParams = { method: 'GET', headers: { Accept: 'application/json' } };\n  if (conn.token) fetchParams.headers.Authorization = conn.token;\n\n  const response = await fetch(url, fetchParams);\n  const reader = response.body.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    parserSettings.ondata(new TextDecoder(parserSettings.encoding).decode(value));\n    if (done) { parserSettings.onend(); break; }\n  }\n\n  if (errResult) {\n    throw new Error(errResult);\n  }\n\n  // We're done!\n  const result = {\n    text: fakeRes.text, // from the parser\n    body: bodyObjectResult, // from the parser\n    statusCode: response.status,\n    headers: {}\n  };\n  // add headers to result\n  // @ts-ignore - Headers.entries() exists in modern environments\n  for (const pair of response.headers.entries()) {\n    result.headers[pair[0]] = pair[1];\n  }\n\n  return result;\n}\n","\"use strict\";\n/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Backoff = Backoff;\nfunction Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\tlet m;\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\t// eslint-disable-next-line no-return-assign\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && (m = navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)) && parseInt(m[1], 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug') || exports.storage.getItem('DEBUG') ;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\n// make lib available as `Pryv` (with capital P, deprecated) for backward-compatibility with apps importing via <script>\n// TODO: remove deprecated alias with next major version\nmodule.exports = global.Pryv = require('./index');\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebTransport = exports.WebSocket = exports.NodeWebSocket = exports.XHR = exports.NodeXHR = exports.Fetch = exports.Socket = exports.Manager = exports.protocol = void 0;\nexports.io = lookup;\nexports.connect = lookup;\nexports.default = lookup;\nconst url_js_1 = require(\"./url.js\");\nconst manager_js_1 = require(\"./manager.js\");\nObject.defineProperty(exports, \"Manager\", { enumerable: true, get: function () { return manager_js_1.Manager; } });\nconst socket_js_1 = require(\"./socket.js\");\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_js_1.Socket; } });\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"socket.io-client\"); // debug()\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = (0, url_js_1.url)(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        debug(\"ignoring socket cache for %s\", source);\n        io = new manager_js_1.Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            debug(\"new io instance for %s\", source);\n            cache[id] = new manager_js_1.Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager: manager_js_1.Manager,\n    Socket: socket_js_1.Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nvar socket_io_parser_1 = require(\"socket.io-parser\");\nObject.defineProperty(exports, \"protocol\", { enumerable: true, get: function () { return socket_io_parser_1.protocol; } });\nvar engine_io_client_1 = require(\"engine.io-client\");\nObject.defineProperty(exports, \"Fetch\", { enumerable: true, get: function () { return engine_io_client_1.Fetch; } });\nObject.defineProperty(exports, \"NodeXHR\", { enumerable: true, get: function () { return engine_io_client_1.NodeXHR; } });\nObject.defineProperty(exports, \"XHR\", { enumerable: true, get: function () { return engine_io_client_1.XHR; } });\nObject.defineProperty(exports, \"NodeWebSocket\", { enumerable: true, get: function () { return engine_io_client_1.NodeWebSocket; } });\nObject.defineProperty(exports, \"WebSocket\", { enumerable: true, get: function () { return engine_io_client_1.WebSocket; } });\nObject.defineProperty(exports, \"WebTransport\", { enumerable: true, get: function () { return engine_io_client_1.WebTransport; } });\n\nmodule.exports = lookup;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst AuthController = require('./AuthController');\nconst AuthStates = require('./AuthStates');\nconst LoginButton = require('../Browser/LoginButton');\nconst Service = require('../Service');\n\n/**\n * @memberof pryv\n * @namespace pryv.Auth\n */\nmodule.exports = {\n  setupAuth,\n  AuthStates,\n  AuthController\n};\n\n/**\n * Start an authentication process\n *\n * @memberof pryv.Auth\n * @param {Object} settings\n * @param {Object} settings.authRequest See https://api.pryv.com/reference/#data-structure-access\n * @param {string} [settings.authRequest.languageCode] Language code, as per LoginButton Messages: 'en', 'fr\n * @param {string} settings.authRequest.requestingAppId Application id, ex: 'my-app'\n * @param {Object} settings.authRequest.requestedPermissions\n * @param {string | boolean} settings.authRequest.returnURL : false, // set this if you don't want a popup\n * @param {string} [settings.authRequest.referer] To track registration source\n * @param {string} settings.spanButtonID set and <span> id in DOM to insert default login button or null for custom\n * @param {Function} settings.onStateChange\n * @param {string} [settings.returnURL] Set to \"self#\" to disable popup and force using the same page\n * @param {string} serviceInfoUrl\n * @param {Object} [serviceCustomizations] override properties of serviceInfoUrl\n * @returns {Promise<Service>}\n */\nasync function setupAuth (settings, serviceInfoUrl, serviceCustomizations, HumanInteraction = LoginButton) {\n  const service = new Service(serviceInfoUrl, serviceCustomizations);\n  await service.info();\n\n  const humanInteraction = new HumanInteraction(settings, service);\n  await humanInteraction.init();\n\n  return service;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Fetch = void 0;\nconst polling_js_1 = require(\"./polling.js\");\n/**\n * HTTP long-polling based on the built-in `fetch()` method.\n *\n * Usage: browser, Node.js (since v18), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n * @see https://caniuse.com/fetch\n * @see https://nodejs.org/api/globals.html#fetch\n */\nclass Fetch extends polling_js_1.Polling {\n    doPoll() {\n        this._fetch()\n            .then((res) => {\n            if (!res.ok) {\n                return this.onError(\"fetch read error\", res.status, res);\n            }\n            res.text().then((data) => this.onData(data));\n        })\n            .catch((err) => {\n            this.onError(\"fetch read error\", err);\n        });\n    }\n    doWrite(data, callback) {\n        this._fetch(data)\n            .then((res) => {\n            if (!res.ok) {\n                return this.onError(\"fetch write error\", res.status, res);\n            }\n            callback();\n        })\n            .catch((err) => {\n            this.onError(\"fetch write error\", err);\n        });\n    }\n    _fetch(data) {\n        var _a;\n        const isPost = data !== undefined;\n        const headers = new Headers(this.opts.extraHeaders);\n        if (isPost) {\n            headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n        }\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n        return fetch(this.uri(), {\n            method: isPost ? \"POST\" : \"GET\",\n            body: isPost ? data : null,\n            headers,\n            credentials: this.opts.withCredentials ? \"include\" : \"omit\",\n        }).then((res) => {\n            var _a;\n            // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n            (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n            return res;\n        });\n    }\n}\nexports.Fetch = Fetch;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Socket = exports.SocketWithUpgrade = exports.SocketWithoutUpgrade = void 0;\nconst index_js_1 = require(\"./transports/index.js\");\nconst util_js_1 = require(\"./util.js\");\nconst parseqs_js_1 = require(\"./contrib/parseqs.js\");\nconst parseuri_js_1 = require(\"./contrib/parseuri.js\");\nconst component_emitter_1 = require(\"@socket.io/component-emitter\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst globals_node_js_1 = require(\"./globals.node.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:socket\"); // debug()\nconst withEventListeners = typeof addEventListener === \"function\" &&\n    typeof removeEventListener === \"function\";\nconst OFFLINE_EVENT_LISTENERS = [];\nif (withEventListeners) {\n    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the\n    // script, so we create one single event listener here which will forward the event to the socket instances\n    addEventListener(\"offline\", () => {\n        debug(\"closing %d connection(s) because the network was lost\", OFFLINE_EVENT_LISTENERS.length);\n        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());\n    }, false);\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that\n * successfully establishes the connection.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithoutUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithoutUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithUpgrade\n * @see Socket\n */\nclass SocketWithoutUpgrade extends component_emitter_1.Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts) {\n        super();\n        this.binaryType = globals_node_js_1.defaultBinaryType;\n        this.writeBuffer = [];\n        this._prevBufferLen = 0;\n        this._pingInterval = -1;\n        this._pingTimeout = -1;\n        this._maxPayload = -1;\n        /**\n         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the\n         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.\n         */\n        this._pingTimeoutTime = Infinity;\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            const parsedUri = (0, parseuri_js_1.parse)(uri);\n            opts.hostname = parsedUri.host;\n            opts.secure =\n                parsedUri.protocol === \"https\" || parsedUri.protocol === \"wss\";\n            opts.port = parsedUri.port;\n            if (parsedUri.query)\n                opts.query = parsedUri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = (0, parseuri_js_1.parse)(opts.host).host;\n        }\n        (0, util_js_1.installTimerFunctions)(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = [];\n        this._transportsByName = {};\n        opts.transports.forEach((t) => {\n            const transportName = t.prototype.name;\n            this.transports.push(transportName);\n            this._transportsByName[transportName] = t;\n        });\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = (0, parseqs_js_1.decode)(this.opts.query);\n        }\n        if (withEventListeners) {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this._beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                debug(\"adding listener for the 'offline' event\");\n                this._offlineEventListener = () => {\n                    this._onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);\n            }\n        }\n        if (this.opts.withCredentials) {\n            this._cookieJar = (0, globals_node_js_1.createCookieJar)();\n        }\n        this._open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        debug('creating transport \"%s\"', name);\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = engine_io_parser_1.protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        debug(\"options: %j\", opts);\n        return new this._transportsByName[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    _open() {\n        if (this.transports.length === 0) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        const transportName = this.opts.rememberUpgrade &&\n            SocketWithoutUpgrade.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1\n            ? \"websocket\"\n            : this.transports[0];\n        this.readyState = \"opening\";\n        const transport = this.createTransport(transportName);\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        debug(\"setting transport %s\", transport.name);\n        if (this.transport) {\n            debug(\"clearing existing transport %s\", this.transport.name);\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this._onDrain.bind(this))\n            .on(\"packet\", this._onPacket.bind(this))\n            .on(\"error\", this._onError.bind(this))\n            .on(\"close\", (reason) => this._onClose(\"transport close\", reason));\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        debug(\"socket open\");\n        this.readyState = \"open\";\n        SocketWithoutUpgrade.priorWebsocketSuccess =\n            \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    _onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            debug('socket receive: type \"%s\", data \"%s\"', packet.type, packet.data);\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this._sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    this._resetPingTimeout();\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this._onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n            debug('packet received with socket readyState \"%s\"', this.readyState);\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this._pingInterval = data.pingInterval;\n        this._pingTimeout = data.pingTimeout;\n        this._maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this._resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    _resetPingTimeout() {\n        this.clearTimeoutFn(this._pingTimeoutTimer);\n        const delay = this._pingInterval + this._pingTimeout;\n        this._pingTimeoutTime = Date.now() + delay;\n        this._pingTimeoutTimer = this.setTimeoutFn(() => {\n            this._onClose(\"ping timeout\");\n        }, delay);\n        if (this.opts.autoUnref) {\n            this._pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    _onDrain() {\n        this.writeBuffer.splice(0, this._prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this._prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this._getWritablePackets();\n            debug(\"flushing %d packets in socket\", packets.length);\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this._prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    _getWritablePackets() {\n        const shouldCheckPayloadSize = this._maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += (0, util_js_1.byteLength)(data);\n            }\n            if (i > 0 && payloadSize > this._maxPayload) {\n                debug(\"only send %d out of %d packets\", i, this.writeBuffer.length);\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        debug(\"payload size is %d (max: %d)\", payloadSize, this._maxPayload);\n        return this.writeBuffer;\n    }\n    /**\n     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.\n     *\n     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the\n     * `write()` method then the message would not be buffered by the Socket.IO client.\n     *\n     * @return {boolean}\n     * @private\n     */\n    /* private */ _hasPingExpired() {\n        if (!this._pingTimeoutTime)\n            return true;\n        const hasExpired = Date.now() > this._pingTimeoutTime;\n        if (hasExpired) {\n            debug(\"throttled timer detected, scheduling connection close\");\n            this._pingTimeoutTime = 0;\n            (0, globals_node_js_1.nextTick)(() => {\n                this._onClose(\"ping timeout\");\n            }, this.setTimeoutFn);\n        }\n        return hasExpired;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a message. Alias of {@link Socket#write}.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    send(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    _sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this._onClose(\"forced close\");\n            debug(\"socket closing - telling transport to close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    _onError(err) {\n        debug(\"socket error %j\", err);\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        if (this.opts.tryAllTransports &&\n            this.transports.length > 1 &&\n            this.readyState === \"opening\") {\n            debug(\"trying next transport\");\n            this.transports.shift();\n            return this._open();\n        }\n        this.emitReserved(\"error\", err);\n        this._onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    _onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            debug('socket close with reason: \"%s\"', reason);\n            // clear timers\n            this.clearTimeoutFn(this._pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (withEventListeners) {\n                if (this._beforeunloadEventListener) {\n                    removeEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n                }\n                if (this._offlineEventListener) {\n                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);\n                    if (i !== -1) {\n                        debug(\"removing listener for the 'offline' event\");\n                        OFFLINE_EVENT_LISTENERS.splice(i, 1);\n                    }\n                }\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this._prevBufferLen = 0;\n        }\n    }\n}\nexports.SocketWithoutUpgrade = SocketWithoutUpgrade;\nSocketWithoutUpgrade.protocol = engine_io_parser_1.protocol;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see Socket\n */\nclass SocketWithUpgrade extends SocketWithoutUpgrade {\n    constructor() {\n        super(...arguments);\n        this._upgrades = [];\n    }\n    onOpen() {\n        super.onOpen();\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            debug(\"starting upgrade probes\");\n            for (let i = 0; i < this._upgrades.length; i++) {\n                this._probe(this._upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    _probe(name) {\n        debug('probing transport \"%s\"', name);\n        let transport = this.createTransport(name);\n        let failed = false;\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            debug('probe transport \"%s\" opened', name);\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    debug('probe transport \"%s\" pong', name);\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    SocketWithoutUpgrade.priorWebsocketSuccess =\n                        \"websocket\" === transport.name;\n                    debug('pausing current transport \"%s\"', this.transport.name);\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        debug(\"changing transport and sending upgrade packet\");\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    debug('probe transport \"%s\" failed', name);\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            debug('probe transport \"%s\" failed because of error: %s', name, err);\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                debug('\"%s\" works - aborting \"%s\"', to.name, transport.name);\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this._upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    onHandshake(data) {\n        this._upgrades = this._filterUpgrades(data.upgrades);\n        super.onHandshake(data);\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    _filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        for (let i = 0; i < upgrades.length; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\nexports.SocketWithUpgrade = SocketWithUpgrade;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * @example\n * import { Socket } from \"engine.io-client\";\n *\n * const socket = new Socket();\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see SocketWithUpgrade\n */\nclass Socket extends SocketWithUpgrade {\n    constructor(uri, opts = {}) {\n        const o = typeof uri === \"object\" ? uri : opts;\n        if (!o.transports ||\n            (o.transports && typeof o.transports[0] === \"string\")) {\n            o.transports = (o.transports || [\"polling\", \"websocket\", \"webtransport\"])\n                .map((transportName) => index_js_1.transports[transportName])\n                .filter((t) => !!t);\n        }\n        super(uri, o);\n    }\n}\nexports.Socket = Socket;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst Changes = require('../lib/Changes');\n/**\n * Base class for update methods used by Monitor.\n * Subclass this to create custom update strategies.\n * @memberof pryv.Monitor\n */\nclass UpdateMethod {\n  /**\n   * Assign a Monitor to this updater.\n   * Usually called by the monitor itself on monitor.addUpdateMethod()\n   * @param {Monitor} monitor - The monitor to attach to\n   */\n  setMonitor (monitor) {\n    if (this.monitor) {\n      throw new Error('An update Method can be assigned to one monitor only');\n    }\n    this.monitor = monitor;\n    // @ts-ignore - Changes.READY and Changes.STOP are valid event names\n    monitor.on(Changes.READY, this.ready.bind(this));\n    // @ts-ignore\n    monitor.on(Changes.STOP, this.stop.bind(this));\n    if (monitor.started) {\n      this.ready();\n    }\n  }\n\n  /**\n   * Called when all update tasks are done and monitor is ready for next update.\n   * Override in subclasses to implement custom behavior.\n   * @returns {Promise<void>}\n   */\n  async ready () { }\n\n  /**\n   * Called when monitor is stopped. Override to clean up resources.\n   * @returns {Promise<void>}\n   */\n  async stop () { }\n}\n\nmodule.exports = UpdateMethod;\n","\"use strict\";\n// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encode = encode;\nexports.decode = decode;\nfunction encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nfunction decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WS = exports.BaseWS = void 0;\nconst transport_js_1 = require(\"../transport.js\");\nconst util_js_1 = require(\"../util.js\");\nconst engine_io_parser_1 = require(\"engine.io-parser\");\nconst globals_node_js_1 = require(\"../globals.node.js\");\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\nconst debug = (0, debug_1.default)(\"engine.io-client:websocket\"); // debug()\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nclass BaseWS extends transport_js_1.Transport {\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : (0, util_js_1.pick)(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws = this.createSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            (0, engine_io_parser_1.encodePacket)(packet, this.supportsBinary, (data) => {\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    this.doWrite(packet, data);\n                }\n                catch (e) {\n                    debug(\"websocket closed before onclose event\");\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    (0, globals_node_js_1.nextTick)(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.onerror = () => { };\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = (0, util_js_1.randomString)();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nexports.BaseWS = BaseWS;\nconst WebSocketCtor = globals_node_js_1.globalThisShim.WebSocket || globals_node_js_1.globalThisShim.MozWebSocket;\n/**\n * WebSocket transport based on the built-in `WebSocket` object.\n *\n * Usage: browser, Node.js (since v21), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * @see https://caniuse.com/mdn-api_websocket\n * @see https://nodejs.org/api/globals.html#websocket\n */\nclass WS extends BaseWS {\n    createSocket(uri, protocols, opts) {\n        return !isReactNative\n            ? protocols\n                ? new WebSocketCtor(uri, protocols)\n                : new WebSocketCtor(uri)\n            : new WebSocketCtor(uri, protocols, opts);\n    }\n    doWrite(_packet, data) {\n        this.ws.send(data);\n    }\n}\nexports.WS = WS;\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst utils = require('./utils.js');\n// Connection is required at the end of this file to allow circular requires.\nconst Assets = require('./ServiceAssets.js');\n\n/**\n * @class pryv.Service\n * A Pryv.io deployment is a unique \"Service\", as an example **Pryv Lab** is a service, deployed with the domain name **pryv.me**.\n *\n * `pryv.Service` exposes tools to interact with Pryv.io at a \"Platform\" level.\n *\n *  ##### Initizalization with a service info URL\n```js\nconst service = new pryv.Service('https://reg.pryv.me/service/info');\n```\n\n- With the content of a serviceInfo configuration\n\nService information properties can be overriden with specific values. This might be usefull to test new designs on production platforms.\n\n```js\nconst serviceInfoUrl = 'https://reg.pryv.me/service/info';\nconst serviceCustomizations = {\n  name: 'Pryv Lab 2',\n  assets: {\n    definitions: 'https://pryv.github.io/assets-pryv.me/index.json'\n  }\n}\nconst service = new pryv.Service(serviceInfoUrl, serviceCustomizations);\n```\n\n * @memberof pryv\n *\n * @constructor\n * @param {string} serviceInfoUrl Url point to /service/info of a Pryv platform see: {@link https://api.pryv.com/reference/#service-info}\n */\nclass Service {\n  constructor (serviceInfoUrl, serviceCustomizations) {\n    this._serviceInfo = null;\n    this._assets = null;\n    this._polling = false;\n    this._serviceInfoUrl = serviceInfoUrl;\n    this._pryvServiceCustomizations = serviceCustomizations;\n  }\n\n  /**\n   * Return service info parameters info known of fetch it if needed.\n   * Example\n   *  - name of a platform\n   *    `const serviceName = await service.info().name`\n   * @see ServiceInfo For details on available properties.\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceInfo>} Promise to Service info Object\n   */\n  async info (forceFetch) {\n    if (forceFetch || !this._serviceInfo) {\n      let baseServiceInfo = {};\n      if (this._serviceInfoUrl) {\n        const { body } = await utils.fetchGet(this._serviceInfoUrl);\n        baseServiceInfo = body;\n      }\n      Object.assign(baseServiceInfo, this._pryvServiceCustomizations);\n      // @ts-ignore - baseServiceInfo is populated from body or customizations\n      this.setServiceInfo(baseServiceInfo);\n    }\n    return this._serviceInfo;\n  }\n\n  /**\n   * Check if a service supports High Frequency Data Sets\n   * @returns {Promise<boolean>} Promise resolving to true if HF is supported\n   */\n  async supportsHF () {\n    const infos = await this.info();\n    return (infos.features == null || infos.features.noHF !== true);\n  }\n\n  /**\n   * Check if a service has username in the hostname or in the path of the API.\n   * @returns {Promise<boolean>} Promise resolving to true if the service does not rely on DNS to find a host related to a username\n   */\n  async isDnsLess () {\n    const infos = await this.info();\n    const hostname = infos.api.split('/')[2];\n    return !hostname.includes('{username}');\n  }\n\n  /**\n   * @private\n   * @param {ServiceInfo} serviceInfo\n   */\n  setServiceInfo (serviceInfo) {\n    if (!serviceInfo.name) {\n      throw new Error('Invalid data from service/info');\n    }\n    // cleanup serviceInfo for eventual url not finishing by \"/\"\n    // code will be obsolete with next version of register\n    ['access', 'api', 'register'].forEach((key) => {\n      if (serviceInfo[key].slice(-1) !== '/') {\n        serviceInfo[key] += '/';\n      }\n    });\n    this._serviceInfo = serviceInfo;\n  }\n\n  /**\n   * Return assets property content\n   * @param {boolean} [forceFetch] If true, will force fetching service info.\n   * @returns {Promise<ServiceAssets|null>} Promise to ServiceAssets\n   */\n  async assets (forceFetch) {\n    if (!forceFetch && this._assets) {\n      return this._assets;\n    } else {\n      const serviceInfo = await this.info();\n      if (!serviceInfo.assets || !serviceInfo.assets.definitions) {\n        console.log('Warning: no assets for this service');\n        return null;\n      }\n      this._assets = await Assets.setup(serviceInfo.assets.definitions);\n      return this._assets;\n    }\n  }\n\n  /**\n   * Return service info parameters info known or null if not yet loaded\n   * @returns {ServiceInfo} Service Info definition\n   */\n  infoSync () {\n    return this._serviceInfo;\n  }\n\n  /**\n   * Return an API endpoint from a username and token\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {Promise<APIEndpoint>} Promise resolving to the API endpoint URL\n   */\n  async apiEndpointFor (username, token) {\n    const serviceInfo = await this.info();\n    return Service.buildAPIEndpoint(serviceInfo, username, token);\n  }\n\n  /**\n   * Return an API endpoint from a username, token and ServiceInfo.\n   * This method is rarely used. See **apiEndpointFor** as an alternative.\n   * @param {ServiceInfo} serviceInfo - The service info object containing API URL template\n   * @param {string} username - The username\n   * @param {string} [token] - Optional authorization token\n   * @returns {APIEndpoint} The constructed API endpoint URL\n   */\n  static buildAPIEndpoint (serviceInfo, username, token) {\n    const endpoint = serviceInfo.api.replace('{username}', username);\n    return utils.buildAPIEndpoint({ endpoint, token });\n  }\n\n  /**\n   * Issue a \"login call on the Service\" return a Connection on success\n   * **! Warning**: the token of the connection will be a \"Personal\" token that expires\n   * @see https://api.pryv.com/reference-full/#login-user\n   * @param {string} username\n   * @param {string} password\n   * @param {string} appId\n   * @param {string} [originHeader=service-info.register] Only for Node.js. If not set will use the register value of service info. In browsers this will overridden by current page location.\n   * @throws {Error} on invalid login\n   */\n  async login (username, password, appId, originHeader) {\n    const apiEndpoint = await this.apiEndpointFor(username);\n\n    const headers = {};\n    originHeader = originHeader || (await this.info()).register;\n    if (!utils.isBrowser()) {\n      headers.Origin = originHeader;\n    }\n    const { response, body } = await utils.fetchPost(\n      apiEndpoint + 'auth/login',\n      { username, password, appId },\n      headers\n    );\n\n    if (!response.ok) {\n      if (body?.error?.message) {\n        throw new Error(body.error.message);\n      }\n      throw new Error('Login failed: ' + JSON.stringify(body));\n    }\n\n    if (!body.token) {\n      throw new Error('Invalid login response: ' + JSON.stringify(body));\n    }\n    return new Connection(\n      Service.buildAPIEndpoint(await this.info(), username, body.token),\n      this // Pre load Connection with service\n    );\n  }\n}\n\nmodule.exports = Service;\n\n// Require is done after exports to allow circular references\nconst Connection = require('./Connection');\n\n/**\n * Object to handle Pryv Service Informations https://api.pryv.com/reference/#service-info\n * @typedef {Object} ServiceInfo\n * @property {string} register The URL of the register service.\n * @property {string} access The URL of the access page.\n * @property {string} api The API endpoint format.\n * @property {string} name The platform name.\n * @property {string} home The URL of the platform's home page.\n * @property {string} support The email or URL of the support page.\n * @property {string} terms The terms and conditions, in plain text or the URL displaying them.\n * @property {string} eventTypes The URL of the list of validated event types.\n * @property {Object} [assets] Holder for service specific Assets (icons, css, ...)\n * @property {string} [assets.definitions] URL to json object with assets definitions\n * @property {Object} [features] Platform feature flags\n * @property {boolean} [features.noHF] True if HF data is not supported\n */\n","/**\n * @license\n * [BSD-3-Clause](https://github.com/pryv/lib-js/blob/master/LICENSE)\n */\nconst pryv = require('./browser-index');\nrequire('@pryv/socket.io')(pryv);\nrequire('@pryv/monitor')(pryv);\nmodule.exports = pryv;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isBinary = isBinary;\nexports.hasBinary = hasBinary;\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nfunction isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nfunction hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.transports = void 0;\nconst polling_xhr_node_js_1 = require(\"./polling-xhr.node.js\");\nconst websocket_node_js_1 = require(\"./websocket.node.js\");\nconst webtransport_js_1 = require(\"./webtransport.js\");\nexports.transports = {\n    websocket: websocket_node_js_1.WS,\n    webtransport: webtransport_js_1.WT,\n    polling: polling_xhr_node_js_1.XHR,\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(8769);\n"],"names":["module","exports","Service","require","Connection","Auth","Browser","utils","PryvError","version","Cookies","AuthStates","AuthController","Messages","constructor","authSettings","service","this","serviceInfo","infoSync","init","loginBtn","loginButtonSpan","document","getElementById","spanButtonID","loginButtonText","addEventListener","onClick","bind","console","log","languageCode","authRequest","messages","async","assets","innerHTML","loginButtonGetHTML","loadAssets","_cookieKey","requestingAppId","auth","handleClick","onStateChange","state","status","LOADING","text","INITIALIZED","loginButton","serviceName","name","LOGIN","NEED_SIGNIN","loginUrl","authUrl","url","returnURL","location","href","screenX","window","screenLeft","screenY","screenTop","outerWidth","body","clientWidth","outerHeight","clientHeight","features","Math","floor","popup","open","focus","startLoginScreen","AUTHORIZED","username","saveAuthorizationData","apiEndpoint","SIGNOUT","message","SIGNOUT_CONFIRM","confirm","deleteAuthorizationData","ERROR","getErrorMessage","getAuthorizationData","get","authData","set","del","finishAuthProcessAfterRedirection","authController","isBrowser","pollUrl","params","getQueryParamsFromURL","prYvkey","access","prYvpoll","retrievePollUrl","fetchGet","e","error","__importDefault","mod","__esModule","Object","defineProperty","value","Polling","transport_js_1","util_js_1","engine_io_parser_1","debug","default","Transport","super","arguments","_polling","doOpen","_poll","pause","onPause","readyState","writable","total","once","doPoll","emitReserved","onData","data","decodePayload","socket","binaryType","forEach","packet","type","onOpen","onClose","description","onPacket","doClose","close","write","packets","encodePayload","doWrite","uri","schema","opts","secure","query","timestampRequests","timestampParam","randomString","supportsBinary","sid","b64","createUri","io","EventEmitter","EVENTS","SocketIO","connection","connecting","_io","Promise","resolve","reject","Error","then","socketEndpoint","endpoint","token","forceNew","errcode","myCode","on","ex","event","_len","length","args","Array","_key","emit","registerListeners","catch","checkOpen","eventName","listener","indexOf","api","arrayOfAPICalls","progress","_chunkedBatchCall","batchCall","err","res","prototype","_socket","Changes","monitor","getEventsStreamed","eventsGetScope","modified","modifiedSince","deleted","EVENT_DELETE","EVENT","env","createDebug","namespace","prevTime","namespacesCache","enabledCache","enableOverride","enabled","self","curr","Number","Date","ms","diff","prev","coerce","unshift","index","replace","match","format","formatter","formatters","val","call","splice","formatArgs","apply","useColors","color","selectColor","extend","destroy","enumerable","configurable","namespaces","v","delimiter","newDebug","matchesTemplate","search","template","searchIndex","templateIndex","starIndex","matchIndex","stack","disable","names","skips","map","join","enable","save","split","trim","filter","Boolean","ns","push","slice","skip","humanize","warn","keys","key","hash","i","charCodeAt","colors","abs","load","regexAPIandToken","regexSchemaAndPath","queryParams","undefined","headers","queryStr","URLSearchParams","toString","myHeaders","assign","Accept","response","fetch","json","fetchGetText","fetchPost","method","JSON","stringify","extractTokenAndAPIEndpoint","lastIndex","exec","endsWith","res2","buildAPIEndpoint","tokenAndAPI","browserIsMobileOrTablet","navigator","check","a","userAgent","vendor","opera","test","substr","cleanURLFromPrYvParams","vars","m","decodeURIComponent","extractTokenAndApiEndpoint","buildPryvApiEndpoint","REFUSED","parse","str","src","b","substring","re","parts","source","host","authority","ipv6uri","pathNames","obj","path","queryKey","$0","$1","$2","UpdateMethod","_updateEvents","_updateStreams","Monitor","apiEndpointOrConnection","pryv","fromTime","MAX_VALUE","toTime","states","started","starting","updatingEvents","updatingStreams","start","includeDeletions","ready","updateEvents","updateEventRequired","setTimeout","updateStreams","updateStreamsRequired","READY","stop","STOP","addUpdateMethod","updateMethod","setMonitor","definitions","myMessages","en","fr","Pryv","ERROR_PACKET","PACKET_TYPES_REVERSE","PACKET_TYPES","create","XHR","Request","BaseXHR","polling_js_1","component_emitter_1","globals_node_js_1","has_cors_js_1","empty","isSSL","protocol","port","xd","hostname","fn","req","request","xhrStatus","context","onError","pollXhr","Emitter","createRequest","installTimerFunctions","_opts","_method","_uri","_data","_create","_a","pick","xdomain","xhr","_xhr","extraHeaders","setDisableHeaderCheck","hasOwnProperty","setRequestHeader","cookieJar","addCookies","withCredentials","requestTimeout","timeout","onreadystatechange","parseCookies","getResponseHeader","_onLoad","setTimeoutFn","_onError","send","_index","requestsCount","requests","_cleanup","fromError","abort","responseText","attachEvent","unloadHandler","terminationEvent","globalThisShim","hasXHR2","newRequest","responseType","XMLHttpRequest","hasCORS","concat","forceBase64","decodePacket","commons_js_1","base64_arraybuffer_js_1","withNativeArrayBuffer","ArrayBuffer","encodedPacket","mapBinary","charAt","decodeBase64Packet","decoded","decode","base64","Blob","buffer","encodePacket","encodePacketToBinary","callback","withNativeBlob","arrayBuffer","toArray","isView","encoded","TEXT_ENCODER","TextEncoder","encode","encodeBlobAsBase64","fileReader","FileReader","onload","content","result","readAsDataURL","Uint8Array","byteOffset","byteLength","chars","lookup","arraybuffer","bytes","len","encoded1","encoded2","encoded3","encoded4","bufferLength","p","innerObject","captureStackTrace","jsonParser","libGetEventStreamed","getTimestamp","now","options","chunkSize","_deltaTime","weight","_service","accessInfo","user","post","apiOne","expectedKey","revoke","throwOnFail","usingConnection","id","callHandler","isArray","percent","cursor","thisBatch","cursorMax","min","resRequest","results","handleResult","round","_postFetch","_handleMeta","_postFetchRaw","contentType","Authorization","_getFetchRaw","addPointsToHFEvent","eventId","fields","points","forEachEvent","myParser","createEventWithFile","filePath","fs","fileName","basename","mimeType","getMimeType","extname","fileBlob","openAsBlob","formData","FormData","append","createEventWithFileFromBuffer","bufferData","filename","lastDot","lastIndexOf","getExtname","createEventWithFormData","deltaTime","requestLocalTimestamp","meta","serverTime","MIME_TYPES","ext","toLowerCase","EVENTMARKERS","foreachEvent","eventOrEventDeletions","depth","inString","skipNextOne","cursorPos","eventsCount","eventDeletionsCount","processEvents","eventsOrDeletionMsg","ignoreComa","eventStr","addEvent","setEncoding","chunk","n","searchStartEvents","processBuffer","bodyObject","err_","rawResponse","statusCode","strEvent","ServiceAssets","assetsURL","_assets","_assetsURL","setup","pryvServiceAssetsSourceUrl","keyPath","getUrl","relativeURL","baseUrlString","sRelPath","baseLocation","createElement","nUpLn","nEnd","sDir","sPath","pathname","nStart","RegExp","portStr","relPathToAbs","baseUrl","setAllDefaults","setFavicon","loadCSS","link","querySelector","rel","favicon","getElementsByTagName","appendChild","css","loginButtonLoadCSS","buttonSignIn","html","loginButtonGetMessages","head","media","settings","getReturnURL","requestedPermissions","stateChangeListeners","loadedAssets","thisMessages","storedCredentials","checkAutoLogin","stopAuthRequest","msg","startAuthRequest","_state","windowLocationForTest","navigatorForTests","RETURN_URL_AUTO","trailer","returnUrlIsAuto","ok","doPolling","pollResponse","pollAccess","poll","poll_rate_ms","newState","__createBinding","o","k","k2","desc","getOwnPropertyDescriptor","__setModuleDefault","__importStar","Manager","engine_io_client_1","socket_js_1","parser","on_js_1","backo2_js_1","nsps","subs","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","randomizationFactor","backoff","Backoff","max","jitter","_readyState","_parser","encoder","Encoder","decoder","Decoder","_autoConnect","autoConnect","_reconnection","skipReconnect","_reconnectionAttempts","_reconnectionDelay","setMin","_randomizationFactor","setJitter","_reconnectionDelayMax","setMax","_timeout","maybeReconnectOnOpen","_reconnecting","attempts","reconnect","engine","Socket","openSubDestroy","onopen","cleanup","errorSub","timer","autoUnref","unref","clearTimeoutFn","connect","onping","ondata","onerror","onclose","ondecoded","add","nextTick","nsp","active","_destroy","_close","_packet","encodedPackets","subDestroy","disconnect","reason","reset","delay","duration","onreconnect","attempt","LoginButton","CookieUtils","setupAuth","serviceInfoFromUrl","pryvServiceInfoUrl","STREAMS","updateRateMS","isNaN","clearTimeout","mixin","_callbacks","off","removeListener","removeAllListeners","removeEventListener","cb","callbacks","listeners","hasListeners","WT","_transport","WebTransport","transportOptions","closed","createBidirectionalStream","stream","decoderStream","createPacketDecoderStream","MAX_SAFE_INTEGER","reader","readable","pipeThrough","getReader","encoderStream","createPacketEncoderStream","pipeTo","_writer","getWriter","read","done","lastPacket","defaultBinaryType","createCookieJar","Function","PacketType","isPacketValid","isInteger","payload","CONNECT","isObject","DISCONNECT","RESERVED_EVENTS","ACK","CONNECT_ERROR","isDataValid","binary_js_1","is_binary_js_1","replacer","hasBinary","encodeAsString","encodeAsBinary","BINARY_EVENT","BINARY_ACK","attachments","deconstruction","deconstructPacket","pack","buffers","reviver","reconstructor","decodeString","isBinaryEvent","BinaryReconstructor","isBinary","takeBinaryData","buf","next","c","tryParse","isPayloadValid","finishedReconstruction","reconPack","binData","reconstructPacket","isFinite","TransportError","parseqs_js_1","details","_hostname","_port","_query","encodedQuery","packetData","_deconstructPacket","_reconstructPacket","placeholder","_placeholder","num","newData","WebSocket","NodeWebSocket","NodeXHR","Fetch","transports","SocketWithUpgrade","SocketWithoutUpgrade","socket_js_2","index_js_1","parseuri_js_1","polling_fetch_js_1","polling_xhr_node_js_1","polling_xhr_js_1","websocket_node_js_1","WS","websocket_js_1","webtransport_js_1","attr","reduce","acc","useNativeTimers","NATIVE_SET_TIMEOUT","NATIVE_CLEAR_TIMEOUT","l","utf8Length","ceil","size","random","cookieKey","expireInDays","myDate","hostName","setDate","getDate","cookieStr","encodeURIComponent","toUTCString","cookie","pop","shift","ev","Null","EventsTimer","streams","socket_io_parser_1","freeze","connect_error","disconnecting","newListener","connected","recovered","receiveBuffer","sendBuffer","_queue","_queueSeq","ids","acks","flags","disconnected","subEvents","onpacket","_b","_c","retries","fromQueue","volatile","_addToQueue","compress","ack","_registerAckCallback","isTransportWritable","transport","isConnected","_hasPingExpired","notifyOutgoingListeners","ackTimeout","withError","emitWithAck","arg1","arg2","tryCount","pending","responseArgs","_drainQueue","force","_sendConnectPacket","_pid","pid","offset","_lastOffset","_clearAcks","some","String","onconnect","onevent","onack","ondisconnect","emitEvent","_anyListeners","sent","emitBuffered","onAny","prependAny","offAny","listenersAny","onAnyOutgoing","_anyOutgoingListeners","prependAnyOutgoing","offAnyOutgoing","listenersAnyOutgoing","TransformStream","transform","controller","encodePacket_js_1","payloadLength","header","DataView","setUint8","view","setUint16","setBigUint64","BigInt","enqueue","maxPayload","TEXT_DECODER","TextDecoder","chunks","expectedLength","totalLength","concatChunks","headerArray","getUint16","getUint32","pow","decodePacket_js_1","SEPARATOR","fromCharCode","j","count","encodedPayload","decodedPacket","s","h","d","w","plural","msAbs","isPlural","parseFloat","long","fmtShort","loc","ReflectOwnKeys","R","Reflect","ReflectApply","target","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","emitter","errorListener","resolver","eventTargetAgnosticAddListener","handler","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","warned","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","arr","ret","unwrapListeners","arrayClone","listenerCount","copy","wrapListener","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","addListener","prependListener","prependOnceListener","list","position","originalListener","spliceOne","rawListeners","eventNames","conn","queryParam","parserSettings","onend","encoding","fakeRes","f","errResult","bodyObjectResult","URL","fetchParams","pair","entries","factor","rand","deviation","lastC","storage","setItem","removeItem","r","getItem","process","DEBUG","__nwjs","documentElement","style","WebkitAppearance","firebug","exception","table","parseInt","localStorage","localstorage","global","url_js_1","manager_js_1","cache","parsed","sameNamespace","multiplex","serviceInfoUrl","serviceCustomizations","HumanInteraction","info","humanInteraction","_fetch","isPost","Headers","_cookieJar","appendCookies","credentials","getSetCookie","withEventListeners","OFFLINE_EVENT_LISTENERS","writeBuffer","_prevBufferLen","_pingInterval","_pingTimeout","_maxPayload","_pingTimeoutTime","parsedUri","_transportsByName","t","transportName","agent","upgrade","rememberUpgrade","addTrailingSlash","rejectUnauthorized","perMessageDeflate","threshold","closeOnBeforeunload","_beforeunloadEventListener","_offlineEventListener","_onClose","_open","createTransport","EIO","priorWebsocketSuccess","setTransport","_onDrain","_onPacket","flush","onHandshake","_sendPacket","_resetPingTimeout","code","pingInterval","pingTimeout","_pingTimeoutTimer","upgrading","_getWritablePackets","payloadSize","hasExpired","cleanupAndClose","waitForUpgrade","tryAllTransports","_upgrades","_probe","failed","onTransportOpen","freezeTransport","onTransportClose","onupgrade","to","_filterUpgrades","upgrades","filteredUpgrades","qs","qry","pairs","BaseWS","isReactNative","product","protocols","ws","createSocket","addEventListeners","closeEvent","onmessage","WebSocketCtor","MozWebSocket","Assets","_serviceInfo","_serviceInfoUrl","_pryvServiceCustomizations","forceFetch","baseServiceInfo","setServiceInfo","supportsHF","infos","noHF","isDnsLess","includes","apiEndpointFor","login","password","appId","originHeader","register","Origin","toJSON","withNativeFile","File","websocket","webtransport","polling","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","g","globalThis","prop","Symbol","toStringTag","__webpack_exports__"],"ignoreList":[],"sourceRoot":""}